/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/IconPool","sap/ui/base/EventProvider","sap/ui/base/ManagedObjectObserver","sap/ui/Device","sap/ui/core/ShortcutHintsMixin","sap/ui/core/library","sap/m/library","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarLayoutData","./SemanticContainer"],function(I,E,M,D,S,c,m,O,a,b){"use strict";var B=m.ButtonType;var A=c.aria.HasPopup;var d=b.extend("sap.f.semantic.SemanticShareMenu",{constructor:function(C,p){b.call(this,C,p);this._aShareMenuActions=[];this._aCustomShareActions=[];this._oObserver=new M(d.prototype._onShareMenuButtonChanges.bind(this));this._onShareButtonClickRef=this._onShareButtonClick.bind(this);this._setMode(d._Mode.initial);}});d._Mode={initial:"initial",menu:"menu"};d.prototype.addCustomAction=function(C){this._onControlAdded(C);this._oObserver.observe(C,{properties:["visible"]});this._callContainerAggregationMethod("insertButton",C,this._getCustomActionInsertIndex());this._aCustomShareActions.push(C);return this;};d.prototype.insertCustomAction=function(C,i){if(this._aCustomShareActions.indexOf(C)<0){this._onControlAdded(C);this._oObserver.observe(C,{properties:["visible"]});this._aCustomShareActions.splice(i,0,C);}this._callContainerAggregationMethod("insertButton",C,this._getCustomActionInsertIndex(i));return this;};d.prototype.getCustomActions=function(){return this._aCustomShareActions;};d.prototype.indexOfCustomAction=function(C){return this._aCustomShareActions.indexOf(C);};d.prototype.removeCustomAction=function(C){var r=this._callContainerAggregationMethod("removeButton",C);this._oObserver.unobserve(C,{properties:["visible"]});this._aCustomShareActions.splice(this._aCustomShareActions.indexOf(C),1);this._onControlRemoved();return r;};d.prototype.removeAllCustomActions=function(){var r=[];this._aCustomShareActions.forEach(function(C){var R=this._callContainerAggregationMethod("removeButton",C);if(R){r.push(C);}},this);this._aCustomShareActions=[];this._onControlRemoved();return r;};d.prototype.destroyCustomActions=function(){this.removeAllCustomActions(true).forEach(function(C){C.destroy();});return this;};d.prototype.addContent=function(s){var C=this._getControl(s);if(this._aShareMenuActions.indexOf(s)<0){this._onControlAdded(C);this._oObserver.observe(C,{properties:["visible"]});this._aShareMenuActions.push(s);}this._preProcessOverflowToolbarButton(C);this._callContainerAggregationMethod("insertButton",C,this._getSemanticActionInsertIndex(s));return this;};d.prototype.removeContent=function(s){var C=this._getControl(s);this._oObserver.unobserve(C,{properties:["visible"]});this._callContainerAggregationMethod("removeButton",C);this._aShareMenuActions.splice(this._aShareMenuActions.indexOf(s),1);this._postProcessOverflowToolbarButton(s);this._onControlRemoved();return this;};d.prototype.destroy=function(){if(this._oShareMenuBtn){this._oShareMenuBtn.destroy();}this._oShareMenuBtn=null;this._aShareMenuActions=null;this._aCustomShareActions=null;return b.prototype.destroy.call(this);};d.prototype.exit=function(){this._oObserver.disconnect();this._oObserver=null;};d.prototype._getMode=function(){return this._mode;};d.prototype._setMode=function(s){if(this._getMode()===s){return this;}if(s===d._Mode.initial){if(this._getMode()){this._fireContentChanged(true);}this._mode=d._Mode.initial;return this;}if(s===d._Mode.menu){this._mode=d._Mode.menu;this._fireContentChanged(false);}return this;};d.prototype._fireContentChanged=function(e){E.prototype.fireEvent.call(this._getParent(),"_shareMenuContentChanged",{"bEmpty":e});};d.prototype._onShareButtonClick=function(){var C=this._getContainer();C.openBy(this._oShareMenuBtn);};d.prototype._getVisibleActions=function(){var e=this._aShareMenuActions.concat(this._aCustomShareActions),v=e.map(function(o){return this._getControl(o);},this).filter(function(o){return o.getVisible();});return v;};d.prototype._onShareMenuButtonChanges=function(){var v=this._getVisibleActions();this._getShareMenuButton().setVisible(v.length>1);this.fireEvent("_visibleActionsChanged",{"visibleActionsCount":v.length});};d.prototype._getShareMenuButton=function(){var C,r,s;if(!this._oShareMenuBtn){C=this._getContainer();r=sap.ui.getCore().getLibraryResourceBundle("sap.f");s="SEMANTIC_CONTROL_ACTION_SHARE_SHORTCUT";if(D.os.macintosh){s+="_MAC";}this._oShareMenuBtn=new O(C.getId()+"-shareButton",{ariaHasPopup:A.Menu,icon:I.getIconURI("action"),tooltip:r.getText("SEMANTIC_CONTROL_ACTION_SHARE"),layoutData:new a({closeOverflowOnInteraction:false}),text:r.getText("SEMANTIC_CONTROL_ACTION_SHARE"),type:B.Transparent,press:this._onShareButtonClickRef});S.addConfig(this._oShareMenuBtn,{addAccessibilityLabel:true,message:r.getText(s)});}return this._oShareMenuBtn;};d.prototype._getCustomActionInsertIndex=function(i){var C=this._aCustomShareActions.length;if(i===undefined){return this._aShareMenuActions.length+C;}i=i>=C?C:i;i+=this._aShareMenuActions.length;return i;};d.prototype._getSemanticActionInsertIndex=function(s){this._aShareMenuActions.sort(this._sortControlByOrder.bind(this));return this._aShareMenuActions.indexOf(s);};d.prototype._onControlAdded=function(C){if(this._isInitialMode()){this._setMode(d._Mode.menu,C);}};d.prototype._onControlRemoved=function(){var i=this._aShareMenuActions.length,C=this._aCustomShareActions.length,e=(i+C)===0;if(this._isMenuMode()&&e){this._setMode(d._Mode.initial);}};d.prototype._preProcessOverflowToolbarButton=function(o){if(o instanceof O){o._bInOverflow=true;}};d.prototype._postProcessOverflowToolbarButton=function(o){if(o instanceof O){delete o._bInOverflow;}};d.prototype._isInitialMode=function(){return this._getMode()===d._Mode.initial;};d.prototype._isMenuMode=function(){return this._getMode()===d._Mode.menu;};return d;});
