/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/format/DateFormat','sap/ui/core/format/NumberFormat','sap/ui/core/Locale','sap/ui/core/LocaleData',"sap/base/util/deepExtend","sap/ui/unified/calendar/CalendarUtils","./library"],function(D,N,L,a,d,C,l){"use strict";var b=function(){throw new Error();};var _=sap.ui.getCore().getLibraryResourceBundle("sap.m");var c={};var g={};var p={"DATE":["date"],"DATETIME":["datetime"],"DATERANGE":["date","date"],"DATETIMERANGE":["datetime","datetime"],"LASTDAYS":["int"],"LASTWEEKS":["int"],"LASTMONTHS":["int"],"LASTQUARTERS":["int"],"LASTYEARS":["int"],"NEXTDAYS":["int"],"NEXTWEEKS":["int"],"NEXTMONTHS":["int"],"NEXTQUARTERS":["int"],"NEXTYEARS":["int"],"FROM":["date"],"TO":["date"],"FROMDATETIME":["datetime"],"TODATETIME":["datetime"],"SPECIFICMONTH":["month"],"SPECIFICMONTHINYEAR":["month","int"],"TODAYFROMTO":["int","int"]};var s=Object.keys(l.StandardDynamicDateRangeKeys);for(var i=0;i<s.length;i++){var k=s[i];var P=_.getText("DYNAMIC_DATE_"+k.toUpperCase()+"_FORMAT");var S=P.split('{').map(function(e){var f=e.indexOf('}');if(f!==-1){return e.slice(f+1);}return e;});c[k]=S;var h=[];var m=P.indexOf('{');var n=-1;var o=-1;while(m!==-1){n=P.indexOf('}');o=parseInt(P.slice(m+1,n-n-1));h.push(o);P=P.slice(n+1);m=P.indexOf('{');}g[k]=h;}b.getInstance=function(f,e){return this.createInstance(f,e);};b.oDefaultDynamicDateFormat={"date":{},"datetime":{},"month":{pattern:"MMMM"},"year":{pattern:"yyyy"},"int":{}};b.createInstance=function(F,e){var j=Object.create(this.prototype);if(F instanceof L){e=F;F=undefined;}if(!e){e=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();}j.oLocale=e;j.oLocaleData=a.getInstance(e);j.oOriginalFormatOptions=d({},b.oDefaultDynamicDateFormat,F);j._dateFormatter=D.getInstance(j.oOriginalFormatOptions["date"]);j._dateTimeFormatter=D.getDateTimeInstance(j.oOriginalFormatOptions["datetime"]);[j._dateFormatter].concat(j._dateFormatter.aFallbackFormats).forEach(function(f){f.parseRelative=function(){return null;};});[j._dateTimeFormatter].concat(j._dateTimeFormatter.aFallbackFormats).forEach(function(f){f.parseRelative=function(){return null;};});j._monthFormatter=D.getInstance(j.oOriginalFormatOptions["month"]);j._yearFormatter=D.getInstance(j.oOriginalFormatOptions["year"]);j._numberFormatter=N.getInstance(j.oOriginalFormatOptions["int"]);j._resourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.m");return j;};b.prototype.format=function(O,e){var k=O.operator,h=O.values.slice(0);if(k==="SPECIFICMONTH"){var f=new Date();f.setMonth(h[0]);h[0]=this._monthFormatter.format(f);}else if(k==="SPECIFICMONTHINYEAR"){var f=new Date();f.setMonth(h[0]);f.setYear(h[1]);h[0]=this._monthFormatter.format(f);h[1]=this._yearFormatter.format(f);}else if(k==="LASTDAYS"&&h[0]===1&&!e){k="YESTERDAY";h=[];}else if(k==="NEXTDAYS"&&h[0]===1&&!e){k="TOMORROW";h=[];}else if((k==="LASTDAYS"||k==="NEXTDAYS")&&h[0]===0){k="TODAY";h=[];}else if(k==="DATETIME"){h[0]=this._dateTimeFormatter.format(O.values[0]);}else if(k==="TODAYFROMTO"){h[0]=-h[0];if(h[0]>h[1]){h=[h[1],h[0]];}}var F=h.map(function(j){if(j instanceof Date){if(k==="DATETIMERANGE"||k==="FROMDATETIME"||k==="TODATETIME"){return this._dateTimeFormatter.format(j);}return this._dateFormatter.format(j);}if(typeof(j)==="number"){return this._numberFormatter.format(j);}else{return j.toString();}},this);if(k==='TODAYFROMTO'){F.forEach(function(j,q,r){if(j==="0"){r[q]=(q===0?this.oLocaleData.getNumberSymbol("minusSign"):this.oLocaleData.getNumberSymbol("plusSign"))+j;}else{r[q]=h[q]<0?j.toString():this.oLocaleData.getNumberSymbol("plusSign")+j;}},this);}return this._resourceBundle.getText("DYNAMIC_DATE_"+k.toUpperCase()+"_FORMAT",F);};b.prototype.parse=function(v,k){var r,S=c[k],R="^"+S.join("(.*)")+"$",f=new RegExp(R,"i"),q=v.match(f);if(q){r={};r.values=[];for(var j=0;j<g[k].length;j++){var I=g[k][j];var t=p[k][I];var V;var u=q[j+1];switch(t){case"date":V=this._dateFormatter.parse(u);break;case"datetime":V=this._dateTimeFormatter.parse(u);break;case"month":var M=[0,1,2,3,4,5,6,7,8,9,10,11].map(function(i){var x=new Date();x.setMonth(i);return this._monthFormatter.format(x);},this);var w=M.indexOf(u);V=w!==-1?w:null;break;case"int":V=this._numberFormatter.parse(u);break;case"string":V=u;break;default:break;}if(V&&(t==="date"||t==="datetime")){try{C._checkYearInValidRange(V.getFullYear());}catch(e){V=null;}}if(!V&&V!==0){r=null;break;}r.values[I]=V;}if(k==="TODAYFROMTO"&&r){if(r.values[0]>r.values[1]){r.values=[r.values[1],r.values[0]];}r.values[0]=-r.values[0];}if(r){r.operator=k;return r;}}};b.prototype._checkFormatterUTCTimezone=function(O){var t="";if(p[O]){t=p[O][0];}if(t===""||t[0]==="int"){t="date";}if(this.oOriginalFormatOptions[t]){return this.oOriginalFormatOptions[t].UTC;}return false;};return b;});
