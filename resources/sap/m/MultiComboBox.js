/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./InputBase','./ComboBoxBase','./Tokenizer','./Token','./Popover','./CheckBox','./Toolbar','./library','sap/ui/core/EnabledPropagator','sap/ui/core/IconPool','sap/ui/core/library','sap/ui/Device','sap/ui/core/Item','sap/ui/core/ResizeHandler','./MultiComboBoxRenderer',"sap/ui/dom/containsOrEquals","sap/m/inputUtils/completeTextSelected","sap/m/inputUtils/inputsDefaultFilter","sap/m/inputUtils/typeAhead","sap/m/inputUtils/ListHelpers","sap/m/inputUtils/filterItems","sap/m/inputUtils/itemsVisibilityHandler","sap/m/inputUtils/forwardItemPropertiesToToken","sap/m/inputUtils/getTokenByItem","sap/ui/events/KeyCodes","sap/base/util/deepEqual","sap/base/assert","sap/base/Log","sap/ui/core/Core",'sap/ui/core/InvisibleText',"sap/ui/thirdparty/jquery","sap/ui/dom/jquery/cursorPos","sap/ui/dom/jquery/control"],function(I,C,T,a,P,b,c,l,E,d,e,D,f,R,M,g,h,j,t,L,k,m,n,o,K,p,q,r,s,u,Q){"use strict";var v=l.ListMode;var V=e.ValueState;var O=e.OpenState;var w=l.TokenizerRenderMode;var x=C.extend("sap.m.MultiComboBox",{metadata:{library:"sap.m",designtime:"sap/m/designtime/MultiComboBox.designtime",properties:{selectedKeys:{type:"string[]",group:"Data",defaultValue:[]},hasSelection:{type:"boolean",visibility:"hidden",defaultValue:false},showSelectAll:{type:"boolean",defaultValue:false}},associations:{selectedItems:{type:"sap.ui.core.Item",multiple:true,singularName:"selectedItem"}},aggregations:{tokenizer:{type:"sap.m.Tokenizer",multiple:false,visibility:"hidden"}},events:{selectionChange:{parameters:{changedItem:{type:"sap.ui.core.Item"},changedItems:{type:"sap.ui.core.Item[]"},selected:{type:"boolean"},selectAll:{type:"boolean"}}},selectionFinish:{parameters:{selectedItems:{type:"sap.ui.core.Item[]"}}}},dnd:{draggable:false,droppable:true}}});d.insertFontFaceStyle();E.apply(x.prototype,[true]);x.prototype.clone=function(i){var y=C.prototype.clone.apply(this,arguments),z=this._getList();if(z){y.syncPickerContent();}return y;};x.prototype.open=function(){if(!this.isOpen()){this._bPickerIsOpening=true;}this.syncPickerContent();return C.prototype.open.apply(this,arguments);};x.prototype.onsapend=function(i){if(i.isMarked("forwardFocusToParent")){this.focus();}};x.prototype.onsaphome=function(i){if(!this.getFocusDomRef().selectionStart&&this._hasTokens()){T.prototype.onsaphome.apply(this.getAggregation("tokenizer"),arguments);}i.setMarked();};x.prototype.onsapdown=function(i){if(!this.getEnabled()||!this.getEditable()){return;}i.setMarked();i.preventDefault();this.syncPickerContent();if(!this.isOpen()){this._oTraversalItem=this._getNextTraversalItem();if(this._oTraversalItem&&!this.isFocusInTokenizer()&&!this.isComposingCharacter()){this.updateDomValue(this._oTraversalItem.getText());this.selectText(0,this.getValue().length);}return;}setTimeout(this.handleDownEvent.bind(this,i),0);};x.prototype.onsapup=function(i){if(!this.getEnabled()||!this.getEditable()){return;}i.setMarked();i.preventDefault();this.syncPickerContent();if(this.isFocusInTokenizer()||this.isOpen()){return;}this._oTraversalItem=this._getPreviousTraversalItem();if(this._oTraversalItem){this.updateDomValue(this._oTraversalItem.getText());this.selectText(0,this.getValue().length);}};x.prototype.handleDownEvent=function(i){if(!this.isOpen()){return;}var S=i.srcControl,y=S&&S.getDomRef(),F=g(this.getDomRef(),y),z=this.getPicker().getCustomHeader(),A=z&&z.getDomRef();i.setMarked();i.preventDefault();if(F&&this.getValueState()!=V.None){this._handleFormattedTextNav();return;}if((F||g(A,y))&&this.getShowSelectAll()){this.focusSelectAll();return;}this.focusFirstItemInList();};x.prototype.handleEndEvent=function(i){i.setMarked();i.preventDefault();var y=L.getVisibleItems(this.getItems()),z=y.length&&L.getListItem(y[y.length-1]);z&&z.focus();};x.prototype.handleHomeEvent=function(i){i.setMarked();i.preventDefault();if(this.getValueState()!==V.None){this._handleFormattedTextNav();i.stopPropagation(true);return;}if(this.getShowSelectAll()){this.focusSelectAll();i.stopPropagation(true);return;}this.focusFirstItemInList();};x.prototype.focusFirstItemInList=function(){var i=L.getVisibleItems(this.getItems()),y=i.length&&L.getListItem(i[0]);y&&y.focus();};x.prototype.isFocusInTokenizer=function(){return Q.contains(this.getAggregation("tokenizer").getFocusDomRef(),document.activeElement);};x.prototype.onsapshow=function(i){i.preventDefault();this._handleItemToFocus();C.prototype.onsapshow.apply(this,arguments);};x.prototype._handlePopupOpenAndItemsLoad=function(){this._handleItemToFocus();C.prototype._handlePopupOpenAndItemsLoad.apply(this,arguments);};x.prototype._valueStateNavDelegate=function(i,y){return{onsapdown:this.handleDownEvent,onsapup:this.focus,onsapend:this.handleEndEvent,onfocusout:function(z){i.removeStyleClass("sapMFocusable");if(!i.getDomRef().contains(z.relatedTarget)){y.forEach(function(A){A.getDomRef().setAttribute("tabindex","-1");});}},onsapshow:this.close,onsaphide:this.close};};x.prototype._closePickerDelegate={onsaptabnext:function(){this.close();setTimeout(function(){this.closeValueStateMessage();}.bind(this),0);}};x.prototype._formattedTextLinksNav={onsapup:this.focus,onsapdown:this.handleDownEvent};x.prototype._handleFormattedTextNav=function(){var i=this.getPicker().getCustomHeader(),y=this.getValueStateLinks(),z=y?y[y.length-1]:null,F=y?y[0]:null;if(!i.getDomRef()||i.getDomRef()===document.activeElement){return;}if(!this.oValueStateNavDelegate){this.oValueStateNavDelegate=this._valueStateNavDelegate(i,y);i.addEventDelegate(this.oValueStateNavDelegate,this);}i.getDomRef().setAttribute("tabindex","-1");i.addStyleClass("sapMFocusable");i.focus();y.forEach(function(A){A.getDomRef().setAttribute("tabindex","0");A.addEventDelegate(this._formattedTextLinksNav,this);},this);this.oMoveFocusBackToVSHeader=!this.oMoveFocusBackToVSHeader?{onsaptabprevious:function(A){A.preventDefault();i.focus();i.addStyleClass("sapMFocusable");}}:this.oMoveFocusBackToVSHeader;z&&z.addEventDelegate(this._closePickerDelegate,this);F&&F.addEventDelegate(this.oMoveFocusBackToVSHeader,this);};x.prototype.onsaphide=function(i){this.onsapshow(i);};x.prototype._selectItemByKey=function(y){var z,A,B,i,F,G,H=this.isOpen();if(!this.getEnabled()||!this.getEditable()){return;}if(y){y.setMarked();}z=this._getUnselectedItems(H?"":this.getValue());for(i=0;i<z.length;i++){G=!(z[i].getKey()===undefined||z[i].getKey()===null)&&!z[i].isA("sap.ui.core.SeparatorItem");if(z[i].getText().toUpperCase()===this.getValue().toUpperCase()&&G){B=z[i];F=true;break;}}if(F){A={item:B,id:B.getId(),key:B.getKey(),fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true,listItemUpdated:false};this._bPreventValueRemove=false;if(this.getValue()===""||(typeof this.getValue()==="string"&&B.getText().toLowerCase().startsWith(this.getValue().toLowerCase()))){if(L.getListItem(B).isSelected()){this.setValue('');}else{this.setSelection(A);}}}else{this._bPreventValueRemove=true;}if(y){this.close();}};x.prototype.onsapenter=function(i){var y=this.getAggregation("tokenizer");I.prototype.onsapenter.apply(this,arguments);this._showAlreadySelectedVisualEffect();if(this.getValue()){this._selectItemByKey(i);}if(!this.getEditable()&&y.getHiddenTokensCount()&&i.target===this.getFocusDomRef()){y._togglePopup(y.getTokensPopup());}};x.prototype.onsaptabnext=function(i){var y=this.getValue();if(y){var S=this._getUnselectedItemsStartingText(y);if(S.length===1){this._selectItemByKey(i);}else{this._showWrongValueVisualEffect();}}};x.prototype.onsaptabprevious=x.prototype.onsaptabnext;x.prototype.onsapfocusleave=function(i){var y=this.isPlatformTablet(),z=s.byId(i.relatedControlId),F=z&&z.getFocusDomRef(),A=this.getValue(),B=this.getPicker(),G=this.getAggregation("tokenizer");if(!this._bPickerIsOpening&&(!B||!B.getFocusDomRef()||!F||!Q.contains(B.getFocusDomRef(),F))){this.setValue(null);if(A){this.fireChangeEvent("",{value:A});}if(!Q.contains(this.getDomRef(),document.activeElement)){G.setRenderMode(w.Narrow);}}if(B&&F){if(p(B.getFocusDomRef(),F)&&!y&&!this.isPickerDialog()){this.focus();}}};x.prototype.onfocusin=function(i){var y=this.getPicker();var z=false;var A=y&&y.getFocusDomRef();var B=(y&&y.oPopup.getOpenState())||O.CLOSED;var F=B===O.CLOSING||B===O.CLOSED;var G=this.getPickerType()==="Dropdown";var H=this.getAggregation("tokenizer");if(G){z=A&&Q.contains(A,i.relatedTarget);}if(this.getEditable()&&i.target===this.getDomRef("inner")){H.setRenderMode(w.Loose);}if(i.target===this.getFocusDomRef()){H.hasOneTruncatedToken()&&H.setFirstTokenTruncated(false);this.getEnabled()&&this.addStyleClass("sapMFocus");!F&&z&&this.handleInputValidation(i,false);}if(i.target===this.getOpenArea()&&G&&!this.isPlatformTablet()){this.focus();}if(!this.isOpen()&&this.shouldValueStateMessageBeOpened()){this.openValueStateMessage();}};x.prototype._handleItemTap=function(i){var y=Q(i.target).control(0);if(!y.isA("sap.m.CheckBox")&&!y.isA("sap.m.GroupHeaderListItem")){this._bCheckBoxClicked=false;}};x.prototype._handleItemPress=function(i){if(this.isOpen()&&this._isListInSuggestMode()&&this.getPicker().oPopup.getOpenState()!==O.CLOSING){this.clearFilter();var y=this._getLastSelectedItem();if(y){L.getListItem(y).focus();}}};x.prototype._handleSelectionLiveChange=function(i){if(i.getParameter("selectAll")){return;}var y=i.getParameter("listItem");var z=i.getParameter("listItems");var A=z&&z[z.length-1]||y;var B=this.isPickerDialog()?this.getPickerTextField():this;var S=this._getIsClick()&&!!A;var F=i.getParameter("selected");var N=L.getItemByListItem(this.getItems(),y);var G;if(z&&z.length){G=[];z.forEach(function(J){if(J.getType()==="Active"){G.push(L.getItemByListItem(this.getItems(),J));}},this);}if(y.getType()==="Inactive"){return;}q(N,"The corresponding mapped item was not found on "+this);if(!N){return;}var H={item:N,items:G,id:N.getId(),key:N.getKey(),selectAll:false,fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:true};if(F){this.fireChangeEvent(N.getText());this.setSelection(H);}else{this.fireChangeEvent(N.getText());this.removeSelection(H);}if(this._bCheckBoxClicked){B.setValue(this._sOldInput);if(S&&this.isOpen()&&this.getPicker().oPopup.getOpenState()!==O.CLOSING){A.focus();this._setIsClick(false);}}else{this._bCheckBoxClicked=true;this.setValue("");this.close();}};x.prototype.onkeydown=function(i){var y=this.getEditable(),z=this.getAggregation("tokenizer"),A=z.getTokens().length;C.prototype.onkeydown.apply(this,arguments);if(!this.getEnabled()){return;}if((i.ctrlKey||i.metaKey)&&i.which===K.I&&A){i.preventDefault();if(y){this._togglePopover();}else{this._handleIndicatorPress();}return;}this._bIsPasteEvent=(i.ctrlKey||i.metaKey)&&(i.which===K.V);if(this.getValue().length===0&&(i.ctrlKey||i.metaKey)&&(i.which===K.A)&&this._hasTokens()){z.focus();z.selectAllTokens(true);i.preventDefault();}if(this.isPickerDialog()){this._sOldValue=this.getPickerTextField().getValue();this._iOldCursorPos=Q(this.getFocusDomRef()).cursorPos();}this._bDoTypeAhead=!D.os.android&&(i.which!==K.BACKSPACE)&&(i.which!==K.DELETE);};x.prototype.oninput=function(i){C.prototype.oninput.apply(this,arguments);var y=i.srcControl,z=this.isPickerDialog(),A=z?this.getPickerTextField():this,B=A.getValueState();if(B===V.Error&&this._bAlreadySelected){A.setValueState(this._sInitialValueState);A.setValueStateText(this._sInitialValueStateText);this._bAlreadySelected=false;}if(!this.getEnabled()||!this.getEditable()){return;}this.syncPickerContent();this.handleInputValidation(i,this.isComposingCharacter());if(this._bIsPasteEvent){y.updateDomValue(this._sOldValue||i.target.value||"");return;}if(this.isOpen()){setTimeout(this.highlightList.bind(this,this._sOldInput));}if(this._getItemsShownWithFilter()){this.toggleIconPressedStyle(true);}};x.prototype.filterItems=function(i){return k(this,i.items,i.value,true,false,this.fnFilter||j);};x.prototype.onkeyup=function(i){C.prototype.onkeyup.apply(this,arguments);if(!this.getEnabled()||!this.getEditable()){return;}this._sOldValue=this.getValue();this._iOldCursorPos=Q(this.getFocusDomRef()).cursorPos();};x.prototype._showWrongValueVisualEffect=function(){var S=this._getSuggestionsPopover();var i=this._sInitialValueStateText;var y=this._sInitialValueState;var z=i||this._oRbC.getText("VALUE_STATE_ERROR");var A=this;if(y===V.Error){return;}if(S){S.updateValueState(V.Error,z,true);setTimeout(S.updateValueState.bind(S,A.getValueState(),z,true),1000);}if(!this.isPickerDialog()){this.setValueState(V.Error);this.setValueStateText(this.getValueStateText()||z);setTimeout(this["setValueState"].bind(this,y||V.Error),1000);}this._syncInputWidth(this.getAggregation("tokenizer"));};x.prototype._showAlreadySelectedVisualEffect=function(){var A=this._oRb.getText("VALUE_STATE_ERROR_ALREADY_SELECTED");if(!this.getValue()){return;}var i=!!this.getSelectedItems().filter(function(y){return y.getText().toLowerCase()===this.getValue().toLowerCase();},this).length;var N=this.getItems().filter(function(y){return y.getText().toLowerCase()===this.getValue().toLowerCase();},this).length;if(i){this._sInitialValueState=this.getValueState();this._sInitialValueStateText=this.getValueStateText();this.setValueStateText(A);this._bAlreadySelected=true;this.setValueState("Error");return;}else if(N){return;}else{this._showWrongValueVisualEffect();}};x.prototype._hasShowSelectedButton=function(){return true;};x.prototype.forwardEventHandlersToSuggPopover=function(S){C.prototype.forwardEventHandlersToSuggPopover.apply(this,arguments);S.setShowSelectedPressHandler(this._filterSelectedItems.bind(this));};x.prototype.configPicker=function(i){var y=this.getRenderer(),z=y.CSS_CLASS_MULTICOMBOBOX;i.setHorizontalScrolling(false).addStyleClass(y.CSS_CLASS_COMBOBOXBASE+"Picker").addStyleClass(z+"Picker").addStyleClass(z+"Picker-CTX").attachBeforeOpen(this.onBeforeOpen,this).attachAfterOpen(this.onAfterOpen,this).attachBeforeClose(this.onBeforeClose,this).attachAfterClose(this.onAfterClose,this).addEventDelegate({onBeforeRendering:this.onBeforeRenderingPicker,onAfterRendering:this.onAfterRenderingPicker},this);};x.prototype._configureList=function(i){var y=10;if(!i){return;}i.applyAriaRole("listbox");i.setMode(v.MultiSelect);i.setIncludeItemInSelection(true);i.setGrowingThreshold(y);i.attachBrowserEvent("tap",this._handleItemTap,this).attachSelectionChange(this._handleSelectionLiveChange,this).attachItemPress(this._handleItemPress,this);i.addEventDelegate({onAfterRendering:this.onAfterRenderingList,onfocusin:this.onFocusinList},this);this.getShowSelectAll()&&this.createSelectAllHeaderToolbar(i);};x.prototype._decoratePopupInput=function(i){C.prototype._decoratePopupInput.apply(this,arguments);if(!i||!i.isA(["sap.m.InputBase"])){return;}i.attachSubmit(function(y){var z=i.getValue();if(z){this.setValue(z);this._selectItemByKey();this.setValue(this._sOldInput);this.close();}}.bind(this));i.addEventDelegate({onfocusout:this._handleInputFocusOut},this);i.attachChange(this._handleInnerInputChange.bind(this));return i;};x.prototype._handleInnerInputChange=function(i){if(i.getParameter("value")===""){this._sOldInput="";this.clearFilter();}};x.prototype.onBeforeRendering=function(){var i=this.getEditable();var y=this.getAggregation("tokenizer");var z=this.getItems();C.prototype.onBeforeRendering.apply(this,arguments);this._bInitialSelectedKeysSettersCompleted=true;y.setEnabled(this.getEnabled());y.setEditable(i);this._updatePopoverBasedOnEditMode(i);if(!z.length){this._clearTokenizer();}if(this._getList()){this.syncPickerContent(true);}this.toggleSelectAllVisibility(this.getShowSelectAll());if(this._sOldInput&&z.length&&this.isOpen()){m(this.getItems(),this.filterItems({value:this._sOldInput,items:z}));setTimeout(this.highlightList.bind(this,this._sOldInput));}this._deregisterResizeHandler();this._synchronizeSelectedItemAndKey();this.setProperty("hasSelection",!!this.getSelectedItems().length,true);if(!this._bAlreadySelected){this._sInitialValueStateText=this.getValueStateText();}if(this.getValueState()!==V.Error){this._sInitialValueState=this.getValueState();}};x.prototype.syncPickerContent=function(F){var i,y,z=this.getPicker();if(!z){z=this.createPicker(this.getPickerType());this._updateSuggestionsPopoverValueState();F=true;}if(F){y=this._getList();i=this.getEditable()?this.getItems():this.getSelectedItems();this._synchronizeSelectedItemAndKey();y.destroyItems();this._clearTokenizer();this._fillList(i);if(y.getItemNavigation()){this._iFocusedIndex=y.getItemNavigation().getFocusedIndex();}}return z;};x.prototype._registerResizeHandler=function(){q(!this._iResizeHandlerId,"Resize handler already registered");this._iResizeHandlerId=R.register(this,this._onResize.bind(this));};x.prototype._deregisterResizeHandler=function(){if(this._iResizeHandlerId){R.deregister(this._iResizeHandlerId);this._iResizeHandlerId=null;}};x.prototype._onResize=function(){var i=this.getAggregation("tokenizer");i.setMaxWidth(this._calculateSpaceForTokenizer());this._syncInputWidth(i);this._handleNMoreAccessibility();};x.prototype.onAfterRenderingPicker=function(){var i=this["_onAfterRendering"+this.getPickerType()];if(i){i.call(this);}};x.prototype.onBeforeOpen=function(){C.prototype.onBeforeOpen.apply(this,arguments);var i=this["_onBeforeOpen"+this.getPickerType()];this.addContent();this._aInitiallySelectedItems=this.getSelectedItems();this._synchronizeSelectedItemAndKey();if(i){i.call(this);}};x.prototype.onAfterOpen=function(){var i=this.getFocusDomRef(),y=this.getValueStateLinks();i&&this.getFocusDomRef().setAttribute("aria-expanded","true");this._bPickerIsOpening=false;if(!this.isPlatformTablet()){this.getPicker().setInitialFocus(this);}y.forEach(function(z){z.addDelegate({onAfterRendering:function(){if(this.getFocusDomRef()){this.getFocusDomRef().setAttribute("tabindex","-1");}}},z);});this.closeValueStateMessage();};x.prototype.onBeforeClose=function(){C.prototype.onBeforeClose.apply(this,arguments);};x.prototype.onAfterClose=function(){var U=!Q.contains(this.getDomRef(),document.activeElement)||this.isPickerDialog(),i=this.getFocusDomRef();i&&this.getFocusDomRef().setAttribute("aria-expanded","false");this.toggleIconPressedStyle(false);this.clearFilter();!this.isComposingCharacter()&&!this._bPreventValueRemove&&this.setValue("");this._sOldValue="";this._sOldInput="";this._getSuggestionsPopover()._sTypedInValue="";if(this.isPickerDialog()){this.getPickerTextField().setValue("");this.getFilterSelectedButton()&&this.getFilterSelectedButton().setPressed(false);}this.fireSelectionFinish({selectedItems:this.getSelectedItems()});this.getAggregation("tokenizer").setRenderMode(U?w.Narrow:w.Loose);if(this.getValueState()==V.Error&&document.activeElement===this.getFocusDomRef()){this.selectText(0,this.getValue().length);}};x.prototype._onBeforeOpenDialog=function(){};x.prototype._onBeforeOpenDropdown=function(){var i=this.getPicker(),y=this.getDomRef(),W;if(y&&i){W=(y.offsetWidth/parseFloat(l.BaseFontSize))+"rem";i.setContentMinWidth(W);}};x.prototype.getFilterSelectedButton=function(){return this._getSuggestionsPopover().getFilterSelectedButton();};x.prototype._filterSelectedItems=function(i,F){var S=i.oSource,y,z,A=this.getPickerTextField()?this.getPickerTextField().getValue():"",B=(S&&S.getPressed&&S.getPressed())||F,G=L.getVisibleItems(this.getItems()),H=this.getItems(),J=this.getSelectedItems(),N=null;if(B){G.forEach(function(U){z=J.indexOf(U)>-1?true:false;y=L.getListItem(U);if(!y){return;}if(y.isA("sap.m.GroupHeaderListItem")){y.setVisible(false);N=y;}else{y.setVisible(z);if(z&&N){N.setVisible(true);}}},this);}else{m(this.getItems(),this.filterItems({value:A,items:H}));}this.manageSelectAllCheckBoxState();};x.prototype.revertSelection=function(){this.setSelectedItems(this._aInitiallySelectedItems);};x.prototype.setSelection=function(i){var y=this._getList(),N;if(i.item&&this.isItemSelected(i.item)){return;}if(!i.item){return;}if(!i.items||!i.items.length||i.selectAll){N=[i.item];}else{N=i.items;}N.forEach(function(z){if(!i.listItemUpdated&&L.getListItem(z)&&y){y.setSelectedItem(L.getListItem(z),true);}var A=new a({key:z.getKey()});A.setText(z.getText());z.data(L.CSS_CLASS+"Token",A);this.getAggregation("tokenizer").addToken(A);this.addAssociation("selectedItems",z,i.suppressInvalidate);var S=this.getSelectedKeys();var B=this.getKeys([z])[0];if(B===""||S.indexOf(B)===-1){S.push(B);this.setProperty("selectedKeys",S,i.suppressInvalidate);}if(i.fireChangeEvent){this.fireSelectionChange({changedItem:i.item,changedItems:i.items,selectAll:i.selectAll,selected:true});}},this);if(!this.getProperty("hasSelection")&&this.getSelectedItems().length){this.setProperty("hasSelection",true);}this.setValue('');if(i.fireFinishEvent){if(!this.isOpen()){this.fireSelectionFinish({selectedItems:this.getSelectedItems()});}}};x.prototype.removeSelection=function(i){var y,S,z;if(i.item&&!this.isItemSelected(i.item)){return;}if(!i.item){return;}if(!i.items||!i.items.length||i.selectAll){y=[i.item];}else{y=i.items;}y.forEach(function(N){this.removeAssociation("selectedItems",N,i.suppressInvalidate);S=this.getSelectedKeys();z=S.indexOf(N.getKey());S.splice(z,1);this.setProperty("selectedKeys",S,i.suppressInvalidate);if(!i.listItemUpdated&&L.getListItem(N)){var A=L.getListItem(N);this._getList().setSelectedItem(A,false);}if(!i.tokenUpdated){var B=o(N);N.data(L.CSS_CLASS+"Token",null);this.getAggregation("tokenizer").removeToken(B);}if(i.fireChangeEvent){this.fireSelectionChange({changedItem:i.item,changedItems:i.items,selectAll:i.selectAll,selected:false});}},this);if(this.getProperty("hasSelection")&&!this.getSelectedItems().length){this.setProperty("hasSelection",false);}if(i.fireFinishEvent){if(!this.isOpen()){this.fireSelectionFinish({selectedItems:this.getSelectedItems()});}}};x.prototype._synchronizeSelectedItemAndKey=function(){var S=this.getSelectedKeys();var y=this.getKeys(this.getSelectedItems());if(!S.length){r.info("Info: _synchronizeSelectedItemAndKey() the MultiComboBox control does not contain any item on ",this);return;}for(var i=0,z=null,A=null,B=S.length;i<B;i++){z=S[i];if(y.indexOf(z)>-1){continue;}A=this.getItemByKey(""+z);if(A){this.setSelection({item:A,id:A.getId(),key:A.getKey(),fireChangeEvent:false,suppressInvalidate:true,listItemUpdated:false});}}};x.prototype.updateItems=function(i){var G=function(A){return A&&A.getKey&&A.getKey();},S,y=this.getSelectedItems().map(G),z=this.getSelectedKeys();var U=C.prototype.updateItems.apply(this,arguments);y=this.getSelectedItems().map(G).filter(function(A){return y.indexOf(A)>-1;});S=z.concat(y);this.setSelectedKeys(S);return U;};x.prototype._getSelectedItemsOf=function(y){for(var i=0,z=y.length,S=[];i<z;i++){if(L.getListItem(y[i]).isSelected()){S.push(y[i]);}}return S;};x.prototype._getLastSelectedItem=function(){var i=this.getAggregation("tokenizer").getTokens();var y=i.length?i[i.length-1]:null;if(!y){return null;}return this._getItemByToken(y);};x.prototype._getFocusedListItem=function(){if(!document.activeElement){return null;}var F=s.byId(document.activeElement.id);if(this._getList()&&g(this._getList().getFocusDomRef(),F.getFocusDomRef())){return F;}return null;};x.prototype._getFocusedItem=function(){return L.getItemByListItem(this.getItems(),this._getFocusedListItem());};x.prototype._hasTokens=function(){return this.getAggregation("tokenizer").getTokens().length>0;};x.prototype._decorateListItem=function(i){i.addDelegate({onkeydown:function(y){if((y.ctrlKey||y.metaKey)&&y.which==K.A){y.setMarked();y.preventDefault();var z=L.getSelectableItems(this.getItems());var S=this._getSelectedItemsOf(z);if(S.length!==z.length){z.forEach(function(A){this.setSelection({item:A,items:z,selectAll:true,id:A.getId(),key:A.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false});},this);}else{z.forEach(function(A){this.removeSelection({item:A,items:z,selectAll:true,id:A.getId(),key:A.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false});},this);}}},onmousedown:function(y){this._setIsClick(true);},onkeyup:function(y){var z=null;if(y.which==K.SPACE&&this.isOpen()&&this._isListInSuggestMode()){this.open();z=this._getLastSelectedItem();if(z){L.getListItem(z).focus();}return;}}},true,this);i.addEventDelegate({onsapbackspace:function(y){y.preventDefault();},onsapshow:function(y){y.setMarked();this.close();},onsaphide:function(y){this.onsapshow(y);},onsapenter:function(y){y.setMarked();this.close();},onsaphome:this.handleHomeEvent.bind(this),onsapend:this.handleEndEvent.bind(this),onsapup:function(y){y.setMarked();y.preventDefault();var z=L.getVisibleItems(this.getItems());var A=z[0];var B=Q(document.activeElement).control()[0];if(B!==L.getListItem(A)){return;}if(this.getShowSelectAll()){this.focusSelectAll();}else if(this.getValueState()!==V.None){this._handleFormattedTextNav();}else{this.focus();}y.stopPropagation(true);},onfocusin:function(y){this.addStyleClass(this.getRenderer().CSS_CLASS_MULTICOMBOBOX+"Focused");},onfocusout:function(y){this.removeStyleClass(this.getRenderer().CSS_CLASS_MULTICOMBOBOX+"Focused");},onsapfocusleave:function(y){var z=this.getAggregation("picker");var A=s.byId(y.relatedControlId);if(z&&A&&p(z.getFocusDomRef(),A.getFocusDomRef())){if(y.srcControl){y.srcControl.focus();}}},onsaptabnext:function(){this.getPicker().close();},onsaptabprevious:function(){this.getPicker().close();}},this);if(D.support.touch){i.addEventDelegate({ontouchstart:function(y){y.setMark("cancelAutoClose");}});}};x.prototype._handleInputFocusOut=function(){var i=this.isPickerDialog()?this.getPickerTextField():this,U=this._sOldInput||this._sOldValue||"";i.updateDomValue(U);this._bIsPasteEvent=null;};x.prototype.onItemChange=function(i){var y=C.prototype.onItemChange.call(this,i,this.getShowSecondaryValues());var z=i.getParameters();n({item:i.getSource(),propName:z.name,propValue:z.newValue});return y;};x.prototype._handleIndicatorPress=function(){var i,y=this.getAggregation("tokenizer");if(this.getEditable()){this.syncPickerContent();this._filterSelectedItems({},true);this.focus();i=this.getPicker();i.open();}else{y._togglePopup(y.getTokensPopup());}if(this.isPickerDialog()){this.getFilterSelectedButton().setPressed(true);this.bOpenedByKeyboardOrButton=true;}};x.prototype._togglePopover=function(){var i=this.getPicker();if(!i){i=this.syncPickerContent(true);}if(i.isOpen()){i.close();}else{i.open();}};x.prototype._createTokenizer=function(){var i=new T({renderMode:w.Narrow}).attachTokenDelete(this._handleTokenDelete,this);i.getTokensPopup().attachAfterOpen(function(){if(i.hasOneTruncatedToken()){i.setFirstTokenTruncated(false);}}).attachAfterClose(function(){var y=i.getTokens();if(y.length===1&&!y[0].getTruncated()){i.setFirstTokenTruncated(true);}});i.addEventDelegate({onAfterRendering:this._onAfterRenderingTokenizer},this);return i;};x.prototype._onAfterRenderingTokenizer=function(){var i=this.getAggregation("tokenizer");if(this.getEditable()){i.addStyleClass("sapMTokenizerIndicatorDisabled");}else{i.removeStyleClass("sapMTokenizerIndicatorDisabled");}setTimeout(this._syncInputWidth.bind(this,i),0);setTimeout(this._handleNMoreAccessibility.bind(this),0);setTimeout(i["scrollToEnd"].bind(i),0);};x.prototype._handleTokenDelete=function(i){var y=i.getParameter("tokens");var z=this.getSelectedItems();this._removeSelection(y);if(z.length!==L.getSelectableItems(this.getItems())){!this.isPickerDialog()&&!this.isFocusInTokenizer()&&this.focus();this.fireChangeEvent("");}};x.prototype._removeSelection=function(i){var y=this.getAggregation("tokenizer");i.forEach(function(z){var A=(z&&this._getItemByToken(z));if(!this.getEditable()||!this.getEnabled()||!A||!this.isItemSelected(A)||!A.getEnabled()||!z.getEditable()){return;}this.removeSelection({item:A,id:A.getId(),key:A.getKey(),tokenUpdated:true,fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true});z.destroy();if(this.getSelectedItems().length>0){var i=y.getTokens();i[i.length-1].focus();}else{this.focus();}},this);};x.prototype.onAfterRenderingList=function(){var i=document.activeElement===this.getFocusDomRef();var y=this._getList();var z=y?y.getVisibleItems():[];if(this.getEditable()&&!i&&z[this._iFocusedIndex]){z[this._iFocusedIndex].focus();this._iFocusedIndex=null;}this.manageSelectAllCheckBoxState();};x.prototype.onFocusinList=function(){var i=this._getList();if(this._bListItemNavigationInvalidated&&this._getList().getItemNavigation()){i.getItemNavigation().setSelectedIndex(this._iInitialItemFocus);this._bListItemNavigationInvalidated=false;}this._getSuggestionsPopover().updateListDataAttributes(i);};x.prototype.onAfterRendering=function(){var i=this.getAggregation("tokenizer");C.prototype.onAfterRendering.apply(this,arguments);this._registerResizeHandler();setTimeout(function(){i.setMaxWidth(this._calculateSpaceForTokenizer());}.bind(this),0);};x.prototype.onfocusout=function(i){this.isOpen()&&this._handleInputFocusOut();this.removeStyleClass("sapMFocus");if(this.getValueState()===V.Error&&this.getValueStateText()===this._oRb.getText("VALUE_STATE_ERROR_ALREADY_SELECTED")){this.setValueState(this._sInitialValueState);this.setValueStateText(this._sInitialValueStateText);}C.prototype.onfocusout.apply(this,arguments);};x.prototype.onpaste=function(i){var y;var z=false;var S=this.getSelectedItems();if(window.clipboardData){y=window.clipboardData.getData("Text");}else{y=i.originalEvent.clipboardData.getData('text/plain');}var A=y.split(/\r\n|\r|\n/g);if(A&&A.length>0){L.getSelectableItems(this.getItems()).filter(function(B){return S.indexOf(B)===-1;}).forEach(function(B){if(A.indexOf(B.getText())>-1){z=true;this.setSelection({item:B,id:B.getId(),key:B.getKey(),fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true,listItemUpdated:false});}},this);}if(z){i.stopPropagation();i.preventDefault();}};x.prototype.onsapbackspace=function(i){var y=this.getAggregation("tokenizer");var z=y.getTokens();var S=z.filter(function(A){return A.getSelected();});if(!this.getEnabled()||!this.getEditable()){i.preventDefault();return;}if(this.getCursorPosition()>0||this.getValue().length>0){return;}if(S.length>0){this._removeAllTokens();return;}if(document.activeElement===this.getFocusDomRef()){z[z.length-1]&&z[z.length-1].focus();}i.preventDefault();};x.prototype._removeAllTokens=function(){var i=this.getAggregation("tokenizer");var S=i.getTokens().filter(function(y){return y.getSelected();});if(!S.length){return;}this._removeSelection(S);this.fireChangeEvent("");this.invalidate();};x.prototype.onsapdelete=x.prototype.onsapbackspace;x.prototype.onsapnext=function(i){var y=this.getAggregation("tokenizer");if(i.isMarked()){return;}var F=Q(document.activeElement).control()[0];if(!F){return;}if(F===y||y.$().find(F.$()).length>0&&this.getEditable()){y.scrollToEnd();this.focus();}};x.prototype.onsapprevious=function(i){if(this.getCursorPosition()===0&&!h(this.getFocusDomRef())){if(i.srcControl===this){T.prototype.onsapprevious.apply(this.getAggregation("tokenizer"),arguments);}}};x.prototype.onclick=function(i){var y=this.getEditable(),z=this.getEnabled(),N=i.target.className.indexOf("sapMTokenizerIndicator")>-1;if(y&&z&&N){i.preventDefault();this._handleIndicatorPress();}};x.prototype.ontap=function(i){C.prototype.ontap.apply(this,arguments);var y=this.getOpenArea();if(!this.getEnabled()||!this.getEditable()){return;}i.setMarked();if(this.isPickerDialog()&&y.contains(i.target)){this.open();}};x.prototype.getOpenArea=function(){if(this.isPickerDialog()){return this.getDomRef();}else{return C.prototype.getOpenArea.apply(this,arguments);}};x.prototype._getItemsStartingWithPerTerm=function(i,y){var z=[],A=y?L.getEnabledItems(this.getItems()):L.getSelectableItems(this.getItems()),F=this.fnFilter?this.fnFilter:j;A.forEach(function(B){if(F(i,B)){z.push(B);}},this);return z;};x.prototype._getItemsStartingWith=function(i,y){var z=[],A=y?L.getEnabledItems(this.getItems()):L.getSelectableItems(this.getItems());A.forEach(function(B){if(typeof i==="string"&&i!==""&&B.getText().toLowerCase().startsWith(i.toLowerCase())){z.push(B);}},this);return z;};x.prototype._getUnselectedItemsStartingText=function(i){var y=[];this._getUnselectedItems().forEach(function(z){if(typeof i==="string"&&i!==""&&z.getText().toLowerCase().startsWith(i.toLowerCase())){y.push(z);}},this);return y;};x.prototype.getCursorPosition=function(){return this._$input.cursorPos();};x.prototype._selectPreviousItemsOf=function(i){var y;do{y=true;var z=this._getPreviousVisibleItemOf(i);if(z){var A=L.getListItem(z);if(A){y=L.getListItem(z).getSelected();}}this.setSelection({item:i,id:i.getId(),key:i.getKey(),fireChangeEvent:true,suppressInvalidate:true});i=z;}while(!y);};x.prototype._getNextVisibleItemOf=function(i){var y=L.getSelectableItems(this.getItems());var z=y.indexOf(i)+1;if(z<=0||z>y.length-1){return null;}return y[z];};x.prototype._getPreviousVisibleItemOf=function(i){var y=L.getSelectableItems(this.getItems());var z=y.indexOf(i)-1;if(z<0){return null;}return y[z];};x.prototype._getNextUnselectedItemOf=function(i){var y=this._getUnselectedItems();var z=y.indexOf(i)+1;if(z<=0||z>y.length-1){return null;}return y[z];};x.prototype._getPreviousUnselectedItemOf=function(i){var y=this._getUnselectedItems();var z=y.indexOf(i)-1;if(z<0){return null;}return y[z];};x.prototype._getNextTraversalItem=function(){var i=this.getValue();var y=i?this._getItemsStartingWithPerTerm(i):[];var S=this._getUnselectedItems();if(y.indexOf(this._oTraversalItem)>-1&&this._oTraversalItem.getText()===this.getValue()){return this._getNextUnselectedItemOf(this._oTraversalItem);}if(y.length&&y[0].getText()===this.getValue()){return this._getNextUnselectedItemOf(y[0]);}return y.length?y[0]:S[0];};x.prototype._getPreviousTraversalItem=function(){var i=this.getValue();var y=i?this._getItemsStartingWithPerTerm(i):[];if(y.indexOf(this._oTraversalItem)>-1&&this._oTraversalItem.getText()===this.getValue()){return this._getPreviousUnselectedItemOf(this._oTraversalItem);}if(y.length&&y[y.length-1].getText()===this.getValue()){return this._getPreviousUnselectedItemOf(y[y.length-1]);}if(y.length){return y[y.length-1];}else{var S=this._getUnselectedItems();if(S.length>0){return S[S.length-1];}else{return null;}}};x.prototype.setSelectedItems=function(i){this.removeAllSelectedItems();if(!i||!i.length){return this;}if(!Array.isArray(i)){r.warning("Warning: setSelectedItems() has to be an array of sap.ui.core.Item instances or of valid sap.ui.core.Item IDs",this);return this;}i.forEach(function(y){if(!(y instanceof f)&&(typeof y!=="string")){r.warning("Warning: setSelectedItems() has to be an array of sap.ui.core.Item instances or of valid sap.ui.core.Item IDs",this);return;}if(typeof y==="string"){y=s.byId(y);}this.setSelection({item:y?y:null,id:y?y.getId():"",key:y?y.getKey():"",suppressInvalidate:true});},this);return this;};x.prototype.addSelectedItem=function(i){if(!i){return this;}if(typeof i==="string"){i=s.byId(i);}this.setSelection({item:i?i:null,id:i?i.getId():"",key:i?i.getKey():"",fireChangeEvent:false,suppressInvalidate:true});return this;};x.prototype.removeSelectedItem=function(i){if(!i){return null;}if(typeof i==="string"){i=s.byId(i);}if(!this.isItemSelected(i)){return null;}this.removeSelection({item:i,id:i.getId(),key:i.getKey(),fireChangeEvent:false,suppressInvalidate:true});return i;};x.prototype.removeAllSelectedItems=function(){var i=[];var y=this.getAssociation("selectedItems",[]);y.forEach(function(z){var A=this.removeSelectedItem(z);if(A){i.push(A.getId());}},this);return i;};x.prototype.removeSelectedKeys=function(i){var y,z=[];if(!i||!i.length||!Array.isArray(i)){return z;}i.forEach(function(A){y=this.getItemByKey(A);if(y){this.removeSelection({item:y?y:null,id:y?y.getId():"",key:y?y.getKey():"",fireChangeEvent:false,suppressInvalidate:true});z.push(y);}},this);return z;};x.prototype.setSelectedKeys=function(i){if(this._bInitialSelectedKeysSettersCompleted){this.setProperty("selectedKeys",[],true);this.removeAllSelectedItems();}this.addSelectedKeys(i);this._bInitialSelectedKeysSettersCompleted=true;return this;};x.prototype.addSelectedKeys=function(i){var S,y=[];i=this.validateProperty("selectedKeys",i);i.forEach(function(z){var A=this.getItemByKey(z);if(A){this.addSelectedItem(A);}else if(z!=null){y.push(z);}},this);if(y.length>0){S=this.getProperty("selectedKeys").filter(function(z){return y.indexOf(z)===-1;});y=S.concat(y);this.setProperty("selectedKeys",y,true);}return this;};x.prototype._getUnselectedItems=function(){var i=Q(L.getSelectableItems(this.getItems())).not(this.getSelectedItems()).get();if(!this.isOpen()){return i.filter(function(y){return!y.isA("sap.ui.core.SeparatorItem");});}return i;};x.prototype.getSelectedItems=function(){var i=[],y=this.getAssociation("selectedItems")||[];y.forEach(function(z){var A=s.byId(z);if(A){i.push(A);}},this);return i;};x.prototype.getWidth=function(){return this.getProperty("width")||"100%";};x.prototype._updatePopoverBasedOnEditMode=function(i){var y=this._getList(),S=this._getSuggestionsPopover();if(y&&i!==this._bPrevEditable&&i){S.addContent(y);}this._bPrevEditable=i;};x.prototype._mapItemToListItem=function(i){var y,z,A,B=this.getRenderer();if(!i){return null;}y=L.createListItemFromCoreItem(i,this.getShowSecondaryValues());this._decorateListItem(y);if(i.isA("sap.ui.core.SeparatorItem")){return y;}z=B.CSS_CLASS_MULTICOMBOBOX+"Item";A=(this.isItemSelected(i))?z+"Selected":"";y.addStyleClass(z+" "+A);if(A){var F=new a({key:i.getKey()});F.setText(i.getText());i.data(L.CSS_CLASS+"Token",F);this.getAggregation("tokenizer").addToken(F,true);}this.setSelectable(i,i.getEnabled());return y;};x.prototype.setSelectable=function(i,S){C.prototype.setSelectable.call(this,i,S);var y=o(i);if(y){y.setVisible(S);}};x.prototype._fillList=function(){var y=this._getList();var z=this.getEditable()?this.getItems():this.getSelectedItems();if(!y){return;}y.destroyItems();if(!this._oListItemEnterEventDelegate){this._oListItemEnterEventDelegate={onsapenter:function(F){if(F.srcControl.isSelected()){F.setMarked();}}};}for(var i=0,A,B=z.length;i<B;i++){A=this._mapItemToListItem(z[i]);A.addDelegate(this._oListItemEnterEventDelegate,true,this,true);this._getList().addItem(A);if(this.isItemSelected(z[i])){this._getList().setSelectedItem(A,true);}}};x.prototype.handleInputValidation=function(i,y){var z=i.target.value,A=this.isValueValid(z),B,S,F;var G=i.srcControl;if(!A&&z!==""&&!y){this._handleFieldValidationState(G);return;}F=this._getItemsStartingWith(z,true);if(!y||this._bIsPasteEvent){this._handleTypeAhead(z,F,G);}B=this.getItems();if(this.isPickerDialog()){S=this.getFilterSelectedButton();if(S!=null&&S.getPressed()){S.setPressed(false);}}m(this.getItems(),this.filterItems({value:z,items:B}));this.manageSelectAllCheckBoxState();this._sOldInput=z;if((!this.getValue()||!A)&&!this.bOpenedByKeyboardOrButton&&!this.isPickerDialog()){this.close();}else{this.open();}};x.prototype.isValueValid=function(i){var S=this._getItemsStartingWith(i,true);var y=this._getItemsStartingWithPerTerm(i,true);return S.length||y.length;};x.prototype._handleTypeAhead=function(i,y,z){var S,F;if(!this._bDoTypeAhead){return;}S=this.getSelectedItems();F=y.filter(function(A){return S.indexOf(A)===-1;});t(i,z,F);};x.prototype._handleFieldValidationState=function(i){if(this._sOldInput&&this.isValueValid(this._sOldInput)){i.updateDomValue(this._sOldInput);}else if(this._sOldValue&&this.isValueValid(this._sOldValue)){i.updateDomValue(this._sOldValue);}else{i.updateDomValue("");i.setProperty("effectiveShowClearIcon",false);}if(this._iOldCursorPos){Q(i.getFocusDomRef()).cursorPos(this._iOldCursorPos);}this._showWrongValueVisualEffect();};x.prototype.init=function(){C.prototype.init.apply(this,arguments);this._bInitialSelectedKeysSettersCompleted=false;this._bListItemNavigationInvalidated=false;this._iInitialItemFocus=-1;this._bCheckBoxClicked=true;this._bPreventValueRemove=false;this._oTokenizer=this._createTokenizer();this.setAggregation("tokenizer",this._oTokenizer);this._aInitiallySelectedItems=[];this._oRbC=s.getLibraryResourceBundle("sap.ui.core");this._fillList();};x.prototype.handleItemRemoval=function(i){this.removeSelection({item:i,id:i?i.getId():"",key:i?i.getKey():"",fireChangeEvent:false,suppressInvalidate:true,listItemUpdated:true});};x.prototype.isItemSelected=function(i){return this.getSelectedItems().indexOf(i)>-1;};x.prototype._clearTokenizer=function(){this.getAggregation("tokenizer").destroyTokens();};x.prototype.exit=function(){C.prototype.exit.apply(this,arguments);this._deregisterResizeHandler();if(this._oTokenizer){this._oTokenizer.destroy();this._oTokenizer=null;}this._oRbC=null;this._oListItemEnterEventDelegate=null;this.oValueStateNavDelegate=null;this._sInitialValueState=null;};x.prototype.destroyItems=function(){this.setProperty("selectedKeys",[]);this._clearTokenizer();return this.destroyAggregation("items");};x.prototype._getItemByToken=function(i){return L.getItemBy(this.getItems(),i,"Token");};x.prototype._getItemByValue=function(y){var S=L.getSelectableItems(this.getItems());for(var i=0;i<S.length;i++){if(S[i].getText().toLowerCase()===y.toLowerCase()){return S[i];}}};x.prototype._handleItemToFocus=function(){if(this.isOpen()){return;}this.syncPickerContent();var i,y,z=s.byId(document.activeElement.id),S=this.getSelectedItems(),A=L.getSelectableItems(this.getItems()),B=this._getList(),F=B&&B.getItemNavigation(),G=this.getValue(),H=this.getPicker();if(z&&z.isA("sap.m.Token")){y=this._getItemByToken(z);}else if(G){y=this._getItemByValue(G);}if(!y){y=S.length?L.getItemByListItem(this.getItems(),this._getList().getSelectedItems()[0]):A[0];}i=L.getVisibleItems(this.getItems()).indexOf(y);if(F){F.setSelectedIndex(i);}else{this._bListItemNavigationInvalidated=true;this._iInitialItemFocus=i;}if(!y){H.setInitialFocus(this);}else{H.setInitialFocus(B);}};x.prototype.getAccessibilityInfo=function(){var i=this.getSelectedItems().map(function(z){return z.getText();}).join(" ");var y=C.prototype.getAccessibilityInfo.apply(this,arguments);y.type=s.getLibraryResourceBundle("sap.m").getText("ACC_CTR_TYPE_MULTICOMBO");y.description=(this.getValueDescriptionInfo()+" "+i).trim();return y;};x.prototype.getValueDescriptionInfo=function(){if(this.getValue()){return this.getValue();}return this._hasTokens()?"":sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("INPUTBASE_VALUE_EMPTY");};x.prototype._setIsClick=function(i){this._bIsClick=i;};x.prototype._getIsClick=function(){return this._bIsClick;};x.prototype._calculateSpaceForTokenizer=function(){if(this.getDomRef()){var S,i=this.getDomRef().getBoundingClientRect().width,y=this._calculateIconsSpace(),z=this.$().find(".sapMInputBaseInner"),A=["min-width","padding-right","padding-left"],B=A.reduce(function(F,G){return F+(parseInt(z.css(G))||0);},0);S=i-(y+B);S=S<0?0:S;return S+"px";}else{return null;}};x.prototype._syncInputWidth=function(i){var F=this.getDomRef('inner'),S,y;if(!F||(i&&!i.getDomRef())){return;}y=parseFloat(i.getDomRef().getBoundingClientRect().width.toFixed(2));S=this._calculateIconsSpace();F.style.width='calc(100% - '+parseFloat(S+y)+"px)";};x.prototype._handleNMoreAccessibility=function(){var i=u.getStaticId("sap.m","MULTICOMBOBOX_OPEN_NMORE_POPOVER"),y=this.getAggregation("tokenizer"),F=this.getFocusDomRef(),A=(F&&F.getAttribute("aria-describedby")),z=A?A.split(" "):[],N=z.indexOf(i),B=this.getEnabled(),G=!this.getEditable()&&y&&y.getHiddenTokensCount();if(G&&N===-1){z.push(i);B&&this.getFocusDomRef().setAttribute("aria-keyshortcuts","Enter");}else if(N!==-1&&!G){z.splice(N,1);this.getFocusDomRef().removeAttribute("aria-keyshortcuts");}if(F&&z.length){F.setAttribute("aria-describedby",z.join(" ").trim());}};x.prototype.applyShowItemsFilters=function(){this.syncPickerContent();m(this.getItems(),this.filterItems({value:this.getValue()||"_",items:this.getItems()}));this.manageSelectAllCheckBoxState();};x.prototype.showItems=function(F){var H=true,i=this.fnFilter;if(typeof F==="function"){this.syncPickerContent();this.setFilterFunction(F||function(){return true;});H=this.filterItems({value:this.getValue()||"_",items:this.getItems()}).items.length>0;this.setFilterFunction(i);}if(H){C.prototype.showItems.apply(this,arguments);}};x.prototype.createSelectAllHeaderToolbar=function(i){i=i||this._getList();if(!i||i.getHeaderToolbar()){return;}var S=new b({select:function(y){var z=y.getSource(),A=L.getSelectableItems(this.getItems()),B=this._getSelectedItemsOf(A);if(y.getParameter("selected")){var N=A.filter(function(F){return B.indexOf(F)===-1;});N.forEach(function(F){this.setSelection({item:F,items:N,selectAll:true,id:F.getId(),key:F.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false});},this);}else{B.forEach(function(F){this.removeSelection({item:F,items:B,selectAll:true,id:F.getId(),key:F.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false});},this);}z.focus();}.bind(this)});S.addEventDelegate(this._selectAllDelegate(),this);i.setHeaderToolbar(new c({content:S}).addStyleClass("sapMMultiComboBoxSelectAll")).setSticky(["HeaderToolbar"]);this.attachSelectionChange(this.manageSelectAllCheckBoxState.bind(this));};x.prototype.manageSelectAllCheckBoxState=function(){var S=this.getSelectAllCheckbox();if(!S){return;}var i=this.getItems(),y=this.getSelectedItems(),z=L.getSelectableItems(i).filter(function(A){return y.indexOf(A)>-1;}).length===L.getSelectableItems(i).length;S.setText(this._oRb.getText("MULTICOMBOBOX_SELECT_ALL_CHECKBOX",[y.length,L.getAllSelectableItems(i).length])).setSelected(z);};x.prototype.getSelectAllToolbar=function(){var i=this._getList();return i&&i.getHeaderToolbar();};x.prototype.getSelectAllCheckbox=function(){var S=this.getSelectAllToolbar();return S&&S.getContent()[0];};x.prototype._selectAllDelegate=function(){return{onsapdown:this.handleDownEvent,onsapup:function(i){i.preventDefault();if(this.getValueState()!==V.None){this._handleFormattedTextNav();return;}this.getFocusDomRef().focus();},onsaphome:this.handleHomeEvent,onsapend:this.handleEndEvent,onfocusin:function(){var i=this.getRenderer(),S=this.getSelectAllToolbar();S&&S.addStyleClass(i.CSS_CLASS_MULTICOMBOBOX+"SelectAllFocused");},onfocusout:function(){var i=this.getRenderer(),S=this.getSelectAllToolbar();S&&S.removeStyleClass(i.CSS_CLASS_MULTICOMBOBOX+"SelectAllFocused");},onsapshow:this.close,onsaphide:this.close};};x.prototype.focusSelectAll=function(){var S=this.getSelectAllCheckbox();S&&S.focus();};x.prototype.toggleSelectAllVisibility=function(S){var i=this.getSelectAllToolbar();if(i){i.setVisible(S);return;}S&&this.createSelectAllHeaderToolbar();};x.prototype.handleClearIconPress=function(){if(!(this.getEnabled()&&this.getEditable())){return;}if(this.getValue()!==""){this.setValue("");this._sOldInput="";this.bOpenedByKeyboardOrButton?this.clearFilter():this.close();this.setProperty("effectiveShowClearIcon",false);}};return x;});
