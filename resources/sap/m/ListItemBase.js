/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/DataType","sap/ui/events/KeyCodes","sap/ui/model/BindingMode","sap/ui/Device","sap/ui/core/Core","sap/ui/core/library","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/Icon","sap/ui/core/InvisibleText","sap/ui/core/theming/Parameters","./library","./Button","./CheckBox","./RadioButton","./ListItemBaseRenderer","sap/base/strings/capitalize","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/Selectors"],function(D,K,B,a,C,c,b,I,d,e,T,l,f,g,R,L,h,q){"use strict";var i=l.ListKeyboardMode;var j=l.ListMode;var k=l.ListType;var m=l.ButtonType;var M=c.MessageType;var n=b.extend("sap.m.ListItemBase",{metadata:{library:"sap.m",properties:{type:{type:"sap.m.ListType",group:"Misc",defaultValue:k.Inactive},visible:{type:"boolean",group:"Appearance",defaultValue:true},unread:{type:"boolean",group:"Misc",defaultValue:false},selected:{type:"boolean",defaultValue:false},counter:{type:"int",group:"Misc",defaultValue:null},highlight:{type:"string",group:"Appearance",defaultValue:"None"},highlightText:{type:"string",group:"Misc",defaultValue:""},navigated:{type:"boolean",group:"Appearance",defaultValue:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{tap:{deprecated:true},detailTap:{deprecated:true},press:{},detailPress:{}},designtime:"sap/m/designtime/ListItemBase.designtime",dnd:true}});n.getAccessibilityText=function(o,p){var r=C.getLibraryResourceBundle("sap.m");if(!o||!o.getVisible||!o.getVisible()){return p?r.getText("CONTROL_EMPTY"):"";}var A;if(o.getAccessibilityInfo){A=o.getAccessibilityInfo();}if(!A||!o.getAccessibilityInfo){A=this.getDefaultAccessibilityInfo(o.getDomRef());}A=q.extend({type:"",description:"",children:[]},A);var t=A.type+" "+A.description+" ",s=o.getTooltip_AsString();if(A.enabled===false){t+=r.getText("CONTROL_DISABLED")+" ";}if(A.editable===false){t+=r.getText("CONTROL_READONLY")+" ";}if(!A.type&&s&&t.indexOf(s)==-1){t=s+" "+t;}A.children.forEach(function(u){t+=n.getAccessibilityText(u)+" ";});t=t.trim();if(p&&!t){t=r.getText("CONTROL_EMPTY");}return t;};n.getDefaultAccessibilityInfo=function(o){if(!o){return null;}var t=[],N=window.Node,p=window.NodeFilter,r=document.createTreeWalker(o,p.SHOW_TEXT+p.SHOW_ELEMENT);while(r.nextNode()){var s=r.currentNode;if(s.nodeType===N.TEXT_NODE){var u=(s.nodeValue||"").trim();if(u){t.push(u);}}}return{description:t.join(" ")};};n.prototype.DetailIconURI=I.getIconURI("edit");n.prototype.NavigationIconURI=I.getIconURI("slim-arrow-right");n.prototype.TagName="li";n.prototype._bAnnounceNotSelected=true;n.prototype.init=function(){this._active=false;this._bGroupHeader=false;this._bNeedsHighlight=false;this._bNeedsNavigated=false;};n.prototype.onBeforeRendering=function(){this._oDomRef=this.getDomRef();};n.prototype.onAfterRendering=function(){if(this._oDomRef!==this.getDomRef()){this.informList("DOMUpdate",true);}this._oDomRef=undefined;this._checkHighlight();this._checkNavigated();};n.prototype.invalidate=function(){if(!this.bOutput){return;}b.prototype.invalidate.apply(this,arguments);};n.prototype.getBindingContextPath=function(s){var o=this.getList();if(o&&!s){s=(o.getBindingInfo("items")||{}).model;}var p=this.getBindingContext(s);if(p){return p.getPath();}};n.prototype.isSelectedBoundTwoWay=function(){var o=this.getBinding("selected");if(o&&o.getBindingMode()==B.TwoWay){return true;}};n.prototype.getList=function(){var p=this.getParent();if(p&&p.isA("sap.m.ListBase")){return p;}};n.prototype.getListProperty=function(p,F){var o=this.getList();if(o){p=h(p);return o["get"+p]();}return F;};n.prototype.informList=function(E,p,P){var o=this.getList();if(o){var s="onItem"+E;if(o[s]){o[s](this,p,P);}}};n.prototype.informSelectedChange=function(s){var o=this.getList();if(o){o.onItemSelectedChange(this,s);this.bSelectedDelayed=undefined;}else{this.bSelectedDelayed=s;}};n.prototype.getAccessibilityType=function(o){return o.getText("ACC_CTR_TYPE_OPTION");};n.prototype.getGroupAnnouncement=function(){return this.$().prevAll(".sapMGHLI:first").text();};n.prototype.getAccessibilityDescription=function(o){var O=[],t=this.getType(),H=this.getHighlight(),s=this.getTooltip_AsString();if(this.getSelected()){O.push(o.getText("LIST_ITEM_SELECTED"));}if(H!==M.None){var p=this.getHighlightText();if(H in M&&!p){p=o.getText("LIST_ITEM_STATE_"+H.toUpperCase());}O.push(p);}if(this.getUnread()&&this.getListProperty("showUnread")){O.push(o.getText("LIST_ITEM_UNREAD"));}if(this.getCounter()){O.push(o.getText("LIST_ITEM_COUNTER",this.getCounter()));}if(t==k.Navigation){O.push(o.getText("LIST_ITEM_NAVIGATION"));}else{if(t==k.Detail||t==k.DetailAndActive){O.push(o.getText("LIST_ITEM_DETAIL"));}if(t==k.Active||t==k.DetailAndActive){O.push(o.getText("LIST_ITEM_ACTIVE"));}}var G=this.getGroupAnnouncement()||"";if(G){O.push(G);}if(this.getContentAnnouncement){O.push((this.getContentAnnouncement(o)||"").trim());}if(s){O.push(s);}if(this._bAnnounceNotSelected&&this.isSelectable()&&!this.getSelected()){O.push(o.getText("LIST_ITEM_NOT_SELECTED"));}return O.join(" . ");};n.prototype.getAccessibilityInfo=function(){var o=C.getLibraryResourceBundle("sap.m");return{type:this.getAccessibilityType(o),description:this.getAccessibilityDescription(o),focusable:true};};n.prototype.getMode=function(){return this.getListProperty("mode","");};n.prototype.updateAccessibilityState=function(A){var t=this.$();if(!t.length){return;}var $=t.parent().children(".sapMLIB");t.attr(q.extend({"aria-setsize":$.length,"aria-posinset":$.index(t)+1},A));};n.prototype.getDeleteControl=function(o){if(!o||this._oDeleteControl){return this._oDeleteControl;}if(!this.DeleteIconURI){n.prototype.DeleteIconURI=I.getIconURI(T.get({name:"_sap_m_ListItemBase_DeleteIcon"})||"decline");}this._oDeleteControl=new f({id:this.getId()+"-imgDel",icon:this.DeleteIconURI,type:m.Transparent,tooltip:C.getLibraryResourceBundle("sap.m").getText("LIST_ITEM_DELETE")}).addStyleClass("sapMLIBIconDel sapMLIBSelectD").setParent(this,null,true).attachPress(function(E){this.informList("Delete");},this);this._oDeleteControl._bExcludeFromTabChain=true;this._oDeleteControl.useEnabledPropagator(false);return this._oDeleteControl;};n.prototype.onThemeChanged=function(){n.prototype.DeleteIconURI=I.getIconURI(T.get({name:"_sap_m_ListItemBase_DeleteIcon"}));if(this._oDeleteControl){this._oDeleteControl.setIcon(this.DeleteIconURI);}};n.prototype.getDetailControl=function(o){if(!o||this._oDetailControl){return this._oDetailControl;}this._oDetailControl=new f({id:this.getId()+"-imgDet",icon:this.DetailIconURI,type:m.Transparent,tooltip:C.getLibraryResourceBundle("sap.m").getText("LIST_ITEM_EDIT")}).addStyleClass("sapMLIBType sapMLIBIconDet").setParent(this,null,true).attachPress(function(){this.fireDetailTap();this.fireDetailPress();},this);this._oDetailControl._bExcludeFromTabChain=true;this._oDetailControl.useEnabledPropagator(false);return this._oDetailControl;};n.prototype.getNavigationControl=function(o){if(!o||this._oNavigationControl){return this._oNavigationControl;}this._oNavigationControl=new d({id:this.getId()+"-imgNav",src:this.NavigationIconURI,useIconTooltip:false,noTabStop:true}).setParent(this,null,true).addStyleClass("sapMLIBType sapMLIBImgNav");return this._oNavigationControl;};n.prototype.getSingleSelectControl=function(o){if(!o||this._oSingleSelectControl){o&&this._oSingleSelectControl.setSelected(this.getSelected());return this._oSingleSelectControl;}this._oSingleSelectControl=new R({id:this.getId()+"-selectSingle",groupName:this.getListProperty("id")+"_selectGroup",activeHandling:false,selected:this.getSelected(),ariaLabelledBy:e.getStaticId("sap.m","LIST_ITEM_SELECTION")}).addStyleClass("sapMLIBSelectS").setParent(this,null,true).setTabIndex(-1).attachSelect(function(E){var s=E.getParameter("selected");this.setSelected(s);this.informList("Select",s);},this);this._oSingleSelectControl.useEnabledPropagator(false);return this._oSingleSelectControl;};n.prototype.getMultiSelectControl=function(o){if(!o||this._oMultiSelectControl){o&&this._oMultiSelectControl.setSelected(this.getSelected());return this._oMultiSelectControl;}this._oMultiSelectControl=new g({id:this.getId()+"-selectMulti",activeHandling:false,selected:this.getSelected(),ariaLabelledBy:e.getStaticId("sap.m","LIST_ITEM_SELECTION")}).addStyleClass("sapMLIBSelectM").setParent(this,null,true).setTabIndex(-1).addEventDelegate({onkeydown:function(E){this.informList("KeyDown",E);},onkeyup:function(E){this.informList("KeyUp",E);}},this).attachSelect(function(E){var s=E.getParameter("selected");this.setSelected(s);this.informList("Select",s);},this);this._oMultiSelectControl.useEnabledPropagator(false);return this._oMultiSelectControl;};n.prototype.getModeControl=function(o){var s=this.getMode();if(!s||s==j.None){return;}if(s==j.Delete){return this.getDeleteControl(o);}if(s==j.MultiSelect){return this.getMultiSelectControl(o);}return this.getSingleSelectControl(o);};n.prototype.getTypeControl=function(o){var t=this.getType();if(t==k.Detail||t==k.DetailAndActive){return this.getDetailControl(o);}if(t==k.Navigation){return this.getNavigationControl(o);}};n.prototype.destroyControls=function(o){o.forEach(function(s){s="_o"+s+"Control";if(this[s]){this[s].destroy("KeepDom");this[s]=null;}},this);};n.prototype.isActionable=function(){return this.isIncludedIntoSelection()||(this.getType()!=k.Inactive&&this.getType()!=k.Detail);};n.prototype.exit=function(){this._oDomRef=null;this._oLastFocused=null;this._checkHighlight(false);this._checkNavigated(false);this.setActive(false);this.destroyControls(["Delete","SingleSelect","MultiSelect","Detail","Navigation"]);};n.prototype.setHighlight=function(v){if(v==null){v=M.None;}else if(!D.getType("sap.ui.core.MessageType").isValid(v)&&!D.getType("sap.ui.core.IndicationColor").isValid(v)){throw new Error('"'+v+'" is not a value of the enums sap.ui.core.MessageType or sap.ui.core.IndicationColor for property "highlight" of '+this);}return this.setProperty("highlight",v);};n.prototype.isSelectable=function(){var s=this.getMode();return!(s==j.None||s==j.Delete);};n.prototype.getSelected=function(){if(this.isSelectable()){return this.getProperty("selected");}return false;};n.prototype.isSelected=n.prototype.getSelected;n.prototype.setSelected=function(s,o){s=this.validateProperty("selected",s);if(!this.isSelectable()||s==this.getSelected()){return this;}if(!o){this.informSelectedChange(s);}var S=this.getModeControl();if(S){S.setSelected(s);}this.updateSelectedDOM(s,this.$());this.setProperty("selected",s,true);return this;};n.prototype.updateSelectedDOM=function(s,t){t.toggleClass("sapMLIBSelected",s);if(t.attr("role")!=="listitem"){t.attr("aria-selected",s);}};n.prototype.setParent=function(p){if(!p){this.informList("Removed");}b.prototype.setParent.apply(this,arguments);this.informList("Inserted",this.bSelectedDelayed);return this;};n.prototype.setBindingContext=function(){b.prototype.setBindingContext.apply(this,arguments);this.informList("BindingContextSet");return this;};n.prototype.isGroupHeader=function(){return this._bGroupHeader;};n.prototype.setGroupedItem=function(o){this._aGroupedItems=this._aGroupedItems||[];this._aGroupedItems.push(o.getId());};n.prototype.getGroupedItems=function(){return this._aGroupedItems;};n.prototype.isIncludedIntoSelection=function(){if(!this.isSelectable()){return false;}var s=this.getMode();return s==j.SingleSelectMaster||(this.getListProperty("includeItemInSelection")&&(s==j.SingleSelectLeft||s==j.SingleSelect||s==j.MultiSelect));};n.prototype._checkHighlight=function(N){if(N==undefined){N=(this.getVisible()&&this.getHighlight()!=M.None);}if(this._bNeedsHighlight!=N){this._bNeedsHighlight=N;this.informList("HighlightChange",N);}};n.prototype._checkNavigated=function(N){if(N==undefined){N=(this.getVisible()&&this.getNavigated());}if(this._bNeedsNavigated!=N){this._bNeedsNavigated=N;this.informList("NavigatedChange",N);}};n.prototype.hasActiveType=function(){var t=this.getType();return(t==k.Active||t==k.Navigation||t==k.DetailAndActive);};n.prototype.setActive=function(A){if(A==this._active){return this;}if(A&&this.getListProperty("activeItem")){return this;}var t=this.$();this._active=A;this._activeHandling(t);if(this.getType()==k.Navigation){this._activeHandlingNav(t);}if(A){this._activeHandlingInheritor(t);}else{this._inactiveHandlingInheritor(t);}this.informList("ActiveChange",A);};n.detectTextSelection=function(o){var s=window.getSelection(),t=s.toString().replace("\n","");return t&&q.contains(o,s.focusNode);};n.prototype.ontap=function(E){if(this._eventHandledByControl){return E.setMarked();}if(n.detectTextSelection(this.getDomRef())){return;}if(this.isIncludedIntoSelection()){if(this.getMode()==j.MultiSelect){this.setSelected(!this.getSelected());this.informList("Select",this.getSelected());}else if(!this.getSelected()){this.setSelected(true);this.informList("Select",true);}}else if(this.hasActiveType()){window.clearTimeout(this._timeoutIdStart);window.clearTimeout(this._timeoutIdEnd);this.setActive(true);if(a.os.ios){this.focus();}setTimeout(function(){this.setActive(false);}.bind(this),180);setTimeout(function(){this.fireTap();this.firePress();}.bind(this),0);}this.informList("Press",E.srcControl);};n.prototype.ontouchstart=function(E){this._eventHandledByControl=E.isMarked();var t=E.targetTouches[0];this._touchedY=t.clientY;this._touchedX=t.clientX;if(this._eventHandledByControl||E.touches.length!=1||!this.hasActiveType()){if(this.getListProperty("includeItemInSelection")&&this.getList()._mRangeSelection){E.preventDefault();}return;}this._timeoutIdStart=setTimeout(function(){this.setActive(true);}.bind(this),100);};n.prototype.ontouchmove=function(E){if((this._active||this._timeoutIdStart)&&(Math.abs(this._touchedY-E.targetTouches[0].clientY)>10||Math.abs(this._touchedX-E.targetTouches[0].clientX)>10)){clearTimeout(this._timeoutIdStart);this._timeoutIdStart=null;this._timeoutIdEnd=null;this.setActive(false);}};n.prototype.ontouchend=function(E){if(this.hasActiveType()){this._timeoutIdEnd=setTimeout(function(){this.setActive(false);}.bind(this),100);}};n.prototype.ontouchcancel=n.prototype.ontouchend;n.prototype.ondragend=n.prototype.ontouchend;n.prototype._activeHandlingNav=function(){};n.prototype._activeHandlingInheritor=function(){};n.prototype._inactiveHandlingInheritor=function(){};n.prototype._activeHandling=function(t){t.toggleClass("sapMLIBActive",this._active);if(a.system.desktop&&this.isActionable()){t.toggleClass("sapMLIBHoverable",!this._active);}};n.prototype.onsapspace=function(E){if(E.srcControl!==this){return;}E.preventDefault();if(E.isMarked()||!this.isSelectable()){return;}if(this.getMode()==j.MultiSelect){this.setSelected(!this.getSelected());this.informList("Select",this.getSelected());}else if(!this.getSelected()){this.setSelected(true);this.informList("Select",true);}E.setMarked();};n.prototype.onsapenter=function(E){var o=this.getList();if(E.isMarked()||!o){return;}if(E.srcControl!==this&&o.getKeyboardMode()==i.Edit){o.setKeyboardMode(i.Navigation);this._switchFocus(E);return;}if(E.srcControl!==this){return;}if(this.isIncludedIntoSelection()){this.onsapspace(E);}else if(this.hasActiveType()){E.setMarked();this.setActive(true);setTimeout(function(){this.setActive(false);}.bind(this),180);setTimeout(function(){this.fireTap();this.firePress();}.bind(this),0);}o.onItemPress(this,E.srcControl);};n.prototype.onsapdelete=function(E){if(E.isMarked()||E.srcControl!==this||this.getMode()!=j.Delete){return;}this.informList("Delete");E.preventDefault();E.setMarked();};n.prototype._switchFocus=function(E){var o=this.getList();if(!o){return;}var t=this.getTabbables();if(E.srcControl!==this){o._iLastFocusPosOfItem=t.index(E.target);this.focus();}else if(t.length){var F=o._iLastFocusPosOfItem||0;F=t[F]?F:-1;t.eq(F).trigger("focus");}E.preventDefault();E.setMarked();};n.prototype.onkeydown=function(E){if(E.isMarked()){return;}if(E.which==K.F7){this._switchFocus(E);return;}if(E.which==K.F2){if(E.srcControl===this&&this.getType().indexOf("Detail")==0&&this.hasListeners("detailPress")||this.hasListeners("detailTap")){this.fireDetailTap();this.fireDetailPress();E.preventDefault();E.setMarked();}else{var o=this.getList();if(o){this.$().prop("tabIndex",-1);o.setKeyboardMode(o.getKeyboardMode()==i.Edit?i.Navigation:i.Edit);this._switchFocus(E);}}}if(E.srcControl!==this){return;}this.informList("KeyDown",E);};n.prototype.onkeyup=function(E){if(E.isMarked()||E.srcControl!==this){return;}this.informList("KeyUp",E);};n.prototype.onsapupmodifiers=function(E){if(E.isMarked()){return;}this.informList("UpDownModifiers",E,-1);};n.prototype.onsapdownmodifiers=function(E){if(E.isMarked()){return;}this.informList("UpDownModifiers",E,1);};n.prototype.getTabbables=function(){return this.$().find(":sapTabbable");};n.prototype.onsaptabnext=function(E){var o=this.getList();if(!o||E.isMarked()||o.getKeyboardMode()==i.Edit){return;}var p=this.getTabbables().get(-1)||this.getDomRef();if(E.target===p){o.forwardTab(true);E.setMarked();}};n.prototype.onsaptabprevious=function(E){var o=this.getList();if(!o||E.isMarked()||o.getKeyboardMode()==i.Edit){return;}if(E.target===this.getDomRef()){o.forwardTab(false);E.setMarked();}};n.prototype.onfocusin=function(E){var o=this.getList();if(!o||E.isMarked()){return;}this.informList("FocusIn",E.srcControl);E.setMarked();if(E.srcControl===this){return;}if(o.getKeyboardMode()==i.Edit||!q(E.target).is(":sapFocusable")){return;}setTimeout(o["setItemFocusable"].bind(o,this),0);};n.prototype.onsapup=function(E){if(E.isMarked()||E.srcControl===this||E.target instanceof HTMLInputElement||E.target instanceof HTMLTextAreaElement){return;}this.informList("ArrowUpDown",E);};n.prototype.oncontextmenu=function(E){if(this._bGroupHeader){return;}if(q(document.activeElement).is(":focusable")&&document.activeElement!==this.getDomRef()&&E.srcControl!==this.getModeControl()){return;}this.informList("ContextMenu",E);};n.prototype.onsapdown=n.prototype.onsapup;return n;});
