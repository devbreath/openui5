/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/events/KeyCodes","sap/ui/Device","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/InvisibleText","sap/ui/core/LabelEnablement","sap/ui/core/delegate/ItemNavigation","./library","./InstanceManager","./GrowingEnablement","./GroupHeaderListItem","./ListItemBase","./ListBaseRenderer","sap/base/strings/capitalize","sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/core/InvisibleMessage","sap/ui/dom/jquery/control","sap/ui/dom/jquery/Selectors","sap/ui/dom/jquery/Aria"],function(K,D,C,a,I,L,b,l,c,G,d,f,g,h,q,j,k){"use strict";var m=l.ListType;var n=l.ListKeyboardMode;var o=l.ListGrowingDirection;var S=l.SwipeDirection;var p=l.ListSeparators;var r=l.ListMode;var s=l.ListHeaderDesign;var t=l.Sticky;var M=l.MultiSelectMode;var u=a.extend("sap.m.ListBase",{metadata:{library:"sap.m",dnd:true,properties:{inset:{type:"boolean",group:"Appearance",defaultValue:false},headerText:{type:"string",group:"Misc",defaultValue:null},headerDesign:{type:"sap.m.ListHeaderDesign",group:"Appearance",defaultValue:s.Standard,deprecated:true},footerText:{type:"string",group:"Misc",defaultValue:null},mode:{type:"sap.m.ListMode",group:"Behavior",defaultValue:r.None},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},includeItemInSelection:{type:"boolean",group:"Behavior",defaultValue:false},showUnread:{type:"boolean",group:"Misc",defaultValue:false},noDataText:{type:"string",group:"Misc",defaultValue:null},showNoData:{type:"boolean",group:"Misc",defaultValue:true},enableBusyIndicator:{type:"boolean",group:"Behavior",defaultValue:true},modeAnimationOn:{type:"boolean",group:"Misc",defaultValue:true},showSeparators:{type:"sap.m.ListSeparators",group:"Appearance",defaultValue:p.All},swipeDirection:{type:"sap.m.SwipeDirection",group:"Misc",defaultValue:S.Both},growing:{type:"boolean",group:"Behavior",defaultValue:false},growingThreshold:{type:"int",group:"Misc",defaultValue:20},growingTriggerText:{type:"string",group:"Appearance",defaultValue:null},growingScrollToLoad:{type:"boolean",group:"Behavior",defaultValue:false},growingDirection:{type:"sap.m.ListGrowingDirection",group:"Behavior",defaultValue:o.Downwards},rememberSelections:{type:"boolean",group:"Behavior",defaultValue:true},keyboardMode:{type:"sap.m.ListKeyboardMode",group:"Behavior",defaultValue:n.Navigation},sticky:{type:"sap.m.Sticky[]",group:"Appearance"},multiSelectMode:{type:"sap.m.MultiSelectMode",group:"Behavior",defaultValue:M.Default}},defaultAggregation:"items",aggregations:{items:{type:"sap.m.ListItemBase",multiple:true,singularName:"item",bindable:"bindable",selector:"#{id} .sapMListItems",dnd:true},swipeContent:{type:"sap.ui.core.Control",multiple:false},headerToolbar:{type:"sap.m.Toolbar",multiple:false},infoToolbar:{type:"sap.m.Toolbar",multiple:false},contextMenu:{type:"sap.ui.core.IContextMenu",multiple:false},_messageStrip:{type:"sap.m.MessageStrip",multiple:false,visibility:"hidden"},noData:{type:"sap.ui.core.Control",multiple:false,altTypes:["string"]}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{select:{deprecated:true,parameters:{listItem:{type:"sap.m.ListItemBase"}}},selectionChange:{parameters:{listItem:{type:"sap.m.ListItemBase"},listItems:{type:"sap.m.ListItemBase[]"},selected:{type:"boolean"},selectAll:{type:"boolean"}}},"delete":{parameters:{listItem:{type:"sap.m.ListItemBase"}}},swipe:{allowPreventDefault:true,parameters:{listItem:{type:"sap.m.ListItemBase"},swipeContent:{type:"sap.ui.core.Control"},srcControl:{type:"sap.ui.core.Control"},swipeDirection:{type:"sap.m.SwipeDirection"}}},growingStarted:{deprecated:true,parameters:{actual:{type:"int"},total:{type:"int"}}},growingFinished:{deprecated:true,parameters:{actual:{type:"int"},total:{type:"int"}}},updateStarted:{parameters:{reason:{type:"string"},actual:{type:"int"},total:{type:"int"}}},updateFinished:{parameters:{reason:{type:"string"},actual:{type:"int"},total:{type:"int"}}},itemPress:{parameters:{listItem:{type:"sap.m.ListItemBase"},srcControl:{type:"sap.ui.core.Control"}}},beforeOpenContextMenu:{allowPreventDefault:true,parameters:{listItem:{type:"sap.m.ListItemBase"}}}},designtime:"sap/m/designtime/ListBase.designtime"}});u.prototype.bAnnounceDetails=true;u.getInvisibleText=function(){if(!this.oInvisibleText){this.oInvisibleText=new I().toStatic();}return this.oInvisibleText;};u.prototype.sNavItemClass="sapMLIB";u.prototype.init=function(){this._aNavSections=[];this._aSelectedPaths=[];this._iItemNeedsHighlight=0;this._iItemNeedsNavigated=0;this._bItemsBeingBound=false;this._bSkippedInvalidationOnRebind=false;this.data("sap-ui-fastnavgroup","true",true);};u.prototype.onBeforeRendering=function(){this._bRendering=true;this._bActiveItem=false;this._aNavSections=[];this._removeSwipeContent();};u.prototype.onAfterRendering=function(){this._bRendering=false;this._sLastMode=this.getMode();if(D.system.desktop){this._startItemNavigation(true);}};u.prototype.exit=function(){this._aNavSections=[];this._aSelectedPaths=[];this._destroyGrowingDelegate();this._destroyItemNavigation();};u.prototype.refreshItems=function(R){if(this._oGrowingDelegate){this._oGrowingDelegate.refreshItems(R);}else{if(!this._bReceivingData){this._updateStarted(R);this._bReceivingData=true;}this.refreshAggregation("items");}};u.prototype.updateItems=function(R,e){if(e&&e.detailedReason==="AddVirtualContext"){v(this);if(this._oGrowingDelegate){this._oGrowingDelegate.reset(true);}return;}else if(e&&e.detailedReason==="RemoveVirtualContext"){w(this);return;}if(this._bSkippedInvalidationOnRebind&&this.getBinding("items").getLength()===0){this.invalidate();}if(this._oGrowingDelegate){this._oGrowingDelegate.updateItems(R);}else{if(this._bReceivingData){this._bReceivingData=false;}else{this._updateStarted(R);}this.updateAggregation("items");this._updateFinished();}this._bSkippedInvalidationOnRebind=false;};function v(e){var B=e.getBinding("items");var i=e.getBindingInfo("items");var y=e.getGrowing()?e.getGrowingThreshold():i.length;var z=e.getGrowing()||!i.startIndex?0:i.startIndex;var V=B.getContexts(z,y)[0];w(e);e._oVirtualItem=G.createItem(V,i,"virtual");e.addAggregation("dependents",e._oVirtualItem,true);}function w(e){if(e._oVirtualItem){e._oVirtualItem.destroy();delete e._oVirtualItem;}}u.prototype.setBindingContext=function(e,i){var y=(this.getBindingInfo("items")||{}).model;if(y===i){this._resetItemsBinding();}return a.prototype.setBindingContext.apply(this,arguments);};u.prototype.bindAggregation=function(N){this._bItemsBeingBound=N==="items";w(this);a.prototype.bindAggregation.apply(this,arguments);this._bItemsBeingBound=false;return this;};u.prototype._bindAggregation=function(N,B){function e(B,E,H){B.events=B.events||{};if(!B.events[E]){B.events[E]=H;}else{var O=B.events[E];B.events[E]=function(){H.apply(this,arguments);O.apply(this,arguments);};}}if(N==="items"){this._resetItemsBinding();e(B,"dataRequested",this._onBindingDataRequestedListener.bind(this));e(B,"dataReceived",this._onBindingDataReceivedListener.bind(this));}a.prototype._bindAggregation.call(this,N,B);};u.prototype._onBindingDataRequestedListener=function(e){this._showBusyIndicator();if(this._dataReceivedHandlerId!=null){clearTimeout(this._dataReceivedHandlerId);delete this._dataReceivedHandlerId;}};u.prototype._onBindingDataReceivedListener=function(e){if(this._dataReceivedHandlerId!=null){clearTimeout(this._dataReceivedHandlerId);delete this._dataReceivedHandlerId;}this._dataReceivedHandlerId=setTimeout(function(){this._hideBusyIndicator();delete this._dataReceivedHandlerId;}.bind(this),0);if(this._oGrowingDelegate){this._oGrowingDelegate._onBindingDataReceivedListener(e);}};u.prototype.destroyItems=function(e){if(!this.getItems(true).length){return this;}this.destroyAggregation("items","KeepDom");if(!e){if(this._bItemsBeingBound){this._bSkippedInvalidationOnRebind=true;}else{this.invalidate();}}return this;};u.prototype.getItems=function(R){if(R){return this.mAggregations["items"]||[];}return this.getAggregation("items",[]);};u.prototype.getId=function(e){var i=this.sId;return e?i+"-"+e:i;};u.prototype.setGrowing=function(e){e=!!e;if(this.getGrowing()!=e){this.setProperty("growing",e,!e);if(e){this._oGrowingDelegate=new G(this);}else if(this._oGrowingDelegate){this._oGrowingDelegate.destroy();this._oGrowingDelegate=null;}}return this;};u.prototype.setGrowingThreshold=function(T){return this.setProperty("growingThreshold",T,true);};u.prototype.setEnableBusyIndicator=function(e){this.setProperty("enableBusyIndicator",e,true);if(!this.getEnableBusyIndicator()){this._hideBusyIndicator();}return this;};u.prototype.setNoData=function(N){this.setAggregation("noData",N,true);if(typeof N==="string"){this.$("nodata-text").text(N);}else if(N){this.invalidate();}else if(!N){this.$("nodata-text").text(this.getNoDataText());}return this;};u.prototype.setNoDataText=function(N){this.setProperty("noDataText",N,true);if(!this.getNoData()){this.$("nodata-text").text(this.getNoDataText());}return this;};u.prototype.getNoDataText=function(e){if(e&&this._bBusy){return"";}var N=this.getProperty("noDataText");N=N||C.getLibraryResourceBundle("sap.m").getText("LIST_NO_DATA");return N;};u.prototype.getSelectedItem=function(){var e=this.getItems(true);for(var i=0;i<e.length;i++){if(e[i].getSelected()){return e[i];}}return null;};u.prototype.setSelectedItem=function(e,i,F){if(this.indexOfItem(e)<0){j.warning("setSelectedItem is called without valid ListItem parameter on "+this);return;}if(this._bSelectionMode){e.setSelected((i===undefined)?true:!!i);F&&this._fireSelectionChangeEvent([e]);}};u.prototype.getSelectedItems=function(){return this.getItems(true).filter(function(i){return i.getSelected();});};u.prototype.setSelectedItemById=function(i,e){var y=C.byId(i);return this.setSelectedItem(y,e);};u.prototype.getSelectedContexts=function(A){var B=this.getBindingInfo("items"),e=(B||{}).model,i=this.getModel(e);if(!B||!i){return[];}if(A&&this.getRememberSelections()){return this._aSelectedPaths.map(function(P){return i.getContext(P);});}return this.getSelectedItems().map(function(y){return y.getBindingContext(e);});};u.prototype.removeSelections=function(A,F,e){var i=[];this._oSelectedItem=null;A&&(this._aSelectedPaths=[]);this.getItems(true).forEach(function(y){if(!y.getSelected()){return;}if(e&&y.isSelectedBoundTwoWay()){return;}y.setSelected(false,true);i.push(y);!A&&this._updateSelectedPaths(y);},this);if(F&&i.length){this._fireSelectionChangeEvent(i);}return this;};u.prototype.selectAll=function(F){if(this.getMode()!="MultiSelect"||this.getMultiSelectMode()==M.ClearAll){return this;}var e=[];this.getItems(true).forEach(function(i){if(!i.getSelected()){i.setSelected(true,true);e.push(i);this._updateSelectedPaths(i);}},this);if(F&&e.length){this._fireSelectionChangeEvent(e,F);}return this;};u.prototype.getLastMode=function(e){return this._sLastMode;};u.prototype.setMode=function(e){e=this.validateProperty("mode",e);var O=this.getMode();if(O==e){return this;}this._bSelectionMode=e.indexOf("Select")>-1;if(!this._bSelectionMode){this.removeSelections(true);}else{var i=this.getSelectedItems();if(i.length>1){this.removeSelections(true);}else if(O===r.MultiSelect){this._oSelectedItem=i[0];}}return this.setProperty("mode",e);};u.prototype.getGrowingInfo=function(){return this._oGrowingDelegate?this._oGrowingDelegate.getInfo():null;};u.prototype.setRememberSelections=function(R){this.setProperty("rememberSelections",R,true);!this.getRememberSelections()&&(this._aSelectedPaths=[]);return this;};u.prototype.setSelectedContextPaths=function(e){this._aSelectedPaths=e||[];};u.prototype.getSelectedContextPaths=function(A){if(!A||(A&&this.getRememberSelections())){return this._aSelectedPaths.slice(0);}return this.getSelectedItems().map(function(i){return i.getBindingContextPath();});};u.prototype.isAllSelectableSelected=function(){if(this.getMode()!=r.MultiSelect){return false;}var i=this.getItems(true),e=this.getSelectedItems().length,y=i.filter(function(z){return z.isSelectable();}).length;return(i.length>0)&&(e==y);};u.prototype.getVisibleItems=function(){return this.getItems(true).filter(function(i){return i.getVisible();});};u.prototype.getActiveItem=function(){return this._bActiveItem;};u.prototype.onItemDOMUpdate=function(e){if(!this._bRendering&&this.bOutput){this._startItemNavigation(true);}var V=this.getVisibleItems().length>0;if(!V&&!this._bInvalidatedForNoData){this.invalidate();this._bInvalidatedForNoData=true;}else if(V&&this._bInvalidatedForNoData){this.invalidate();this._bInvalidatedForNoData=false;}};u.prototype.onItemActiveChange=function(e,A){this._bActiveItem=A;};u.prototype.onItemHighlightChange=function(i,N){this._iItemNeedsHighlight+=(N?1:-1);if(this._iItemNeedsHighlight==1&&N){this.$("listUl").addClass("sapMListHighlight");}else if(this._iItemNeedsHighlight==0){this.$("listUl").removeClass("sapMListHighlight");}};u.prototype.onItemNavigatedChange=function(i,N){this._iItemNeedsNavigated+=(N?1:-1);if(this._iItemNeedsNavigated==1&&N){this.$("listUl").addClass("sapMListNavigated");}else if(this._iItemNeedsNavigated==0){this.$("listUl").removeClass("sapMListNavigated");}};u.prototype.onItemSelectedChange=function(e,i){if(this.getMode()==r.MultiSelect){this._updateSelectedPaths(e,i);return;}if(i){this._aSelectedPaths=[];this._oSelectedItem&&this._oSelectedItem.setSelected(false,true);this._oSelectedItem=e;}else if(this._oSelectedItem===e){this._oSelectedItem=null;}this._updateSelectedPaths(e,i);};u.prototype.getItemsContainerDomRef=function(){return this.getDomRef("listUl");};u.prototype.getStickyFocusOffset=function(){return 0;};u.prototype.checkGrowingFromScratch=function(){};u.prototype.onBeforePageLoaded=function(e,i){this._fireUpdateStarted(i,e);this.fireGrowingStarted(e);};u.prototype.onAfterPageLoaded=function(e,i){this._fireUpdateFinished(e);this.fireGrowingFinished(e);};u.prototype.addNavSection=function(i){this._aNavSections.push(i);return i;};u.prototype.getMaxItemsCount=function(){var B=this.getBinding("items");if(B&&B.getLength){return B.getLength()||0;}return this.getItems(true).length;};u.prototype.shouldRenderItems=function(){return true;};u.prototype.shouldGrowingSuppressInvalidation=function(){return true;};u.prototype._resetItemsBinding=function(){if(this.isBound("items")){this._bUpdating=false;this._bReceivingData=false;this.removeSelections(true,false,true);this._oGrowingDelegate&&this._oGrowingDelegate.reset();this._hideBusyIndicator();if(this._oItemNavigation){this._oItemNavigation.iFocusedIndex=-1;}}};u.prototype._updateStarted=function(R){if(!this._bReceivingData&&!this._bUpdating){this._bUpdating=true;this._fireUpdateStarted(R);}};u.prototype._fireUpdateStarted=function(R,i){this._sUpdateReason=h(R||"Refresh");this.fireUpdateStarted({reason:this._sUpdateReason,actual:i?i.actual:this.getItems(true).length,total:i?i.total:this.getMaxItemsCount()});};u.prototype.onThemeChanged=function(){if(this._oGrowingDelegate){this._oGrowingDelegate._updateTrigger();}};u.prototype._updateFinished=function(){if(!this._bReceivingData&&this._bUpdating){this._fireUpdateFinished();this._bUpdating=false;}};u.prototype._fireUpdateFinished=function(i){this._hideBusyIndicator();setTimeout(function(){this._bItemNavigationInvalidated=true;this.fireUpdateFinished({reason:this._sUpdateReason,actual:i?i.actual:this.getItems(true).length,total:i?i.total:this.getMaxItemsCount()});}.bind(this),0);};u.prototype._showBusyIndicator=function(){if(this.getEnableBusyIndicator()&&!this.getBusy()&&!this._bBusy){this._bBusy=true;this.setBusy(true,"listUl");}};u.prototype._hideBusyIndicator=function(){if(this._bBusy){this._bBusy=false;this.setBusy(false,"listUl");}};u.prototype.setBusy=function(B,e){if(this.getBusy()==B){return this;}a.prototype.setBusy.apply(this,arguments);if(!B||!window.IntersectionObserver){clearTimeout(this._iBusyTimer);return this;}this._iBusyTimer=setTimeout(function(){var i=this.getDomRef(e);var A=this.getDomRef("busyIndicator");var y=l.getScrollDelegate(this,true);if(!i||!A||!y){return;}var z=new window.IntersectionObserver(function(E){z.disconnect();var F=E.pop();var R=F.intersectionRatio;if(R<=0||R>=1){return;}var H=A.firstChild.style;if(F.intersectionRect.height>=F.rootBounds.height){H.position="sticky";}else{H.top=((F.boundingClientRect.top<0?1-R:0)+(R/2))*100+"%";}},{root:y.getContainerDomRef()});z.observe(i);}.bind(this),this.getBusyIndicatorDelay());return this;};u.prototype.onItemBindingContextSet=function(i){if(!this._bSelectionMode||!this.getRememberSelections()||!this.isBound("items")){return;}if(i.isSelectedBoundTwoWay()){return;}var P=i.getBindingContextPath();if(P){var e=(this._aSelectedPaths.indexOf(P)>-1);i.setSelected(e);}};u.prototype.onItemRemoved=function(i){i._bGroupHeader=false;if(this._oLastGroupHeader==i){this._oLastGroupHeader=null;}if(this._oSelectedItem==i){this._oSelectedItem=null;}};u.prototype.onItemInserted=function(i,e){if(this._oLastGroupHeader&&!i.isGroupHeader()){this._oLastGroupHeader.setGroupedItem(i);}if(e){this.onItemSelectedChange(i,true);}if(!this._bSelectionMode||!this._aSelectedPaths.length||!this.getRememberSelections()||!this.isBound("items")||i.isSelectedBoundTwoWay()||i.getSelected()){return;}var P=i.getBindingContextPath();if(P&&this._aSelectedPaths.indexOf(P)>-1){i.setSelected(true);}};u.prototype.onItemSelect=function(e,y){var z=this.getMode();if(this._mRangeSelection){if(!this._mRangeSelection.selected){this._fireSelectionChangeEvent([e]);this._mRangeSelection.index=this.getVisibleItems().indexOf(e);this._mRangeSelection.selected=y;return;}if(!y){e.setSelected(true);return;}var A=this.indexOfItem(e),B=this.getItems(),E,F,H=[],J;if(A<this._mRangeSelection.index){E=this._mRangeSelection.index-A;J=-1;}else{E=A-this._mRangeSelection.index;J=1;}for(var i=1;i<=E;i++){F=B[this._mRangeSelection.index+(i*J)];if(F.isSelectable()&&F.getVisible()&&!F.getSelected()){F.setSelected(true);H.push(F);}else if(F===e){H.push(F);}}this._fireSelectionChangeEvent(H);return;}if(z===r.MultiSelect||(this._bSelectionMode&&y)){this._fireSelectionChangeEvent([e]);if(this.getAriaRole()==="list"&&document.activeElement===e.getDomRef()){var R=C.getLibraryResourceBundle("sap.m");k.getInstance().announce(y?R.getText("LIST_ITEM_SELECTED"):R.getText("LIST_ITEM_NOT_SELECTED"),"Assertive");}}};u.prototype._fireSelectionChangeEvent=function(e,i){var y=e&&e[0];if(!y){return;}this.fireSelectionChange({listItem:y,listItems:e,selected:y.getSelected(),selectAll:!!i});if(this.getGrowing()){this._bSelectAll=i;}this.fireSelect({listItem:y});};u.prototype.onItemDelete=function(e){this.fireDelete({listItem:e});};u.prototype.onItemPress=function(e,i){if(e.getType()==m.Inactive){return;}setTimeout(function(){this.fireItemPress({listItem:e,srcControl:i});}.bind(this),0);};u.prototype.onItemKeyDown=function(i,e){if(!e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||this.getMode()!==r.MultiSelect||!i.isSelectable()||e.which===K.F6){if(this._mRangeSelection){this._mRangeSelection=null;}return;}var V=this.getVisibleItems(),H=V.some(function(y){return!!y.getSelected();});if(!H){return;}if(!this._mRangeSelection){this._mRangeSelection={index:this.indexOfItem(i),selected:i.getSelected()};}};u.prototype.onItemKeyUp=function(i,e){if(e.which===K.SHIFT){this._mRangeSelection=null;}};u.prototype._updateSelectedPaths=function(i,e){if(!this.getRememberSelections()||!this.isBound("items")){return;}var P=i.getBindingContextPath();if(!P){return;}e=(e===undefined)?i.getSelected():e;var y=this._aSelectedPaths.indexOf(P);if(e){y<0&&this._aSelectedPaths.push(P);}else{y>-1&&this._aSelectedPaths.splice(y,1);}};u.prototype._destroyGrowingDelegate=function(){if(this._oGrowingDelegate){this._oGrowingDelegate.destroy();this._oGrowingDelegate=null;}};u.prototype._destroyItemNavigation=function(){if(this._oItemNavigation){this.removeEventDelegate(this._oItemNavigation);this._oItemNavigation.destroy();this._oItemNavigation=null;}};u.prototype._getTouchBlocker=function(){return this.$().children();};u.prototype._getSwipeContainer=function(){if(!this._$swipeContainer){this._$swipeContainer=q("<div>",{"id":this.getId("swp"),"class":"sapMListSwp"});}return this._$swipeContainer;};u.prototype._setSwipePosition=function(){if(this._isSwipeActive){return this._getSwipeContainer().css("top",this._swipedItem.$().position().top);}};u.prototype._renderSwipeContent=function(){var $=this._swipedItem.$(),e=this._getSwipeContainer();this.$().prepend(e.css({top:$.position().top,height:$.outerHeight(true)}));if(this._bRerenderSwipeContent){this._bRerenderSwipeContent=false;var i=C.createRenderManager();i.render(this.getSwipeContent(),e.empty()[0]);i.destroy();}return this;};u.prototype._swipeIn=function(){var i=this,$=i._getTouchBlocker(),y=i._getSwipeContainer();i._isSwipeActive=true;i._renderSwipeContent();c.addPopoverInstance(i);window.document.activeElement.blur();q(window).on("resize.swp",function(){i._setSwipePosition();});$.css("pointer-events","none").on("touchstart.swp mousedown.swp",function(e){if(!y[0].firstChild.contains(e.target)){e.preventDefault();e.stopPropagation();}});y.on("webkitAnimationEnd animationend",function(){q(this).off("webkitAnimationEnd animationend");y.css("opacity",1).trigger("focus");$.parent().on("touchend.swp touchcancel.swp mouseup.swp",function(e){if(!y[0].firstChild.contains(e.target)){i.swipeOut();}});}).removeClass("sapMListSwpOutAnim").addClass("sapMListSwpInAnim");};u.prototype._onSwipeOut=function(e){this._getSwipeContainer().css("opacity",0).remove();q(window).off("resize.swp");this._getTouchBlocker().css("pointer-events","auto").off("touchstart.swp mousedown.swp");if(typeof e=="function"){e.call(this,this._swipedItem,this.getSwipeContent());}this._isSwipeActive=false;c.removePopoverInstance(this);};u.prototype.swipeOut=function(e){if(!this._isSwipeActive){return this;}var i=this,$=this._getSwipeContainer();this._getTouchBlocker().parent().off("touchend.swp touchend.swp touchcancel.swp mouseup.swp");$.on("webkitAnimationEnd animationend",function(){q(this).off("webkitAnimationEnd animationend");i._onSwipeOut(e);}).removeClass("sapMListSwpInAnim").addClass("sapMListSwpOutAnim");return this;};u.prototype._removeSwipeContent=function(){if(this._isSwipeActive){this.swipeOut()._onSwipeOut();}};u.prototype.close=u.prototype._removeSwipeContent;u.prototype._onSwipe=function(e,i){var y=this.getSwipeContent(),z=e.srcControl;if(y&&z&&!this._isSwipeActive&&this!==z&&!this._eventHandledByControl&&D.support.touch){for(var A=z;A&&!(A instanceof f);A=A.oParent);if(A instanceof f){this._swipedItem=A;this.fireSwipe({listItem:this._swipedItem,swipeContent:y,srcControl:z,swipeDirection:i},true)&&this._swipeIn();}}};u.prototype.ontouchstart=function(e){this._eventHandledByControl=e.isMarked();};u.prototype.onswipeleft=function(e){var R=C.getConfiguration().getRTL();var i=R?S.EndToBegin:S.BeginToEnd;var y=this.getSwipeDirection();if(y===S.LeftToRight){y=S.BeginToEnd;}else if(y===S.RightToLeft){y=S.EndToBegin;}if(y!=i){if(y==S.Both){y=R?S.BeginToEnd:S.EndToBegin;}this._onSwipe(e,y);}};u.prototype.onswiperight=function(e){var R=C.getConfiguration().getRTL();var i=R?S.BeginToEnd:S.EndToBegin;var y=this.getSwipeDirection();if(y===S.LeftToRight){y=S.BeginToEnd;}else if(y===S.RightToLeft){y=S.EndToBegin;}if(y!=i){if(y==S.Both){y=R?S.EndToBegin:S.BeginToEnd;}this._onSwipe(e,y);}};u.prototype.setSwipeDirection=function(e){return this.setProperty("swipeDirection",e,true);};u.prototype.getSwipedItem=function(){return(this._isSwipeActive?this._swipedItem:null);};u.prototype.setSwipeContent=function(e){this._bRerenderSwipeContent=true;this.toggleStyleClass("sapMListSwipable",!!e);return this.setAggregation("swipeContent",e,!this._isSwipeActive);};u.prototype.invalidate=function(O){if(O&&O===this.getSwipeContent()){this._bRerenderSwipeContent=true;this._isSwipeActive&&this._renderSwipeContent();return;}return a.prototype.invalidate.apply(this,arguments);};u.prototype.addItemGroup=function(e,H,i){if(!H){H=this.getGroupHeaderTemplate(e);}H._bGroupHeader=true;this.addAggregation("items",H,i);this.setLastGroupHeader(H);return H;};u.prototype.getGroupHeaderTemplate=function(e){var H=new d();H.setTitle(e.text||e.key);return H;};u.prototype.setLastGroupHeader=function(e){this._oLastGroupHeader=e;};u.prototype.getLastGroupHeader=function(){return this._oLastGroupHeader;};u.prototype.removeGroupHeaders=function(e){this.getItems(true).forEach(function(i){if(i.isGroupHeader()){i.destroy(e);}});};u.prototype.getAccessibilityType=function(){return C.getLibraryResourceBundle("sap.m").getText("ACC_CTR_TYPE_LIST");};u.prototype.getAccessibilityStates=function(){if(!this.getItems(true).length){return"";}var e="",i=r,y=this.getMode(),B=C.getLibraryResourceBundle("sap.m");if(L.isRequired(this)){e+=B.getText("LIST_REQUIRED")+" ";}if(y==i.MultiSelect){e+=B.getText("LIST_MULTISELECTABLE")+" . ";}else if(y==i.Delete){e+=B.getText("LIST_DELETABLE")+" . ";}else if(y!=i.None){e+=B.getText("LIST_SELECTABLE")+" . ";}if(this.isGrouped()){e+=B.getText("LIST_GROUPED")+" . ";}return e;};u.prototype.getAccessibilityInfo=function(){return{description:this.getAccessibilityStates().trim(),focusable:true};};u.prototype.getAccessbilityPosition=function(i){var e=0,y=this.getVisibleItems(),A=this.getAriaRole(),E=A==="list"||A==="listbox";if(E){y=y.filter(function(i){return!i.isGroupHeader();});}var P=y.indexOf(i)+1,B=this.getBinding("items");if(this.getGrowing()&&this.getGrowingScrollToLoad()&&B&&B.isLengthFinal()){e=B.getLength();if(B.isGrouped()&&!E){e+=y.filter(function(i){return i.isGroupHeader();}).length;}}else{e=y.length;}return{setSize:e,posInset:P};};u.prototype.onItemFocusIn=function(i,F){this._handleStickyItemFocus(i.getDomRef());if(i!==F||!C.getConfiguration().getAccessibility()){return;}var e=i.getDomRef();if(!i.getContentAnnouncement){this.getNavigationRoot().setAttribute("aria-activedescendant",e.id);}else{var A=i.getAccessibilityInfo(),B=C.getLibraryResourceBundle("sap.m"),y="";if(this.getAriaRole()!=="list"){y+=A.type+" . ";}if(this.isA("sap.m.Table")){var P=this.getAccessbilityPosition(i);y+=B.getText("LIST_ITEM_POSITION",[P.posInset,P.setSize])+" . ";}y+=A.description;this.updateInvisibleText(y,e);return y;}};u.prototype.updateInvisibleText=function(T,i,P){var e=u.getInvisibleText(),F=q(i||document.activeElement);if(this.bAnnounceDetails){this.bAnnounceDetails=false;T=this.getAccessibilityInfo().description+" "+T;}e.setText(T.trim());F.addAriaLabelledBy(e.getId(),P);};u.prototype.getNavigationRoot=function(){return this.getDomRef("listUl");};u.prototype.getFocusDomRef=function(){return this.getNavigationRoot();};u.prototype._startItemNavigation=function(i){if(!D.system.desktop){return;}var e=this.getDomRef();if(!this.getShowNoData()&&!this.getVisibleItems().length&&e){e.classList.add("sapMListPreventFocus");this._destroyItemNavigation();return;}if(e){e.classList.remove("sapMListPreventFocus");}var y=this.getKeyboardMode(),z=n;if(y==z.Edit&&!this.getItems(true).length){return;}var N=this.getNavigationRoot();var T=(y==z.Edit)?-1:0;if(i&&N&&!N.contains(document.activeElement)){this._bItemNavigationInvalidated=true;if(!N.getAttribute("tabindex")){N.tabIndex=T;}return;}if(!this._oItemNavigation){this._oItemNavigation=new b();this._oItemNavigation.setCycling(false);this.addDelegate(this._oItemNavigation);this._setItemNavigationTabIndex(T);this._oItemNavigation.setTableMode(true,true).setColumns(1);this._oItemNavigation.setDisabledModifiers({sapnext:["alt","meta"],sapprevious:["alt","meta"]});}this._oItemNavigation.setPageSize(this.getGrowingThreshold());this._oItemNavigation.setRootDomRef(N);this.setNavigationItems(this._oItemNavigation,N);this._bItemNavigationInvalidated=false;};u.prototype.setNavigationItems=function(i,N){var e=q(N).children(".sapMLIB").get();i.setItemDomRefs(e);if(i.getFocusedIndex()==-1){if(this.getGrowing()&&this.getGrowingDirection()==o.Upwards){i.setFocusedIndex(e.length-1);}else{i.setFocusedIndex(0);}}};u.prototype.getItemNavigation=function(){return this._oItemNavigation;};u.prototype._setItemNavigationTabIndex=function(T){if(this._oItemNavigation){this._oItemNavigation.iActiveTabIndex=T;this._oItemNavigation.iTabIndex=T;}};u.prototype.setKeyboardMode=function(e){this.setProperty("keyboardMode",e,true);if(this.isActive()){var T=(e==n.Edit)?-1:0;this.$("nodata").prop("tabIndex",~T);this.$("listUl").prop("tabIndex",T);this.$("after").prop("tabIndex",T);this._setItemNavigationTabIndex(T);}return this;};u.prototype.setItemFocusable=function(e){if(!this._oItemNavigation){return;}var i=this._oItemNavigation.getItemDomRefs();var y=i.indexOf(e.getDomRef());if(y>=0){this._oItemNavigation.setFocusedIndex(y);}};u.prototype.forwardTab=function(F){this._bIgnoreFocusIn=true;this.$(F?"after":"before").trigger("focus");};u.prototype.onsaptabnext=function(e){if(e.isMarked()||this.getKeyboardMode()==n.Edit){return;}if(e.target.id==this.getId("nodata")){this.forwardTab(true);e.setMarked();}};u.prototype.onsaptabprevious=function(e){if(e.isMarked()||this.getKeyboardMode()==n.Edit){return;}var T=e.target.id;if(T==this.getId("nodata")){this.forwardTab(false);}else if(T==this.getId("trigger")){this.focusPrevious();e.preventDefault();}};u.prototype._navToSection=function(F){var T;var i=0;var e=F?1:-1;var y=this._aNavSections.length;this._aNavSections.some(function(A,B){var E=(A?window.document.getElementById(A):null);if(E&&E.contains(document.activeElement)){i=B;return true;}});var z=this.getItemsContainerDomRef();var $=q(document.getElementById(this._aNavSections[i]));if($[0]===z&&this._oItemNavigation){$.data("redirect",this._oItemNavigation.getFocusedIndex());}this._aNavSections.some(function(){i=(i+e+y)%y;T=q(document.getElementById(this._aNavSections[i]));if(T[0]===z&&this._oItemNavigation){var R=T.data("redirect");var A=this._oItemNavigation.getItemDomRefs();var B=A[R]||z.children[0];T=q(B);}if(T.is(":focusable")){T.trigger("focus");return true;}},this);return T;};u.prototype.onsapshow=function(e){if(e.isMarked()||e.which==K.F4||e.target.id!=this.getId("trigger")&&!q(e.target).hasClass(this.sNavItemClass)){return;}if(this._navToSection(true)){e.preventDefault();e.setMarked();}};u.prototype.onsaphide=function(e){if(e.isMarked()||e.target.id!=this.getId("trigger")&&!q(e.target).hasClass(this.sNavItemClass)){return;}if(this._navToSection(false)){e.preventDefault();e.setMarked();}};u.prototype.onkeydown=function(e){var i=(e.which==K.A)&&(e.metaKey||e.ctrlKey);if(e.isMarked()||!i||!q(e.target).hasClass(this.sNavItemClass)){return;}var y=this.getMultiSelectMode();var z=i&&e.shiftKey&&y==M.ClearAll;if(z){e.preventDefault();e.setMarked();this.removeSelections(false,true);return;}e.preventDefault();if(this.getMode()!==r.MultiSelect||y===M.ClearAll){return;}if(this.isAllSelectableSelected()){this.removeSelections(false,true);}else{this.selectAll(true);}e.setMarked();};u.prototype.onmousedown=function(e){if(this._bItemNavigationInvalidated){this._startItemNavigation();}if(e.shiftKey&&this._mRangeSelection&&e.srcControl.getId().includes("-selectMulti")){e.preventDefault();}};u.prototype.focusPrevious=function(){if(!this._oItemNavigation){return;}var N=this._oItemNavigation.getItemDomRefs();var i=this._oItemNavigation.getFocusedIndex();var $=q(N[i]);var R=$.control(0)||{};var T=R.getTabbables?R.getTabbables():$.find(":sapTabbable");var F=T.eq(-1).add($).eq(-1);this.bAnnounceDetails=true;F.trigger("focus");};u.prototype.onfocusin=function(e){if(this._bIgnoreFocusIn){this._bIgnoreFocusIn=false;e.stopImmediatePropagation(true);return;}if(this._bItemNavigationInvalidated){this._startItemNavigation();}var T=e.target;if(T.id==this.getId("nodata")){var N=this.getNoData();var i=N||this.getNoDataText();if(N&&typeof N!=="string"){i=f.getAccessibilityText(N);}this.updateInvisibleText(i,T);}if(e.isMarked()||!this._oItemNavigation||this.getKeyboardMode()==n.Edit||T.id!=this.getId("after")){return;}this.focusPrevious();e.setMarked();};u.prototype.onsapfocusleave=function(e){if(this._oItemNavigation&&!this.bAnnounceDetails&&!this.getNavigationRoot().contains(document.activeElement)){this.bAnnounceDetails=true;}};u.prototype.onItemArrowUpDown=function(e,E){if(this.getKeyboardMode()!==n.Edit||E.target instanceof HTMLTextAreaElement){return;}var i=this.getVisibleItems(true),y=(E.type=="sapup"||E.type=="sapupmodifiers"?-1:1),z=i.indexOf(e)+y,A=i[z];if(A&&A.isGroupHeader()){A=i[z+y];}if(!A){return;}var T=A.getTabbables(),F=e.getTabbables().index(E.target),$=T.eq(T[F]?F:-1);$[0]?$.trigger("focus"):A.focus();$[0]&&$[0].select&&$[0].select();E.preventDefault();E.setMarked();};u.prototype.onItemContextMenu=function(e,E){var i=this.getContextMenu();if(!i){return;}var y=this.fireBeforeOpenContextMenu({listItem:e,column:C.byId(q(E.target).closest(".sapMListTblCell",this.getNavigationRoot()).attr("data-sap-ui-column"))});if(y){E.setMarked();E.preventDefault();var B,z=this.getBindingInfo("items");if(z){B=e.getBindingContext(z.model);i.setBindingContext(B,z.model);}i.openAsContextMenu(E,e);}};u.prototype.onItemUpDownModifiers=function(i,e,y){if(e.srcControl!=i){if(!e.shiftKey&&(e.metaKey||e.ctrlKey)){this.onItemArrowUpDown(i,e);}return;}if(!this._mRangeSelection){return;}var V=this.getVisibleItems(),z=V.indexOf(i),A=V[z+y];if(!A){if(this._mRangeSelection){this._mRangeSelection=null;}e.setMarked();return;}var B=A.getSelected();if(this._mRangeSelection.direction===undefined){this._mRangeSelection.direction=y;}else if(this._mRangeSelection.direction!==y){if(this._mRangeSelection.index!==V.indexOf(i)){A=i;B=A.getSelected();if(this._mRangeSelection.selected&&B){this.setSelectedItem(A,false,true);return;}}else{this._mRangeSelection.direction=y;}}if(this._mRangeSelection.selected!==B&&A.isSelectable()){this.setSelectedItem(A,this._mRangeSelection.selected,true);}};u.prototype.isGrouped=function(){var B=this.getBinding("items");return B&&B.isGrouped();};u.prototype.setContextMenu=function(e){this.setAggregation("contextMenu",e,true);return this;};u.prototype.destroyContextMenu=function(){this.destroyAggregation("contextMenu",true);return this;};u.prototype.getStickyStyleValue=function(){var e=this.getSticky();if(!e||!e.length){this._iStickyValue=0;return this._iStickyValue;}var i=0,H=this.getHeaderText(),y=this.getHeaderToolbar(),z=H||(y&&y.getVisible()),A=this.getInfoToolbar(),B=A&&A.getVisible(),E=false;if(this.isA("sap.m.Table")){E=this.getColumns().some(function(F){return F.getVisible()&&F.getHeader();});}e.forEach(function(F){if(F===t.HeaderToolbar&&z){i+=1;}else if(F===t.InfoToolbar&&B){i+=2;}else if(F===t.ColumnHeaders&&E){i+=4;}});this._iStickyValue=i;return this._iStickyValue;};u.prototype._handleStickyItemFocus=function(i){if(!this._iStickyValue){return;}var e=l.getScrollDelegate(this,true);if(!e){return;}var T=0,y=0,z=0,A=0,H=0,B=0,E=this.getStickyFocusOffset();if(this._iStickyValue&4){var F=this.getDomRef("tblHeader").firstChild;var J=F.getBoundingClientRect();y=parseInt(J.bottom);T=parseInt(J.height);}if(this._iStickyValue&2){var N=this.getDomRef().querySelector(".sapMListInfoTBarContainer");if(N){var O=N.getBoundingClientRect();A=parseInt(O.bottom);z=parseInt(O.height);}}if(this._iStickyValue&1){var P=this.getDomRef().querySelector(".sapMListHdr");if(P){var Q=P.getBoundingClientRect();B=parseInt(Q.bottom);H=parseInt(Q.height);}}var R=Math.round(i.getBoundingClientRect().top);if(y>R||A>R||B>R){window.requestAnimationFrame(function(){e.scrollToElement(i,0,[0,-T-z-H-E]);});}};u.prototype.setHeaderToolbar=function(H){return this._setToolbar("headerToolbar",H);};u.prototype.setInfoToolbar=function(i){return this._setToolbar("infoToolbar",i);};u.prototype.scrollToIndex=function(i){return new Promise(function(y,z){var A,B;B=l.getScrollDelegate(this,true);if(!B){return z();}A=x(this,i);if(!A){return z();}setTimeout(function(){try{B.scrollToElement(A.getDomRef(),null,[0,this._getStickyAreaHeight()*-1]);y();}catch(e){z(e);}}.bind(this),0);}.bind(this));};u.prototype.requestItems=function(i){if(i<=0||!this.getGrowing()||!this._oGrowingDelegate){throw new Error("The prerequisites to use 'requestItems' are not met. Please read the documentation for more details.");}if(i!=null){var O=this.getGrowingThreshold();this.setGrowingThreshold(i);this._oGrowingDelegate.requestNewPage();this.setGrowingThreshold(O);}else{this._oGrowingDelegate.requestNewPage();}};function x(e,i){var y=e.getVisibleItems();var R=y.length;if(typeof i!=='number'||i<-1){i=0;}if(i>=R||i===-1){i=R-1;}return y[i];}u.prototype._setFocus=function(i,F){return new Promise(function(e,y){var z=x(this,i);if(!z){return y();}if(F===true){var $=z.getTabbables();if($.length){$[0].focus();return e();}}z.focus();return e();}.bind(this));};u.prototype._getStickyAreaHeight=function(){var e=this.getSticky();if(!(e&&e.length)){return 0;}return e.reduce(function(i,y){var z,A;switch(y){case t.HeaderToolbar:z=this.getHeaderToolbar();A=z&&z.getDomRef()||this.getDomRef("header");break;case t.InfoToolbar:z=this.getInfoToolbar();A=z&&z.getDomRef();break;case t.ColumnHeaders:A=this.getDomRef("tblHeader");break;default:}return i+(A?A.offsetHeight:0);}.bind(this),0);};u.prototype._setToolbar=function(A,T){var O=this.getAggregation(A);if(O){O.detachEvent("_change",this._onToolbarPropertyChanged,this);}this.setAggregation(A,T);if(T){T.attachEvent("_change",this._onToolbarPropertyChanged,this);}return this;};u.prototype._onToolbarPropertyChanged=function(e){if(e.getParameter("name")!=="visible"){return;}var O=this._iStickyValue,N=this.getStickyStyleValue();if(O!==N){var i=this.getDomRef();if(i){var y=i.classList;y.toggle("sapMSticky",!!N);y.remove("sapMSticky"+O);y.toggle("sapMSticky"+N,!!N);}}};u.prototype.getAriaRole=function(){return"list";};u.prototype.enhanceAccessibilityState=function(e,A){if(!e.isA("sap.m.ListItemBase")||e.isGroupHeader()){return;}var P=this.getAccessbilityPosition(e);A.posinset=P.posInset;A.setsize=P.setSize;};return u;});
