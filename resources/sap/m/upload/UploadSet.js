/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/events/KeyCodes","sap/base/Log","sap/base/util/deepEqual","sap/m/library","sap/m/Button","sap/m/Dialog","sap/m/List","sap/m/MessageBox","sap/m/OverflowToolbar","sap/m/StandardListItem","sap/m/Text","sap/m/ToolbarSpacer","sap/ui/unified/FileUploader","sap/m/upload/UploadSetItem","sap/m/upload/Uploader","sap/m/upload/UploadSetRenderer","sap/m/upload/UploaderHttpRequestMethod","sap/ui/core/dnd/DragDropInfo","sap/ui/core/dnd/DropInfo","sap/m/library","sap/m/upload/UploadSetToolbarPlaceholder","sap/m/IllustratedMessage","sap/m/IllustratedMessageType","sap/m/IllustratedMessageSize"],function(C,K,L,d,M,B,D,a,b,O,S,T,c,F,U,e,R,f,g,h,k,l,I,m,n){"use strict";var o=C.extend("sap.m.upload.UploadSet",{metadata:{library:"sap.m",properties:{fileTypes:{type:"string[]",defaultValue:null},maxFileNameLength:{type:"int",defaultValue:null},maxFileSize:{type:"float",defaultValue:null},mediaTypes:{type:"string[]",defaultValue:null},noDataText:{type:"string",defaultValue:null},noDataDescription:{type:"string",defaultValue:null},dragDropText:{type:"string",defaultValue:null},dragDropDescription:{type:"string",defaultValue:null},instantUpload:{type:"boolean",defaultValue:true},showIcons:{type:"boolean",defaultValue:true},terminationEnabled:{type:"boolean",defaultValue:true},uploadEnabled:{type:"boolean",defaultValue:true},uploadUrl:{type:"string",defaultValue:null},uploadButtonInvisible:{type:"boolean",group:"Appearance",defaultValue:false},sameFilenameAllowed:{type:"boolean",group:"Behavior",defaultValue:false},httpRequestMethod:{type:"sap.m.upload.UploaderHttpRequestMethod",defaultValue:f.Post},multiple:{type:"boolean",group:"Behavior",defaultValue:false},mode:{type:"sap.m.ListMode",group:"Behavior",defaultValue:k.ListMode.MultiSelect}},defaultAggregation:"items",aggregations:{items:{type:"sap.m.upload.UploadSetItem",multiple:true,singularName:"item"},incompleteItems:{type:"sap.m.upload.UploadSetItem",multiple:true,singularName:"incompleteItem"},headerFields:{type:"sap.ui.core.Item",multiple:true,singularName:"headerField"},toolbar:{type:"sap.m.OverflowToolbar",multiple:false},uploader:{type:"sap.m.upload.Uploader",multiple:false},_illustratedMessage:{type:"sap.m.IllustratedMessage",multiple:false,visibility:"hidden"}},events:{afterItemAdded:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}}},fileRenamed:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}}},afterItemRemoved:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}}},afterItemEdited:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}}},beforeItemAdded:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}},allowPreventDefault:true},beforeItemRemoved:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}},allowPreventDefault:true},beforeItemEdited:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}},allowPreventDefault:true},beforeUploadStarts:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}},allowPreventDefault:true},uploadCompleted:{parameters:{item:{type:"sap.m.upload.UploadSetItem"},response:{type:"string"},readyState:{type:"string"},status:{type:"string"},responseXML:{type:"string"},headers:{type:"object"}}},beforeUploadTermination:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}},allowPreventDefault:true},uploadTerminated:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}}},fileTypeMismatch:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}}},fileNameLengthExceeded:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}}},fileSizeExceeded:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}}},mediaTypeMismatch:{parameters:{item:{type:"sap.m.upload.UploadSetItem"}}},selectionChanged:{parameters:{items:{type:"sap.m.upload.UploadSetItem[]"}}},itemDragStart:{},itemDrop:{}}},renderer:R});var p=M.UploadState;o.prototype.init=function(){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._oList=null;this._oEditedItem=null;this._oItemToBeDeleted=null;this._mListItemIdToItemMap={};this._oUploadButton=null;this._oDragIndicator=false;this._bAttachEventListener=false;this._$Body=null;this._$DragDropArea=null;this._oLastEnteredTarget=null;this._aGroupHeadersAdded=[];this._iFileUploaderPH=null;this._oItemToUpdate=null;var i=new I({illustrationType:m.NoData,illustrationSize:n.Auto,title:this.getNoDataText(),description:this.getNoDataDescription()});this.setAggregation("_illustratedMessage",i);};o.prototype.exit=function(){if(this._oList){this._oList.destroy();this._oList=null;}if(this._oToolbar){this._oToolbar.destroy();this._oToolbar=null;}if(this._oFileUploader){this._oFileUploader.destroy();this._oFileUploader=null;}if(this._oUploader){this._oUploader.destroy();this._oUploader=null;}};o.prototype.onBeforeRendering=function(E){this._aGroupHeadersAdded=[];this._clearGroupHeaders();this._fillListWithUploadSetItems(this.getItems());};o.prototype.onAfterRendering=function(){var i;if(this._oEditedItem){i=this._oEditedItem._getFileNameEdit().$("inner");if(i){i.on("focus",function(){i.selectText(0,i.val().length);});i.trigger("focus");}if(this._oEditedItem&&this._oEditedItem.getEditState()){var j=this._oEditedItem.getListItem().getDomRef().querySelector(".sapMUSObjectMarkerContainer");if(j){j.setAttribute("style","display: none");}}}};o.prototype.onkeydown=function(E){var i,j;if(this._oEditedItem&&this._oEditedItem._getFileNameEdit().$("inner")[0]===E.target){j=this._oEditedItem;}else if(E.target){i=sap.ui.getCore().byId(E.target.id);if(i){j=this._mListItemIdToItemMap[i.getId()];}}if(!j){return;}switch(E.keyCode){case K.F2:if(j._bInEditMode){this._handleItemEditConfirmation(E,j);}else{this._handleItemEdit(E,j);}break;case K.ESCAPE:this._handleItemEditCancelation(E,j);break;case K.DELETE:if(!j.$("fileNameEdit").hasClass("sapMInputFocused")){this._handleItemDelete(E,j);}break;case K.ENTER:if(j===this._oEditedItem){this._handleItemEditConfirmation(E,j);}else{j._handleFileNamePressed();}break;default:return;}};o.prototype.getToolbar=function(){if(!this._oToolbar){this._oToolbar=this.getAggregation("toolbar");if(!this._oToolbar){this._oToolbar=new O(this.getId()+"-toolbar",{content:[this._oNumberOfAttachmentsTitle,new c(),this.getDefaultFileUploader()]});this._iFileUploaderPH=2;this.addDependent(this._oToolbar);}else{this._iFileUploaderPH=this._getFileUploaderPlaceHolderPosition(this._oToolbar);if(this._oToolbar&&this._iFileUploaderPH>-1){this._setFileUploaderInToolbar(this.getDefaultFileUploader());}else if(this._oToolbar){this._oToolbar.addContent(this.getDefaultFileUploader());}}}return this._oToolbar;};o.prototype.getNoDataText=function(){var N=this.getProperty("noDataText");N=N||this._oRb.getText("UPLOAD_SET_NO_DATA_TEXT");return N;};o.prototype.getNoDataDescription=function(){var N=this.getProperty("noDataDescription");N=N||this._oRb.getText("UPLOADCOLLECTION_NO_DATA_DESCRIPTION");return N;};o.prototype.getDragDropText=function(){var s=this.getProperty("dragDropText");s=s||this._oRb.getText("IllustratedMessage_TITLE_UploadCollection");return s;};o.prototype.getDragDropDescription=function(){var s=this.getProperty("dragDropDescription");s=s||this._oRb.getText("IllustratedMessage_DESCRIPTION_UploadCollection");return s;};o.prototype.setToolbar=function(t){this.setAggregation("toolbar",t);this.getToolbar();return this;};o.prototype.addAggregation=function(A,i,s){C.prototype.addAggregation.call(this,A,i,s);if(i&&(A==='items'||A==="incompleteItems")){this._projectToNewListItem(i);this._refreshInnerListStyle();}};o.prototype.insertAggregation=function(A,i,j,s){C.prototype.insertAggregation.call(this,A,i,j,s);if(i&&(A==='items'||A==='incompleteItems')){this._projectToNewListItem(i,j||0);this._refreshInnerListStyle();}};o.prototype.removeAggregation=function(A,i,s){var j,q;C.prototype.removeAggregation.call(this,A,i,s);if(A==="items"||A==="incompleteItems"){if(typeof i==='number'){q=this.getItems();j=q[i];}else if(typeof i==='object'){if(this.getList()&&this.getList().getItems().length){j=i._getListItem();}}var r=this.getList().removeAggregation("items",j,s);if(r&&i){r.destroy();i.destroy();}this._refreshInnerListStyle();}};o.prototype.removeAllAggregation=function(A,s){if(A==="items"){this.getItems().forEach(function(i){if(this._oList){this._oList.removeAggregation("items",i._getListItem(),s);}}.bind(this));}else if(A==="incompleteItems"){this.getIncompleteItems().forEach(function(i){if(this._oList){this._oList.removeAggregation("items",i._getListItem(),s);}}.bind(this));}C.prototype.removeAllAggregation.call(this,A,s);};o.prototype.destroyAggregation=function(A,s){if(A==="items"||A==="incompleteItems"){this.removeAllAggregation(A,s);}if(this._oList&&this._oList.getItems().length===0){this._oList.destroyAggregation("items",s);}C.prototype.destroyAggregation.call(this,A,s);};o.prototype.setFileTypes=function(N){var t=N||null;if(typeof t==="string"){t=t.split(",");}t=(t||[]).map(function(s){return s?s.toLowerCase():"";});if(!d(this.getFileTypes(),t)){this.setProperty("fileTypes",t,true);this._checkRestrictions();}return this;};o.prototype.setMaxFileNameLength=function(N){if(this.getMaxFileNameLength()!==N){this.setProperty("maxFileNameLength",N,true);this._checkRestrictions();}return this;};o.prototype.setMaxFileSize=function(N){if(this.getMaxFileSize()!==N){this.setProperty("maxFileSize",N,true);this._checkRestrictions();}return this;};o.prototype.setMediaTypes=function(N){var t=N||null;if(typeof t==="string"){t=t.split(",");}t=(t||[]).map(function(s){return s?s.toLowerCase():"";});if(!d(this.getMediaTypes(),t)){this.setProperty("mediaTypes",t,true);this._checkRestrictions();}return this;};o.prototype.setShowIcons=function(s){if(s!==this.getShowIcons()){this._getAllItems().forEach(function(i){i._getIcon().setVisible(s);});this.setProperty("showIcons",s,false);}return this;};o.prototype.setTerminationEnabled=function(E){if(E!==this.getTerminationEnabled()){this._getAllItems().forEach(function(i){if(i.getUploadState()===p.Uploading){i._getTerminateButton().setVisible(E);}});this.setProperty("terminationEnabled",E,false);}return this;};o.prototype.setUploadButtonInvisible=function(u){if(this.getUploadButtonInvisible()===u){return this;}this.setProperty("uploadButtonInvisible",u,true);this.getDefaultFileUploader().setVisible(!u);return this;};o.prototype.setUploadEnabled=function(E){if(E!==this.getUploadEnabled()){this.getDefaultFileUploader().setEnabled(E);this.setProperty("uploadEnabled",E,false);}return this;};o.prototype.setMultiple=function(i){if(this.getMultiple()!==i){this.setProperty("multiple",i);this.getDefaultFileUploader().setMultiple(i);}return this;};o.prototype.setMode=function(s){if(s===k.ListMode.Delete){this.setProperty("mode",k.ListMode.None);L.info("sap.m.ListMode.Delete is not supported by UploadSet. Value has been resetted to 'None'");}else if(s===k.ListMode.MultiSelect&&!this.getInstantUpload()){this.setProperty("mode",k.ListMode.None);L.info("sap.m.ListMode.MultiSelect is not supported by UploadSet for Pending Upload. Value has been reset to 'None'");}else{this.setProperty("mode",s);}if(this._oList){this._oList.setMode(this.getMode());}return this;};o.prototype._getIllustratedMessage=function(){var A=this.getAggregation("_illustratedMessage");if(A){if(this._getDragIndicator()){A.setIllustrationType(m.UploadCollection);A.setTitle(this.getDragDropText());A.setDescription(this.getDragDropDescription());A.removeAllAdditionalContent();}else{A.setIllustrationType(m.NoData);A.setTitle(this.getNoDataText());A.setDescription(this.getNoDataDescription());A.addAdditionalContent(this.getUploadButtonForIllustratedMessage());}}return A;};o.prototype.getUploadButtonForIllustratedMessage=function(){if(!this._oUploadButton){this._oUploadButton=new B({id:this.getId()+"-uploadButton",type:M.ButtonType.Standard,visible:this.getUploadEnabled(),text:this._oRb.getText("UPLOADCOLLECTION_UPLOAD"),ariaDescribedBy:this.getAggregation("_illustratedMessage").getId(),press:function(){var F=this.getDefaultFileUploader();F.$().find("input[type=file]").trigger("click");}.bind(this)});}return this._oUploadButton;};o.prototype.getList=function(){if(!this._oList){this._oList=new a(this.getId()+"-list",{selectionChange:[this._handleSelectionChange,this],headerToolbar:this.getToolbar(),dragDropConfig:[new g({dropPosition:"Between",sourceAggregation:"items",targetAggregation:"items",dragStart:[this._onDragStartItem,this],drop:[this._onDropItem,this]}),new h({dropEffect:"Move",dropPosition:"OnOrBetween",dragEnter:[this._onDragEnterFile,this],drop:[this._onDropFile,this]})],mode:this.getMode()});this._oList.addStyleClass("sapMUCList");this.addDependent(this._oList);}return this._oList;};o.prototype._onDragStartItem=function(E){this.fireItemDragStart(E);};o.prototype._onDropItem=function(E){this.fireItemDrop(E);};o.prototype._onDragEnterFile=function(E){var i=E.getParameter("dragSession");var j=i.getDragControl();if(!this._bAttachEventListener){window.addEventListener("focus",function(){this._oDragIndicator=false;this._getIllustratedMessage();}.bind(this),true);this._bAttachEventListener=true;}this._oDragIndicator=true;this._getIllustratedMessage();if(j){E.preventDefault();}};o.prototype._onDropFile=function(E){var i;this._oDragIndicator=false;this._getIllustratedMessage();E.preventDefault();if(this.getUploadEnabled()){i=E.getParameter("browserEvent").dataTransfer.files;if(i&&i.length>1&&!this.getMultiple()){var s=this._oRb.getText("UPLOADCOLLECTION_MULTIPLE_FALSE");L.warning("Multiple files upload is retsricted for this multiple property set");b.error(s);return;}this._processNewFileObjects(i);}};o.prototype._getDragIndicator=function(){return this._oDragIndicator;};o.prototype.upload=function(){if(!this.getUploadEnabled()){L.warning("Upload is currently disabled for this upload set.");return;}this.getIncompleteItems().forEach(function(i){this._uploadItemIfGoodToGo(i);}.bind(this));};o.prototype.uploadItem=function(i){this._uploadItemIfGoodToGo(i);};o.prototype.getDefaultFileUploader=function(){var t=this._oRb.getText("UPLOADCOLLECTION_UPLOAD");if(!this._oFileUploader){this._oFileUploader=new F(this.getId()+"-uploader",{buttonOnly:true,buttonText:t,tooltip:t,iconOnly:false,enabled:this.getUploadEnabled(),fileType:this.getFileTypes(),mimeType:this.getMediaTypes(),icon:"",iconFirst:false,multiple:this.getMultiple(),style:"Transparent",name:"uploadSetFileUploader",sameFilenameAllowed:true,useMultipart:false,sendXHR:true,change:[this._onFileUploaderChange,this],uploadStart:[this._onUploadStarted,this],uploadProgress:[this._onUploadProgressed,this],uploadComplete:[this._onUploadCompleted,this],uploadAborted:[this._onUploadAborted,this],typeMissmatch:[this._fireFileTypeMismatch,this],fileSizeExceed:[this._fireFileSizeExceed,this],filenameLengthExceed:[this._fireFilenameLengthExceed,this],visible:!this.getUploadButtonInvisible()});}return this._oFileUploader;};o.prototype.registerUploaderEvents=function(u){u.attachUploadStarted(this._onUploadStarted.bind(this));u.attachUploadProgressed(this._onUploadProgressed.bind(this));u.attachUploadCompleted(this._onUploadCompleted.bind(this));u.attachUploadAborted(this._onUploadAborted.bind(this));};o.prototype.getSelectedItems=function(){var s=this._oList.getSelectedItems();return this._getUploadSetItemsByListItems(s);};o.prototype.getSelectedItem=function(){var s=this._oList.getSelectedItem();if(s){return this._getUploadSetItemsByListItems([s]);}return null;};o.prototype.setSelectedItemById=function(i,s){this._oList.setSelectedItemById(i+"-listItem",s);this._setSelectedForItems([this._getUploadSetItemById(i)],s);return this;};o.prototype.setSelectedItem=function(u,s){return this.setSelectedItemById(u.getId(),s);};o.prototype.selectAll=function(){var s=this._oList.selectAll();if(s.getItems().length!==this.getItems().length){L.info("Internal 'List' and external 'UploadSet' are not in sync.");}this._setSelectedForItems(this.getItems(),true);return this;};o.prototype.openFileDialog=function(i){if(this._oFileUploader){if(i){if(!this._oFileUploader.getMultiple()){this._oItemToUpdate=i;this._oFileUploader.$().find("input[type=file]").trigger("click");}else{L.warning("Version Upload cannot be used in multiple upload mode");}}else{this._oFileUploader.$().find("input[type=file]").trigger("click");}}return this;};o.prototype._onFileUploaderChange=function(E){var i=E.getParameter("files");this._processNewFileObjects(i);};o.prototype._onUploadStarted=function(E){var i=E.getParameter("item");i.setUploadState(p.Uploading);};o.prototype._onUploadProgressed=function(E){var i=E.getParameter("item"),P=Math.round(E.getParameter("loaded")/E.getParameter("total")*100);i.setProgress(P);};o.prototype._onUploadCompleted=function(E){var i=E.getParameter("item"),r=E.getParameter("responseXHR"),s=null;if(r.responseXML){s=r.responseXML.documentElement.textContent;}var x={"item":i,"response":r.response,"responseXML":s,"readyState":r.readyState,"status":r.status,"headers":r.headers};i.setProgress(100);if(this._oItemToUpdate&&this.getInstantUpload()){this.removeAggregation('items',this._oItemToUpdate,false);}this.insertItem(i,0);i.setUploadState(p.Complete);this._oItemToUpdate=null;this.fireUploadCompleted(x);};o.prototype._onUploadAborted=function(E){var i=E.getParameter("item");i.setUploadState(p.Error);this.fireUploadTerminated({item:i});};o.prototype._handleItemEdit=function(E,i){if(this._oEditedItem){this._handleItemEditConfirmation(E,this._oEditedItem);}if(!this._oEditedItem){if(this.fireBeforeItemEdited({item:i})){this._oEditedItem=i;this._oEditedItem._setInEditMode(true);}}};o.prototype._handleItemRestart=function(E,i){i.setUploadState(p.Ready);this._uploadItemIfGoodToGo(i);};o.prototype._handleItemEditConfirmation=function(E,i){var j=i._getFileNameEdit(),N,s,q=i.getFileName(),r=U._splitFileName(q),t=U._findById(i.getId(),this._getAllItems());if(j!==null){N=j.getValue().trim();}j.focus();if(!N||N.length===0){i._setContainsError(true);return;}if(r.name===N){this._removeErrorStateFromItem(this,t);i._setInEditMode(false);this.fireAfterItemEdited({item:i});this._oEditedItem=null;return;}if(!this.getSameFilenameAllowed()&&U._checkDoubleFileName(j.getValue()+"."+r.extension,this._getAllItems())){j.setValueStateText(this._oRb.getText("UPLOAD_SET_FILE_NAME_EXISTS"));j.setProperty("valueState","Error",true);j.setShowValueStateMessage(true);}else{s=r.extension?N+"."+r.extension:N;i.setFileName(s);this._removeErrorStateFromItem(this,t);i._setInEditMode(false);this.fireFileRenamed({item:i});}this._oEditedItem=null;this.invalidate();};o.prototype._removeErrorStateFromItem=function(i,j){j.errorState=null;i.sErrorState=null;i.editModeItem=null;};o.prototype._handleItemEditCancelation=function(E,i){i._setContainsError(false);i._setInEditMode(false);this._oEditedItem=null;};o.prototype._handleItemDelete=function(E,i){var s;if(this._oEditedItem){this._handleItemEditConfirmation(E,this._oEditedItem);if(this._oEditedItem){return;}}if(!i.fireRemovePressed({item:i})){return;}if(!this.fireBeforeItemRemoved({item:i})){return;}if(!i.getFileName()){s=this._oRb.getText("UPLOAD_SET_DELETE_WITHOUT_FILE_NAME_TEXT");}else{s=this._oRb.getText("UPLOAD_SET_DELETE_TEXT",i.getFileName());}this._oItemToBeDeleted=i;b.show(s,{id:this.getId()+"-deleteDialog",title:this._oRb.getText("UPLOAD_SET_DELETE_TITLE"),actions:[b.Action.OK,b.Action.CANCEL],onClose:this._handleClosedDeleteDialog.bind(this),dialogId:"messageBoxDeleteFile",styleClass:this.hasStyleClass("sapUiSizeCompact")?"sapUiSizeCompact":""});};o.prototype._handleClosedDeleteDialog=function(A){if(A!==b.Action.OK){return;}this.removeItem(this._oItemToBeDeleted);this.removeIncompleteItem(this._oItemToBeDeleted);this.fireAfterItemRemoved({item:this._oItemToBeDeleted});this._oItemToBeDeleted=null;};o.prototype._handleTerminateRequest=function(i,j){var q=new a({items:[new S({title:j.getFileName(),icon:j._getIcon().getSrc()})]}),r=new D({id:this.getId()+"-teminateDialog",title:this._oRb.getText("UPLOAD_SET_TERMINATE_TITLE"),content:[new T({text:this._oRb.getText("UPLOAD_SET_TERMINATE_TEXT")}),q],buttons:[new B({text:this._oRb.getText("UPLOAD_SET_OKBUTTON_TEXT"),press:[s,this]}),new B({text:this._oRb.getText("UPLOAD_SET_CANCEL_BUTTON_TEXT"),press:function(){r.close();}})],afterClose:function(){r.destroy();}});r.open();function s(){if(j.getUploadState()===p.Uploading){if(this.fireBeforeUploadTermination({item:j})){this._handleUploadTermination(j);}}else if(j.getUploadState()===p.Complete){this.removeItem(j);}r.close();this.invalidate();}};o.prototype._handleUploadTermination=function(i){this._getActiveUploader().terminateItem(i);};o.prototype._handleSelectionChange=function(E){var i=E.getParameter("listItems"),j=[];i.forEach(function(q){j.push(this._mListItemIdToItemMap[q.getId()]);}.bind(this));this.fireSelectionChanged({items:j});};o.prototype._onDragEnterSet=function(E){if(E.target===this._$DragDropArea[0]&&this.getUploadEnabled()){this._$DragDropArea.addClass("sapMUCDropIndicator");}};o.prototype._onDragLeaveSet=function(E){if(E.target===this._$DragDropArea[0]&&this.getUploadEnabled()){this._$DragDropArea.removeClass("sapMUCDropIndicator");}};o.prototype._onDragOverSet=function(E){E.preventDefault();};o.prototype._onDropOnSet=function(E){var i;E.preventDefault();if(E.target===this._$DragDropArea[0]&&this.getUploadEnabled()){this._$DragDropArea.removeClass("sapMUCDropIndicator");this._$DragDropArea.addClass("sapMUCDragDropOverlayHide");i=E.originalEvent.dataTransfer.files;this._processNewFileObjects(i);}};o.prototype._onDragEnterBody=function(E){if(this.getUploadEnabled()){this._oLastEnteredTarget=E.target;this._$DragDropArea.removeClass("sapMUCDragDropOverlayHide");}};o.prototype._onDragLeaveBody=function(E){if(this._oLastEnteredTarget===E.target&&this.getUploadEnabled()){this._$DragDropArea.addClass("sapMUCDragDropOverlayHide");}};o.prototype._onDragOverBody=function(E){E.preventDefault();if(this.getUploadEnabled()){this._$DragDropArea.removeClass("sapMUCDragDropOverlayHide");}};o.prototype._onDropOnBody=function(E){if(this.getUploadEnabled()){this._$DragDropArea.addClass("sapMUCDragDropOverlayHide");}};o.prototype._getAllItems=function(){return this.getItems().concat(this.getIncompleteItems());};o.prototype._refreshInnerListStyle=function(){var i=this.getList().length-1;this._oList.getItems().forEach(function(j,q){j.removeStyleClass("sapMUCListSingleItem").removeStyleClass("sapMUCListFirstItem").removeStyleClass("sapMUCListLastItem").removeStyleClass("sapMUCListItem");if(q===0&&i===0){j.addStyleClass("sapMUCListSingleItem");}else if(q===0){j.addStyleClass("sapMUCListFirstItem");}else if(q===i){j.addStyleClass("sapMUCListLastItem");}else{j.addStyleClass("sapMUCListItem");}});};o.prototype._processNewFileObjects=function(j){var q=[],r;for(var i=0;i<j.length;i++){q.push(j[i]);}q.forEach(function(s){r=new U({uploadState:p.Ready});r._setFileObject(s);r.setFileName(s.name);if(!this.fireBeforeItemAdded({item:r})){return;}this.insertIncompleteItem(r);this.fireAfterItemAdded({item:r});if(this.getInstantUpload()){this._uploadItemIfGoodToGo(r);}}.bind(this));};o.prototype._projectToNewListItem=function(i,j){var q=i._getListItem();this._mListItemIdToItemMap[q.getId()]=i;if(i.sParentAggregationName==='items'){this._mapGroupForItem(i);}if(j===0){this.getList().insertAggregation("items",q,j,true);}else{this.getList().addAggregation("items",q,true);}this._checkRestrictionsForItem(i);};o.prototype._getImplicitUploader=function(){if(!this._oUploader){this._oUploader=new e({httpRequestMethod:this.getHttpRequestMethod()});this._oUploader.setUploadUrl(this.getUploadUrl());this.registerUploaderEvents(this._oUploader);this.addDependent(this._oUploader);}return this._oUploader;};o.prototype._getActiveUploader=function(){return this.getUploader()||this._getImplicitUploader();};o.prototype._uploadItemIfGoodToGo=function(i){if(i.getUploadState()===p.Ready&&!i._isRestricted()){if(this.fireBeforeUploadStarts({item:i})){var H=i.getHeaderFields().length?i.getHeaderFields():this.getHeaderFields();this._getActiveUploader().uploadItem(i,H);}}};o.prototype._getDragDropHandlers=function(){if(!this._oDragDropHandlers){this._oDragDropHandlers={body:{"dragenter":this._onDragEnterBody.bind(this),"dragleave":this._onDragLeaveBody.bind(this),"dragover":this._onDragOverBody.bind(this),"drop":this._onDropOnBody.bind(this)},set:{"dragenter":this._onDragEnterSet.bind(this),"dragleave":this._onDragLeaveSet.bind(this),"dragover":this._onDragOverSet.bind(this),"drop":this._onDropOnSet.bind(this)}};}return this._oDragDropHandlers;};o.prototype._checkRestrictions=function(){this.getIncompleteItems().forEach(function(i){this._checkRestrictionsForItem(i);}.bind(this));};o.prototype._checkRestrictionsForItem=function(i){i._checkTypeRestriction(this.getFileTypes());i._checkNameLengthRestriction(this.getMaxFileNameLength());i._checkSizeRestriction(this.getMaxFileSize());i._checkMediaTypeRestriction(this.getMediaTypes());};o.prototype._fireFileTypeMismatch=function(i){var j=this.getMediaTypes();var q=this.getFileTypes();var s=i.getParameter("fileType");var r=i.getParameter("mimeType");var t=(!!j&&(j.length>0)&&!!r&&j.indexOf(r)===-1);var u=(!!q&&(q.length>0)&&!!s&&q.indexOf(s)===-1);if(t){this.fireMediaTypeMismatch({item:i});}else if(u){this.fireFileTypeMismatch({item:i});}};o.prototype._fireFileSizeExceed=function(i){this.fireFileSizeExceeded({item:i});};o.prototype._fireFilenameLengthExceed=function(i){this.fireFileNameLengthExceeded({item:i});};o.prototype._setSelectedForItems=function(u,s){if(this.getMode()!==k.ListMode.MultiSelect&&s){var q=this.getItems();for(var j=0;j<q.length;j++){q[j].setSelected(false);}}for(var i=0;i<u.length;i++){u[i].setSelected(s);}};o.prototype._getUploadSetItemById=function(u){var A=this.getItems();for(var i=0;i<A.length;i++){if(A[i].getId()===u){return A[i];}}return null;};o.prototype._getUploadSetItemsByListItems=function(q){var u=[];var r=this.getItems();if(q){for(var i=0;i<q.length;i++){for(var j=0;j<r.length;j++){if(q[i].getId()===r[j].getId()+"-listItem"){u.push(r[j]);break;}}}return u;}return null;};o.prototype._clearGroupHeaders=function(){this.getList().getItems().forEach(function(i){if(i.isGroupHeader()){i.destroy(false);}});};o.prototype._mapGroupForItem=function(i){var j=this.getBinding("items"),s=this.getBindingInfo("items")?this.getBindingInfo("items").oModel:undefined,G=this.getBindingInfo("items")?this.getBindingInfo("items").groupHeaderFactory:null;var q=function(t){return t.getBindingContext(s)?j.getGroup(t.getBindingContext(s)):null;};var r=function(i){return q(i)&&q(i).key;};if(j&&j.isGrouped()&&i){if(!this._aGroupHeadersAdded.some(function(t){return t===r(i);})){if(G){this.getList().addItemGroup(q(i),G(q(i)),true);}else if(q(i)){this.getList().addItemGroup(q(i),null,true);}this._aGroupHeadersAdded.push(r(i));}}};o.prototype._fillListWithUploadSetItems=function(i){var t=this;i.forEach(function(j,q){j._reset();t._projectToNewListItem(j,true);t._refreshInnerListStyle();});};o.prototype._getFileUploaderPlaceHolderPosition=function(t){for(var i=0;i<t.getContent().length;i++){if(t.getContent()[i]instanceof l){return i;}}return-1;};o.prototype._setFileUploaderInToolbar=function(i){this._oToolbar.getContent()[this._iFileUploaderPH].setVisible(false);this._oToolbar.insertContent(i,this._iFileUploaderPH);};return o;});
