/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/base/Object',"sap/base/Log","sap/ui/util/ActivityDetection","sap/ui/core/IntervalTrigger","sap/ui/thirdparty/jquery"],function(B,L,A,I,q){"use strict";var l=L.getLogger("sap.ui.core.ResizeHandler",L.Level.ERROR);var r;var R=B.extend("sap.ui.core.ResizeHandler",{constructor:function(){B.apply(this);this.aResizeListeners=[];this.aSuspendedDomRefs=[];this.bRegistered=false;this.mCallbacks=new Map();this.iIdCounter=0;this.fDestroyHandler=this.destroy.bind(this);q(window).on("unload",this.fDestroyHandler);A.attachActivate(a,this);if(r){l.error("ResizeHandler is designed as a singleton and should not be created manually! "+"Please require 'sap/ui/core/ResizeHandler' instead and use the module export directly without using 'new'.");}}});function c(){if(this.bRegistered){this.bRegistered=false;I.removeListener(this.checkSizes,this);}}function a(){if(!this.bRegistered&&this.aResizeListeners.length>0){this.bRegistered=true;I.addListener(this.checkSizes,this);}}R.prototype.destroy=function(e){A.detachActivate(a,this);q(window).off("unload",this.fDestroyHandler);this.aResizeListeners=[];this.aSuspendedDomRefs=[];c.call(this);};R.prototype.attachListener=function(o,h){var i=B.isA(o,'sap.ui.core.Control'),b=o instanceof q,d=i?o.getDomRef():o,w=d?d.offsetWidth:0,H=d?d.offsetHeight:0,s="rs-"+Date.now()+"-"+this.iIdCounter++,e;if(i){e=("Control "+o.getId());}else if(o.id){e=o.id;}else{e=String(o);}this.aResizeListeners.push({sId:s,oDomRef:i?null:o,oControl:i?o:null,bIsJQuery:b,fHandler:h,iWidth:w,iHeight:H,dbg:e});l.debug("registered "+e);a.call(this);return s;};R.prototype.detachListener=function(s){var b=this.aResizeListeners;for(var i=0;i<b.length;i++){if(b[i].sId===s){b.splice(i,1);l.debug("deregistered "+s);break;}}if(b.length===0){c.call(this);}};R.prototype.checkSizes=function(){var d=l.isLoggable();if(d){l.debug("checkSizes:");}this.aResizeListeners.forEach(function(o){if(o){var C=!!o.oControl,D=C?o.oControl.getDomRef():o.oDomRef;D=o.bIsJQuery?D[0]:D;if(D&&document.documentElement.contains(D)&&!this._isSuspended(D)){var O=o.iWidth,i=o.iHeight,n=D.offsetWidth,N=D.offsetHeight;if(O!=n||i!=N){o.iWidth=n;o.iHeight=N;var e=q.Event("resize");e.target=D;e.currentTarget=D;e.size={width:n,height:N};e.oldSize={width:O,height:i};e.control=C?o.oControl:null;if(d){l.debug("resize detected for '"+o.dbg+"': "+e.oldSize.width+"x"+e.oldSize.height+" -> "+e.size.width+"x"+e.size.height);}o.fHandler(e);}}}},this);if(R._keepActive!=true&&R._keepActive!=false){R._keepActive=false;}if(!A.isActive()&&!R._keepActive){c.call(this);}};R.register=function(o,h){return r.attachListener(o,h);};R.deregister=function(i){r.detachListener(i);};R.deregisterAllForControl=function(C){r.aResizeListeners.filter(function(o){return o&&o.oControl&&o.oControl.getId()===C;}).forEach(function(o){R.deregister(o.sId);});};R.suspend=function(d){if(!document.documentElement.contains(d)){return false;}if(r.aSuspendedDomRefs.indexOf(d)===-1){r.aSuspendedDomRefs.push(d);}return true;};R.resume=function(d){var b=r.aSuspendedDomRefs.indexOf(d);if(b===-1){return false;}r.aSuspendedDomRefs.splice(b,1);r.checkSizes();var C=r.mCallbacks.get(d);if(C){for(var i=0;i<C.length;i++){C[i]();}r.mCallbacks.delete(d);}return true;};R.prototype._isSuspended=function(d){var s=this.aSuspendedDomRefs,n;for(var i=0;i<s.length;i++){n=s[i];if(n.contains(d)){return n;}}return false;};R.isSuspended=function(d,C){var s=r._isSuspended(d);if(C&&s){var b=r.mCallbacks.get(s);if(!b){b=[];r.mCallbacks.set(s,b);}if(b.indexOf(C)===-1){b.push(C);}}return!!s;};r=new R();return R;});
