/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/base/Object",'sap/ui/Device'],function(C,B,D){"use strict";var A=B.extend("sap.ui.core.AccessKeysEnablement",{});A.controlRegistry=new Set();A.CSS_CLASS="sapUiAccKeysHighlighDom";A.bListenersAttached=false;var h=function(){var H=function(c){var d=c.getEnabled&&!c.getEnabled();if(d){return;}if(c){c.setProperty("highlightAccKeysRef",true);c.onAccKeysHighlightStart&&c.onAccKeysHighlightStart();}};A.controlRegistry.forEach(function(e){H(e);});};var s=function(){var H=function(c){if(c){c.setProperty("highlightAccKeysRef",false);c.onAccKeysHighlightStart&&c.onAccKeysHighlightEnd();}};A.controlRegistry.forEach(function(e){H(e);});};A.attachKeydownListeners=function(){document.addEventListener("keydown",function(i){if(this.hasHighlightedElements()){i.preventDefault();}this.handleHighlightStart(i);document.addEventListener("keydown",function(p){if(this.hasHighlightedElements()){p.preventDefault();}}.bind(this),{once:true});}.bind(this));document.addEventListener("keyup",function(e){this.handleHighlightEnd(e);}.bind(this));window.addEventListener("blur",function(){this.handleHighlightEnd(true);}.bind(this));};A.handleHighlightStart=function(e){var t=e.altKey;var c=e.key;if(t){h();if(this.hasHighlightedElements()){var E=this.getElementToBeFocused(c);if(!E.length){return;}var f=document.activeElement;var b=e.shiftKey;var i=E.indexOf(f);if(b){var p=E[i-1];if(p){p.focus();}else if(i===0){E[E.length-1].focus();}}else{var n=E[i+1];if(n){n.focus();}else if(i===(E.length-1)){E[0].focus();}}}}};A.hasHighlightedElements=function(){return document.getElementsByClassName(A.CSS_CLASS).length;};A.handleHighlightEnd=function(e,w){if(!e.altKey||w){s();}};A.getElementToBeFocused=function(t){return[].filter.call(document.querySelectorAll("[data-ui5-accesskey='"+t.toLowerCase()+"']"),function(d){var c=sap.ui.getCore().byId(d.getAttribute("id"));var e=c.getEnabled?c.getEnabled():true;var v=c.getVisible();return e&&v;}).map(function(e){e=sap.ui.getCore().byId(e.getAttribute("id"));return e.getAccessKeysFocusTarget?e.getAccessKeysFocusTarget():e.getFocusDomRef();});};A.registerControl=function(c){var e=C.getConfiguration().getAccKeys();if(D.os.macintosh){return;}this.controlRegistry.add(c);if(e&&!this.bListenersAttached){this.attachKeydownListeners();A.bListenersAttached=true;}var E=c.exit;c.exit=function(){A.controlRegistry.delete(c);E&&E.call(c);};};A.deregisterControl=function(c){A.registerControl.delete();};return A;});
