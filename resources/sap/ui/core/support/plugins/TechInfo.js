/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/base/Log','sap/base/util/each','sap/base/util/isEmptyObject','sap/base/util/isPlainObject','../Plugin','../Support','../ToolsAPI','sap/base/security/encodeXML','sap/ui/VersionInfo'],function(q,L,e,a,b,P,S,T,c,V){"use strict";var d=P.extend("sap.ui.core.support.plugins.TechInfo",{constructor:function(o){P.apply(this,["sapUiSupportTechInfo","Technical Information",o]);this._aEventIds=this.runsAsToolPlugin()?[this.getId()+"Data",this.getId()+"FinishedE2ETrace"]:[this.getId()+"ToggleDebug",this.getId()+"SetReboot",this.getId()+"Refresh",this.getId()+"StartE2ETrace",this.getId()+"ToggleStatistics"];if(this.runsAsToolPlugin()){this.e2eLogLevel="medium";this.e2eTraceStarted=false;}}});d.prototype.onsapUiSupportTechInfoData=function(E){var r=E.getParameter("data");V.load().then(function(v){return{productName:v.name,versionInfoEncoded:"<a href='"+sap.ui.require.toUrl("sap-ui-version.json")+"'"+" target='_blank' class='sapUiSupportLink' title='Open Version Info'>"+f(v.version)+"</a>"+g(v.buildTimestamp,v.scmRevision)};},function(){return{productName:"SAPUI5",versionInfoEncoded:"not available"};}).then(function(v){this._createTechInfoUI(r,v);}.bind(this));};d.prototype._createTechInfoUI=function(D,o){var t=this;D.modules.sort();this.e2eTraceStarted=D["e2e-trace"].isStarted;var h=["<div class='sapUiSupportToolbar'>","<button id='",t.getId(),"-Refresh' class='sapUiSupportRoundedButton'>Refresh</button>","<div><div class='sapUiSupportTechInfoCntnt'>","<table border='0' cellpadding='3' class='infoTable'>"];l(h,true,true,o.productName,function(i){i.push(o.versionInfoEncoded);});if(!/openui5/i.test(o.productName)){l(h,true,true,"OpenUI5 Version",function(i){i.push(f(D.version)+g(D.build,D.change));});}l(h,true,true,"Loaded jQuery Version",function(i){return D.jquery;});l(h,true,true,"User Agent",function(i){return D.useragent+(D.docmode?", Document Mode '"+D.docmode+"'":"");});l(h,true,true,"Debug Sources",function(i){i.push((D.debug?"ON":"OFF"),"<a href='#' id='",t.getId(),"-tggleDbgSrc' class='sapUiSupportLink'>Toggle</a>");});l(h,true,true,"Application",D.appurl);m(h,true,true,"Configuration (bootstrap)",D.bootconfig);m(h,true,true,"Configuration (computed)",D.config);if(!a(D.libraries)){m(h,true,true,"Libraries",D.libraries);}m(h,true,true,"Loaded Libraries",D.loadedLibraries);l(h,true,true,"Loaded Modules",function(j){e(D.modules,function(i,v){if(v.indexOf("sap.ui.core.support")<0){j.push("<span>",f(v),"</span>");if(i<D.modules.length-1){j.push(", ");}}});});m(h,true,true,"URI Parameters",D.uriparams);l(h,true,true,"E2E Trace",function(i){i.push("<label class='sapUiSupportLabel'>Trace Level:</label>","<select id='",t.getId(),"-logLevelE2ETrace' class='sapUiSupportTxtFld sapUiSupportSelect'>","<option value='low'"+(t.e2eLogLevel==='low'?" selected":"")+">LOW</option>","<option value='medium'"+(t.e2eLogLevel==='medium'?" selected":"")+">MEDIUM</option>","<option value='high'"+(t.e2eLogLevel==='hight'?" selected":"")+">HIGH</option>","</select>");i.push("<button id='"+t.getId()+"-startE2ETrace' class='sapUiSupportRoundedButton "+(D["e2e-trace"].isStarted?" active":"")+"'>"+(D["e2e-trace"].isStarted?"Running...":"Start")+"</button>");i.push("<div class='sapUiSupportTechInfoXMLOutput'>");i.push("<label class='sapUiSupportLabel'>XML Output:</label>");i.push("<textarea id='"+t.getId()+"-outputE2ETrace'></textarea>");i.push("</div>");});h.push("</table></div>");this.$().html(h.join(""));this.$("tggleDbgSrc").on("click",function(E){E.preventDefault();S.getStub().sendEvent(t.getId()+"ToggleDebug",{});});this.$("Refresh").on("click",function(E){E.preventDefault();S.getStub().sendEvent(t.getId()+"Refresh",{});});this.$("outputE2ETrace").on("click",function(){this.focus();this.select();});this.$("startE2ETrace").on("click",function(){if(!t.e2eTraceStarted){t.e2eLogLevel=t.$("logLevelE2ETrace").val();t.$("startE2ETrace").addClass("active").text("Running...");t.$("outputE2ETrace").text("");S.getStub().sendEvent(t.getId()+"StartE2ETrace",{level:t.e2eLogLevel});t.e2eTraceStarted=true;}});document.title="UI5 Diagnostics - "+D.title;};d.prototype.onsapUiSupportTechInfoToggleDebug=function(E){q.sap.debug(!q.sap.debug());s(this);};d.prototype.onsapUiSupportTechInfoSetReboot=function(E){q.sap.setReboot(E.getParameter("rebootUrl"));};d.prototype.onsapUiSupportTechInfoStartE2ETrace=function(E){var t=this,h=E.getParameter("level");sap.ui.require(['sap/ui/core/support/trace/E2eTraceLib'],function(i){i.start(h,function(j){S.getStub().sendEvent(t.getId()+"FinishedE2ETrace",{trace:j});});},function(o){L.error("Could not load module 'sap/ui/core/support/trace/E2eTraceLib':",o);});};d.prototype.onsapUiSupportTechInfoFinishedE2ETrace=function(E){this.$("startE2ETrace").removeClass("active").text("Start");this.$("outputE2ETrace").text(E.getParameter("trace"));this.e2eTraceStarted=false;};d.prototype.onsapUiSupportTechInfoRefresh=function(E){s(this);};d.prototype.onsapUiSupportTechInfoToggleStatistics=function(E){q.sap.statistics(!q.sap.statistics());s(this);};d.prototype.init=function(o){P.prototype.init.apply(this,arguments);if(!this.runsAsToolPlugin()){s(this);return;}this.$().html("No Information available");};function s(p){var C=T.getFrameworkInformation();var D={version:C.commonInformation.version,build:C.commonInformation.buildTime,change:C.commonInformation.lastChange,jquery:C.commonInformation.jquery,useragent:C.commonInformation.userAgent,docmode:C.commonInformation.documentMode,debug:C.commonInformation.debugMode,bootconfig:C.configurationBootstrap,config:C.configurationComputed,libraries:C.libraries,loadedLibraries:C.loadedLibraries,modules:C.loadedModules,uriparams:C.URLParameters,appurl:C.commonInformation.applicationHREF,title:C.commonInformation.documentTitle,statistics:C.commonInformation.statistics};var E=sap.ui.require('sap/ui/core/support/trace/E2eTraceLib');D["e2e-trace"]={isStarted:E?E.isStarted():false};S.getStub().sendEvent(p.getId()+"Data",{data:D});}function f(h){return h==null?"":c(String(h));}function l(h,r,i,j,k){h.push("<tr><td ",r?"align='right' ":"","valign='top'>","<label class='sapUiSupportLabel'>",f(j),"</label></td><td",i?" class='sapUiSupportTechInfoBorder'":"",">");var n=k;if(typeof k==='function'){n=k(h);}h.push(f(n));h.push("</td></tr>");}function m(h,r,j,k,n){l(h,r,j,k,function(h){h.push("<table border='0' cellspacing='0' cellpadding='3'>");q.each(n,function(i,v){var o="";if(v){if(typeof(v)==="string"||typeof(v)==="string"||typeof(v)==="boolean"){o=v;}else if(Array.isArray(v)||b(v)){o=JSON.stringify(v);}}l(h,false,false,i,""+o);});h.push("</table>");});}function g(t,h){var i=[];if(t){var j=/^(\d{4})(\d{2})(\d{2})-?(\d{2})(\d{2})$/.exec(t);if(j){t=j[1]+'-'+j[2]+'-'+j[3]+'T'+j[4]+":"+j[5];}i.push("built at "+f(t));}if(h){i.push("last change "+f(h));}return i.length===0?"":" ("+i.join(", ")+")";}return d;});
