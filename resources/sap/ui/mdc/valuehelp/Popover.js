/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/valuehelp/base/Container','sap/ui/mdc/util/loadModules',"sap/ui/dom/units/Rem","sap/ui/thirdparty/jquery","sap/ui/core/library"],function(C,l,R,q,c){"use strict";var M,a,T,b,V;var d=c.ValueState;var P=C.extend("sap.ui.mdc.valuehelp.Popover",{metadata:{library:"sap.ui.mdc",interfaces:["sap.ui.mdc.valuehelp.ITypeaheadContainer","sap.ui.mdc.valuehelp.IDialogContainer"],properties:{},defaultAggregation:"content"}});P.prototype.invalidate=function(o){if(o){var p=this.getAggregation("_container");var e=this._oCurrentContent;if(p&&e&&o===e&&!this._bIsBeingDestroyed){p.invalidate(o);}else{C.prototype.invalidate.apply(this,arguments);}}};P.prototype._getUIAreaForContent=function(){var p=this.getAggregation("_container");if(p){return p.getUIArea();}return C.prototype._getUIAreaForContent.apply(this,arguments);};P.prototype._getContent=function(){var o=this.getContent();return o&&o[0];};P.prototype._getContainer=function(){var p=this.getAggregation("_container");var u=function(o,v){if(o&&o.getValueState&&o.getValueState()!==d.None){v.setText(o.getValueStateText());v.setValueState(o.getValueState());v.setVisible(true);}else{v.setVisible(false);}};if(!p){return l(["sap/m/Popover","sap/m/library","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/ValueStateHeader"]).then(function(L){M=L[0];a=L[1];T=L[2];b=L[3];V=L[4];var v=new V();u(this._getControl(),v);p=new M(this.getId()+"-pop",{contentHeight:"auto",placement:a.PlacementType.VerticalPreferredBottom,showHeader:false,showArrow:false,title:this.getTitle(),titleAlignment:a.TitleAlignment.Center,afterOpen:this._handleOpened.bind(this),afterClose:this._handleClosed.bind(this),customHeader:v}).addStyleClass("sapMdcValueHelpPopover").addStyleClass("sapMComboBoxBasePicker").addStyleClass("sapMComboBoxBasePicker-CTX");if(v){v.setPopup(p);}p.isPopupAdaptationAllowed=function(){return false;};p.addStyleClass(this._isSingleSelect()?"sapMdcValueHelpSingleSelect":"sapMdcValueHelpMultiSelect");p.addDelegate({onsapshow:this._handleRequestSwitchToDialog.bind(this)});p._getAllContent=function(){var f=this.getParent();var g=[];if(f){if(this._oCurrentContent){g.push(this._oCurrentContent);}}return g;}.bind(this);var o=this._getContent();var e=this._getContainerConfig(o);if(e){p.setShowArrow(!!e.showArrow);p.setShowHeader(!!e.showHeader);p.setResizable(!!e.resizable);if(e.getContentWidth){p.setContentWidth(e.getContentWidth());}}this.setAggregation("_container",p,true);return p;}.bind(this));}u(this._getControl(),p.getCustomHeader());return p;};var _=function(){var o=this.getAggregation("_container");var e=this._getContent();var f=e&&this._getContainerConfig(e);if(o&&f&&f.getContentHeight){var h=f.getContentHeight();var i=o.$().find(".sapMPopoverCont").height();var g=i<R.toPx("30rem");o.setContentHeight(!h||g||i>=h?"auto":"30rem");o.invalidate();}};P.prototype.providesScrolling=function(){return true;};P.prototype._observeChanges=function(o){if(o.name==="content"){var e=o.child;if(o.mutation==="remove"){e.detachEvent("contentUpdated",_,this);e.detachNavigated(this._handleNavigated,this);}else{e.attachEvent("contentUpdated",_,this);}}C.prototype._observeChanges.apply(this,arguments);};P.prototype._placeContent=function(p){var o=this._getContent();var e=o&&o.getContent();var B=o&&o.onBeforeShow();var f=this._getContainerConfig(o);var F=f&&f.getFooter&&f.getFooter();return Promise.all([e,F,B]).then(function(g){this._oCurrentContent=g[0];var h=g[1];var i=this._getControl();this._oCurrentContent.setFieldGroupIds(i.getFieldGroupIds());if(h&&p.getFooter()!=h&&h.isA&&h.isA("sap.m.Toolbar")){p.setFooter(h);return p;}if(h){if(!p.getFooter()){var t=[new b(this.getId()+"-Spacer")].concat(h);var j=new T(this.getId()+"-TB",{content:t}).setModel(this._oManagedObjectModel,"$help");p.setFooter(j);}else{}}else if(p.getFooter()){p.setFooter();}return p;}.bind(this));};P.prototype._open=function(p){if(p.isOpen()){return;}C.prototype._open.apply(this,arguments);var o=this._getControl();var t=o&&o.getFocusElementForValueHelp?o.getFocusElementForValueHelp(this.isTypeahead()):o;if(t&&t.getDomRef()){p.setContentMinWidth(q(t.getDomRef()).outerWidth()+"px");if(!this.isFocusInHelp()){p.setInitialFocus(t);}p.openBy(t);}};P.prototype._close=function(){C.prototype._close.apply(this,arguments);var p=this.getAggregation("_container");if(p){p.close();}};P.prototype._handleOpened=function(){_.call(this);C.prototype._handleOpened.apply(this,arguments);var o=this._getContent();if(o){o.onContainerOpen();o.onShow();}};P.prototype._handleConfirmed=function(e){this.fireConfirm({close:e.getParameter("close")||this._isSingleSelect()});};P.prototype._handleClosed=function(e){var o=this._getContent();if(o){o.onHide();o.onContainerClose();}var p=this.getAggregation("_container");if(p){p._oPreviousFocus=null;}C.prototype._handleClosed.apply(this,arguments);};P.prototype.removeFocus=function(){var o=this._getContent();if(o){o.removeFocus();}};P.prototype._navigate=function(s){var o=this._getContent();if(o){return o.navigate(s);}};P.prototype.getItemForValue=function(o){var e=this._getContent();if(e){return e.getItemForValue(o);}};P.prototype.isValidationSupported=function(o){var e=this._getContent();if(e){return e.isValidationSupported();}};P.prototype.getUseAsValueHelp=function(){var o=this._getContent();return o&&o.getUseAsValueHelp&&o.getUseAsValueHelp();};P.prototype.getValueHelpIcon=function(){var o=this._getContent();return o&&o.getValueHelpIcon();};P.prototype.getAriaAttributes=function(m){var o=this._getContent();var e=o&&o.getAriaAttributes(m);if(e){return{contentId:e.contentId,ariaHasPopup:e.ariaHasPopup,role:this.isDialog()?"combobox":null,roleDescription:e.roleDescription};}return C.prototype.getAriaAttributes.apply(this,arguments);};P.prototype.shouldOpenOnClick=function(){var o=this._getContent();return!!o&&o.shouldOpenOnClick();};P.prototype.shouldOpenOnNavigate=function(){var o=this._getContent();return!!o&&o.shouldOpenOnNavigate();};P.prototype.isFocusInHelp=function(){var o=this._getContent();return!!o&&o.isFocusInHelp();};P.prototype.isMultiSelect=function(){var o=this._getContent();return!!o&&o.isMultiSelect();};P.prototype.isTypeaheadSupported=function(){var o=this._getContent();return o&&o.isSearchSupported();};P.prototype.exit=function(){if(this._oCurrentContent){if(!this._oCurrentContent.bIsDestroyed){this._oCurrentContent.destroy();}this._oCurrentContent=null;}C.prototype.exit.apply(this,arguments);};return P;});
