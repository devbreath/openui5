/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/field/ConditionsType','sap/ui/mdc/condition/FilterOperatorUtil','sap/ui/mdc/condition/Operator','sap/ui/mdc/condition/Condition','sap/ui/mdc/enum/ConditionValidated','sap/ui/mdc/enum/BaseType',"sap/ui/mdc/util/DateUtil",'sap/ui/model/SimpleType','sap/ui/model/FormatException','sap/ui/model/ParseException','sap/ui/model/ValidateException','sap/m/DynamicDate','sap/m/library'],function(C,F,O,a,b,B,D,S,c,P,V,d,l){"use strict";var e=C.extend("sap.ui.mdc.field.DynamicDateRangeConditionsType",{constructor:function(o,i){S.apply(this,arguments);this.sName="ConditionsDateRange";this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");}});e.prototype.destroy=function(){S.prototype.destroy.apply(this,arguments);this._bDestroyed=true;};e.prototype.formatValue=function(n,I){if(n==undefined||n==null||this._bDestroyed){return null;}if(!Array.isArray(n)){throw new c("No valid conditions provided");}var M=h.call(this);var r;if(M!==1){throw new c("MaxConditions must be 1");}if(n.length===1){var o=n[0];var p=F.getOperator(o.operator);if(!o.operator||!p){throw new c("No valid condition provided, Operator wrong.");}var v=[];var s=m.call(this);var q=F.getDynamicDateOptionForOperator(p,l.StandardDynamicDateRangeKeys,s);for(var i=0;i<p.valueTypes.length;i++){if(q&&p.valueTypes[i]===O.ValueType.Self){v.push(f.call(this,o.values[i]));}else if(p.valueTypes[i]&&p.valueTypes[i]!==O.ValueType.Static){v.push(o.values[i]);}}if(!q){q=F.getCustomDynamicDateOptionForOperator(p,s);}var t=_.call(this,s);r=t.formatValue({operator:q,values:v},I);}return r;};function _(s){if(!this._oDynamicDateType){var o={date:{source:{pattern:"timestamp"}},"int":{}};if(s===B.DateTime){o.datetime={source:{pattern:"timestamp"}};}this._oDynamicDateType=new d(o);}return this._oDynamicDateType;}function f(v){var t=j.call(this);var M=t.getModelFormat();var o=M.parse(v);return o.getTime();}function g(t){var T=j.call(this);var M=T.getModelFormat();var o=new Date(t);o.setUTCMilliseconds(0);var v=M.format(o);return v;}e.prototype.parseValue=function(v,I){if(this._bDestroyed){return null;}if(h.call(this)!==1){throw new P("Only one condition supported for parsing");}var o=k.call(this);var n=[];if(v&&v.operator){if(v.operator==="PARSEERROR"){throw new P(v.values[0]);}var s=v.operator;var p=F.getOperatorForDynamicDateOption(s,m.call(this));s=p.name;if(p){var q=m.call(this);var r=_.call(this,q);var R=r.parseValue(v,I);var t=[];for(var i=0;i<p.valueTypes.length;i++){if(l.StandardDynamicDateRangeKeys[v.operator]&&p.valueTypes[i]===O.ValueType.Self){t.push(g.call(this,R.values[i]));}else if(p.valueTypes[i]&&p.valueTypes[i]!==O.ValueType.Static){t.push(R.values[i]);}}var u=a.createCondition(p.name,t,undefined,undefined,b.NotValidated);F.updateConditionValues(u);F.checkConditionsEmpty(u,o);n.push(u);}}return n;};e.prototype.validateValue=function(n){if(n===undefined||n===null||this._bDestroyed){return;}if(!Array.isArray(n)){throw new V("No valid conditions provided");}var t=j.call(this);var o=k.call(this);for(var i=0;i<n.length;i++){var p=n[i];if(typeof p!=="object"||!p.operator||!p.values||!Array.isArray(p.values)){throw new V(this._oResourceBundle.getText("field.VALUE_NOT_VALID"));}var q=F.getOperator(p.operator);if(!q||o.indexOf(q.name)===-1){throw new V("No valid condition provided, Operator wrong.");}q.validate(p.values,t);}};function h(){var M=1;if(this.oFormatOptions.hasOwnProperty("maxConditions")){M=this.oFormatOptions.maxConditions;}return M;}function j(){var t=this.oFormatOptions.valueType;if(!t){throw new Error("Type missing");}return t;}function k(){var o=this.oFormatOptions.operators;if(!o||o.length===0){o=F.getOperatorsForType(m.call(this));}return o;}function m(){var t=j.call(this);var T=t.getMetadata().getName();var o=t.getFormatOptions();var i=t.getConstraints();var n=this.oFormatOptions.delegate;var p=this.oFormatOptions.payload;var s=n?n.getTypeUtil(p).getBaseType(T,o,i):B.Date;return s;}return e;});
