/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/base/ManagedObjectObserver','sap/base/util/merge','sap/base/util/deepEqual','sap/ui/mdc/condition/Condition','sap/ui/mdc/condition/FilterOperatorUtil','sap/ui/mdc/condition/Operator','sap/ui/mdc/field/ConditionType','sap/ui/mdc/enum/EditMode','sap/ui/mdc/enum/FieldDisplay','sap/ui/mdc/enum/BaseType','sap/ui/mdc/enum/ConditionValidated','sap/ui/mdc/Field','sap/ui/mdc/ValueHelp','sap/ui/mdc/valuehelp/Popover','sap/ui/mdc/valuehelp/content/FixedList','sap/ui/mdc/field/ListFieldHelpItem','sap/ui/model/base/ManagedObjectModel','sap/ui/model/json/JSONModel','sap/ui/model/resource/ResourceModel','sap/ui/model/type/String','sap/ui/core/library','sap/ui/core/InvisibleText','sap/ui/layout/Grid','sap/ui/layout/GridData','sap/m/library','sap/m/Button','sap/m/Panel','sap/base/Log','sap/ui/core/InvisibleMessage','sap/ui/thirdparty/jquery'],function(C,M,m,d,a,F,O,b,E,c,B,e,f,V,P,g,L,h,J,R,S,k,I,G,l,o,p,q,r,s,Q){"use strict";var t=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");sap.ui.getCore().attachLocalizationChanged(function(){t=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");});var u=o.ButtonType;var v=k.ValueState;var w=k.InvisibleMessageMode;var D=C.extend("sap.ui.mdc.field.DefineConditionPanel",{metadata:{library:"sap.ui.mdc",properties:{conditions:{type:"object[]",group:"Data",defaultValue:[],byValue:true},formatOptions:{type:"object",defaultValue:{}},label:{type:"string",defaultValue:""},inputOK:{type:"boolean",defaultValue:true}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},events:{conditionProcessed:{}}},_oManagedObjectModel:null,renderer:{apiVersion:2,render:function(i,j){i.openStart("section",j);i.class("sapUiMdcDefineConditionPanel");i.openEnd();i.renderControl(j.getAggregation("_content"));i.close("section");}},init:function(){sap.ui.getCore().getMessageManager().registerObject(this,true);C.prototype.init.apply(this,arguments);this.oInvisibleMessage=s.getInstance();this._oManagedObjectModel=new h(this);this._oObserver=new M(_.bind(this));this._oObserver.observe(this,{properties:["conditions","formatOptions"]});$.call(this);this.setModel(this._oManagedObjectModel,"$this");this.setModel(this._oManagedObjectModel,"$condition");},exit:function(){sap.ui.getCore().getMessageManager().unregisterObject(this,true);this._oObserver.disconnect();this._oObserver=undefined;if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null;}if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType;}this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;},byId:function(i){return sap.ui.getCore().byId(this.getId()+"--"+i);},onBeforeRendering:function(){if(!this.getModel("$i18n")){this.setModel(new R({bundleName:"sap/ui/mdc/messagebundle",async:false}),"$i18n");}if(this.getConditions().length===0){this.updateDefineConditions();}},removeCondition:function(j){var n=j.oSource;var p1=n.getBindingContext("$this");var q1=this.getConditions();var r1=p1.getPath();var s1=r1.match(/^.*\/(\d+)\/$/);var t1;if(s1){t1=parseInt(s1[1]);}if(t1>0&&q1.length-1===t1){this._bFocusLastRemoveBtn=true;}this.oInvisibleMessage.announce(t.getText("valuehelp.DEFINECONDITIONS_REMOVECONDITION_ANNOUNCE"),w.Polite);var u1=this.byId("conditions");var v1=u1.getContent();var w1=0;for(var i=0;i<v1.length&&w1<=t1;i++){var x1=v1[i];if(w1===t1&&x1 instanceof f&&x1.hasOwnProperty("_iValueIndex")){if(x1._bParseError){x1.setValue(null);}}if(x1 instanceof p&&x1.getId().endsWith("-removeBtnLarge")){w1++;}}if(q1.length===1&&t1===0){this.addDummyCondition(1);q1=this.getConditions();}q1.splice(t1,1);this.setProperty("conditions",q1,true);o1.call(this,undefined);this.fireConditionProcessed();},addCondition:function(i){var j=this.getConditions();var n=this.getFormatOptions();var p1=n.maxConditions;if(p1===-1||j.length<p1){this.addDummyCondition(j.length+1);if(this.getConditions().length===p1){this._bFocusLastCondition=true;}}},addDummyCondition:function(i){var j=K.call(this);var n=H.call(this);var p1=n.name;var q1=a.createCondition(p1,n.valueDefaults?n.valueDefaults:[],undefined,undefined,e.NotValidated);if(n.valueTypes[0]&&n.valueTypes[0]!==O.ValueType.Static){q1.isInitial=true;}F.updateConditionValues(q1);F.checkConditionsEmpty(q1,j);var r1=this.getConditions();if(i!==undefined){r1.splice(i,0,q1);}else{r1.push(q1);}this.setProperty("conditions",r1,true);if(!q1.isInitial){this.fireConditionProcessed();}},updateDefineConditions:function(){var i=this.getConditions().filter(function(j){var n=F.getOperator(j.operator);return j.validated!==e.Validated||n.exclude;});Z.call(this,i,true,false);if(i.length===0){this.addDummyCondition();}},onChange:function(i){var j=K.call(this);var n=this.getConditions();F.checkConditionsEmpty(n,j);F.updateConditionsValues(n,j);if(i){n.forEach(function(p1){if(!p1.isEmpty){delete p1.isInitial;}});}this.setProperty("conditions",n,true);},onSelectChange:function(i){var j=i.getSource();var n=i.getParameter("promise");n.then(function(p1){var q1=j._sOldKey;var r1=F.getOperator(p1);var s1=q1&&F.getOperator(q1);var t1=j.getBindingContext("$this").getObject();var u1=this.getConditions();var v1=F.indexOfCondition(t1,u1);if(v1>=0){t1=u1[v1];}if(r1&&s1){var w1=false;if(!d(r1.valueTypes[0],s1.valueTypes[0])&&r1.valueTypes[0]!==O.ValueType.Static){if(v1>=0){t1.values.forEach(function(x1,y1){if(x1!==null){if((r1.valueTypes[y1]===O.ValueType.Self&&s1.valueTypes[y1]===O.ValueType.SelfNoParse)||(r1.valueTypes[y1]===O.ValueType.SelfNoParse&&s1.valueTypes[y1]===O.ValueType.Self)){var z1=z.call(this,r1.name,y1);var A1=z.call(this,s1.name,y1);var B1=A1.formatValue(t1.values[y1],"string");var C1=z1.parseValue(B1,"string");if(C1!==t1.values[y1]){t1.values[y1]=z1.parseValue(B1,"string");w1=true;}}else{t1.values[y1]=null;w1=true;}}}.bind(this));}}if(v1>=0&&r1.valueDefaults){t1.values.forEach(function(x1,y1){if((t1.isInitial&&x1!==r1.valueDefaults[y1])||(x1===null)){t1.values[y1]=r1.valueDefaults[y1];t1.isInitial=true;w1=true;}});}if(!r1.valueTypes[1]&&s1.valueTypes[1]){if(v1>=0){if(t1.values.length>1&&t1.values[1]){t1.values=t1.values.slice(0,1);w1=true;}}}if(t1.invalid){delete t1.invalid;w1=true;}if(w1){F.checkConditionsEmpty(t1,K.call(this));this.setProperty("conditions",u1,true);o1.call(this,false);}}delete j._sOldKey;}.bind(this)).catch(function(p1){var q1=j.getBindingContext("$this").getObject();var r1=this.getConditions();var s1=F.indexOfCondition(q1,r1);if(s1>=0){q1=r1[s1];}q1.invalid=true;this.setProperty("conditions",r1,true);j._sOldKey=j.getValue();o1.call(this,true);}.bind(this));},onPaste:function(n){var p1;var q1=n.srcControl;var r1=this.getFormatOptions();var s1=r1.hasOwnProperty("maxConditions")?r1.maxConditions:-1;var t1=q1.getBindingContext("$condition").getPath();var u1=parseInt(t1.split("/")[2]);if(window.clipboardData){p1=window.clipboardData.getData("Text");}else{p1=n.originalEvent.clipboardData.getData('text/plain');}var v1=p1.split(/\r\n|\r|\n/g);if(v1&&v1.length>1){setTimeout(function(){var r1=m({},this.getFormatOptions());delete r1.fieldHelpID;delete r1.conditionModelName;r1.maxConditions=1;r1.display=c.Value;var w1=new b(r1);var x1=v1.length;var y1=this.getConditions();for(var i=0;i<x1;i++){if(v1[i]){var z1=v1[i].trim();var A1=z1.split(/\t/g);if(A1.length==2&&A1[0]&&A1[1]){var B1=F.getOperator("BT");z1=B1.tokenFormat;for(var j=0;j<2;j++){z1=z1.replace(new RegExp("\\{"+j+"\\}","g"),A1[j]);}}try{var C1=w1.parseValue(z1,"string");w1.validateValue(C1);if(y1.length>u1){y1.splice(u1,1,C1);}else{y1.push(C1);}u1++;}catch(D1){r.error("Paste handling","the pasted value '"+z1+"' could not be handled! "+D1.message);}}}if(s1>=0&&y1.length>s1){y1.splice(s1,y1.length-s1);}if(q1.setDOMValue){q1.setDOMValue("");}F.checkConditionsEmpty(y1);this.setProperty("conditions",y1,true);this.fireConditionProcessed();}.bind(this),0);}},cleanUp:function(){var j=this.byId("conditions");var n=j.getContent();for(var i=0;i<n.length;i++){var p1=n[i];if(p1 instanceof f&&p1.hasOwnProperty("_iValueIndex")){if(p1._bParseError){p1.setValue();}}}this.setProperty("inputOK",true,true);}});function _(i){if(i.name==="value"){x.call(this,i.object,i.current,i.old);}if(i.name==="formatOptions"){var j=this.getConditions();var n=i.current&&i.current.operators;var p1=i.old&&i.old.operators;var q1=false;if(!d(n,p1)){q1=true;T.call(this);}var r1=i.current&&i.current.valueType&&i.current.valueType.getMetadata().getName();var s1=i.old&&i.old.valueType&&i.old.valueType.getMetadata().getName();if(r1!==s1&&j.length>0){if(!q1){T.call(this);}this._bUpdateType=true;c1.call(this);this._bUpdateType=false;Z.call(this,j,true,true);}}if(i.name==="conditions"){if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null;}this._sConditionsTimer=setTimeout(function(){this._sConditionsTimer=null;this.updateDefineConditions();c1.call(this);}.bind(this),0);}}function x(j,n,p1){j._sOldKey=p1;var q1=0;if(n&&p1){var r1=F.getOperator(n);var s1=F.getOperator(p1);var t1=j.getParent();var u1;var v1;q1=t1.indexOfContent(j);u1=t1.getContent()[q1+2];if(u1&&u1.hasOwnProperty("_iValueIndex")&&u1._iValueIndex===0){if(u1 instanceof f&&!u1._bParseError){u1.setValueState(v.None);u1.setValueStateText();}v1=t1.getContent()[q1+3];if(v1&&v1.hasOwnProperty("_iValueIndex")&&v1._iValueIndex===1){if(v1 instanceof f&&!v1._bParseError){v1.setValueState(v.None);v1.setValueStateText();}}else{v1=undefined;}}else{u1=undefined;}if(r1.createControl||s1.createControl){if(u1){u1.destroy();}if(v1){v1.destroy();}}else{if(u1&&r1.valueTypes[0]!==s1.valueTypes[0]){u1.unbindProperty("value");}if(v1&&r1.valueTypes[1]!==s1.valueTypes[1]&&s1.valueTypes[1]){v1.unbindProperty("value");}}}if(!n){var w1=j.getBindingContext("$this").getObject();if(w1){var x1=this.getConditions();q1=F.indexOfCondition(w1,x1);if(q1>=0){w1=x1[q1];w1.operator=p1;this.setProperty("conditions",x1,true);}}}var y1=this.oOperatorModel.getData();var z1;for(var i=0;i<y1.length;i++){var A1=y1[i];if(A1.key===n){z1=A1.text;break;}}j.setAdditionalValue(z1);this.onChange();}function y(i,j,n,p1){var q1=F.getOperator(i.operator);if(!q1||!q1.valueTypes[j]){return null;}var r1=z.call(this,q1.name,j);var s1=this._oManagedObjectModel.getContext(p1.getPath()+"values/"+j+"/");var t1;if(q1.createControl){t1=q1.createControl(r1,"$this>",j,n);}if(!t1){t1=new f(n,{delegate:Y.call(this),value:{path:"$this>",type:r1,mode:'TwoWay',targetType:'raw'},editMode:{parts:[{path:"$condition>operator"},{path:"$condition>invalid"}],formatter:f1},multipleLines:false,width:"100%"});}if(t1.getMetadata().hasProperty("placeholder")){if(j===0){t1.bindProperty("placeholder",{path:"$condition>operator",formatter:j1});}else{t1.bindProperty("placeholder",{path:"$condition>operator",formatter:k1});}}t1._iValueIndex=j;if(t1.attachChange){t1.attachChange(this.onChange.bind(this));}t1.onpaste=this.onPaste.bind(this);t1.setLayoutData(new l({span:{parts:[{path:"$condition>"},{path:"$this>/formatOptions"}],formatter:i1.bind(this)}}));t1.setBindingContext(s1,"$this");t1.setBindingContext(p1,"$condition");t1.setFieldGroupIds([p1.getPath()]);return t1;}function z(i,j){var n=U.call(this);var p1=F.getOperator(i);if(p1.valueTypes[j]&&[O.ValueType.Self,O.ValueType.Static].indexOf(p1.valueTypes[j])===-1){n=p1._createLocalType(p1.valueTypes[j],n);}var q1=false;if(p1.valueTypes[j]===O.ValueType.Static){q1=true;n=W.call(this);}var r1=q1?B.String:X.call(this,n);var s1;switch(r1){case B.Numeric:var t1=n.getFormatOptions();if(t1&&t1.hasOwnProperty("emptyString")&&t1.emptyString===null){s1=n;}else{s1=A(n,{emptyString:null});}break;case B.Date:case B.Time:case B.DateTime:s1=n;break;default:if(n.getConstraints()&&n.getConstraints().hasOwnProperty("nullable")&&n.getConstraints().nullable===false){s1=A(n);if(n._bCreatedByOperator){s1=p1._createLocalType(p1.valueTypes[j],n);}}else{s1=n;}break;}return s1;}function A(i,n,j){var p1=sap.ui.require(i.getMetadata().getName().replace(/\./g,"/"));var q1=m(i.getFormatOptions(),n||{});var r1=m(i.getConstraints(),j||{});if(r1.hasOwnProperty("nullable")&&r1.nullable===false){r1.nullable=true;}return new p1(q1,r1);}function H(){var j=K.call(this);var n;var p1=this.getFormatOptions().defaultOperatorName;if(p1){n=F.getOperator(p1);}else{var q1=U.call(this);var r1=X.call(this,q1);n=F.getDefaultOperator(r1);}if(n&&j.indexOf(n.name)<0){for(var i=0;i<j.length;i++){n=F.getOperator(j[i]);if(!n||n.exclude||!n.hasRequiredValues()){n=undefined;}else{break;}}}if(!n){n=F.getOperator(j[0]);}return n;}function K(){var i=this.getFormatOptions();var j=i&&i.operators;if(!j||j.length===0){j=F.getOperatorsForType(B.String);}return j;}function N(){var j;var n=K.call(this);for(var i=0;i<n.length;i++){var p1=n[i];var q1=F.getOperator(p1);if(!j){j=q1.group.id;}else if(j!==q1.group.id){return true;}}return false;}function T(){if(!this.oOperatorModel){return;}var j=U.call(this);var n=K.call(this);var p1=[];var q1=N.call(this);var r1=this.getId()+"--rowSelect-help-pop-fl";var s1=sap.ui.getCore().byId(r1);var t1;if(q1){t1=new L({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}",groupKey:"{om>groupId}",groupText:"{om>groupText}"});}else{t1=new L({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}"});}s1.bindAggregation("items",{path:'om>/',templateShareable:false,template:t1});s1.setGroupable(q1);for(var i=0;i<n.length;i++){var u1=n[i];var v1=F.getOperator(u1);if(!v1||(v1.showInSuggest!==undefined&&v1.showInSuggest==false)){continue;}var w1=v1.textKey||"operators."+v1.name+".longText";var x1=v1.getTypeText(w1,X.call(this,j).toLowerCase());if(x1===w1){x1=v1.longText;}var y1=v1.additionalInfo;if(y1===undefined){if(y1!==""&&v1.formatRange){y1=v1.formatRange(v1._getRange(undefined,j),j);}else if(!q1){y1=v1.group.text;}}p1.push({key:v1.name,text:x1,additionalText:y1,groupId:v1.group.id,groupText:v1.group.text});}this.oOperatorModel.setData(p1);}function U(){var i=this.getFormatOptions();var j=i&&i.valueType;if(!j){j=W.call(this);}return j;}function W(){if(!this._oDefaultType){this._oDefaultType=new S();}return this._oDefaultType;}function X(i){var j=i.getMetadata().getName();var n=i.getFormatOptions();var p1=i.getConstraints();var q1=this.getFormatOptions().delegate;var r1=this.getFormatOptions().payload;var s1=q1?q1.getTypeUtil(r1).getBaseType(j,n,p1):B.String;if(s1===B.Unit){s1=B.Numeric;}return s1;}function Y(){var i=this.getFormatOptions();var n=i.delegateName||"sap/ui/mdc/field/FieldBaseDelegate";var j=i.payload;return{name:n,payload:j};}function Z(j,n,p1){var q1=U.call(this);var r1=[];var i=0;for(i=0;i<j.length;i++){var s1=j[i];var t1=F.getOperator(s1.operator);if(t1&&t1.valueTypes[0]===O.ValueType.Static&&(s1.values.length===0||p1)){if(t1.getStaticText){var u1=t1.getStaticText(q1,X.call(this,q1));if(s1.values.length>0){s1.values[0]=u1;}else{s1.values.push(u1);}r1.push(i);}}}if(r1.length>0){this.setProperty("conditions",j,true);}}function $(){var i=new I(this.getId()+"--ivtOperator",{text:"{$i18n>valuehelp.DEFINECONDITIONS_OPERATORLABEL}"});var j=new q({headerText:"{$this>/label}",expanded:true,height:"100%",backgroundDesign:"Transparent"}).addStyleClass("sapMdcDefineconditionPanel");j.addDependent(new V(this.getId()+"--rowSelect-help",{typeahead:new P(this.getId()+"--rowSelect-help-pop",{content:[new g(this.getId()+"--rowSelect-help-pop-fl",{filterList:false,useFirstMatch:true})]})}));var n=new G(this.getId()+"--conditions",{width:"100%",hSpacing:0,vSpacing:0,containerQuery:true}).addStyleClass("sapUiMdcDefineConditionGrid");e1.call(this,undefined,n,0,null,0);j.addContent(i);j.addContent(n);this._oInvisibleAddOperatorButtonText=new I({text:t.getText("valuehelp.DEFINECONDITIONS_ADDCONDITION_DESCRIPTION")});j.addContent(this._oInvisibleAddOperatorButtonText);var p1=new p(this.getId()+"--addBtn",{press:this.addCondition.bind(this),type:u.Default,text:"{$i18n>valuehelp.DEFINECONDITIONS_ADDCONDITION}",layoutData:new l({span:"XL2 L3 M3 S3",indent:"XL9 L8 M8 S7",linebreak:true,visibleS:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:a1.bind(this)},visibleM:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:a1.bind(this)},visibleL:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:a1.bind(this)},visibleXL:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:a1.bind(this)}}),ariaDescribedBy:this._oInvisibleAddOperatorButtonText});n.addContent(p1);n.attachValidateFieldGroup(m1,this);this.setAggregation("_content",j);}function a1(i,j){var n=j.hasOwnProperty("maxConditions")?j.maxConditions:-1;return n===-1||i.length<n;}function b1(i,j){var n=j.hasOwnProperty("maxConditions")?j.maxConditions:-1;return n!==1;}function c1(){var j=this.getConditions();var n=this.byId("conditions");var p1;var q1=-1;var r1=0;for(var i=0;i<j.length;i++){var s1=j[i];var t1=F.getOperator(s1.operator);if(s1.validated!==e.Validated||t1.exclude){var u1=this._oManagedObjectModel.getContext("/conditions/"+i+"/");q1++;if(!this.oOperatorModel){this.oOperatorModel=new J();this.setModel(this.oOperatorModel,"om");T.call(this);}p1=n.getContent();if(p1[r1]&&p1[r1].isA("sap.ui.mdc.Field")){r1=l1.call(this,s1,n,r1,u1,q1);}else{r1=e1.call(this,s1,n,r1,u1,q1);}}}p1=n.getContent();while(p1[r1]&&p1[r1]!==this.byId("addBtn")){p1[r1].destroy();r1++;}if(this._bFocusLastCondition){p1[0].focus();this._bFocusLastCondition=false;}if(this._bFocusLastRemoveBtn){r1=d1.call(this,["-removeBtnLarge","-removeBtnSmall"]);p1[r1].focus();this._bFocusLastRemoveBtn=false;}}function d1(j){var p1=this.byId("conditions");var q1=p1.getContent();var n=q1.length-1;if(!Array.isArray(j)){j=[j];}var i=0;var r1=j[i];while(n>=0&&r1!==undefined){var s1=q1[n];if(s1.getId().endsWith(r1)){var t1=Q(s1.getDomRef());if(t1.is(":visible")){return n;}else{i++;r1=j[i];}}n--;}return 0;}function e1(j,n,p1,q1,r1){var s1=this.getId()+"--"+r1;if(!this._oOperatorFieldType){this._oOperatorFieldType=new S({},{minLength:1});}var t1=new f(s1+"-operator",{value:{path:"$this>operator",type:this._oOperatorFieldType},width:"100%",display:c.Description,editMode:E.Editable,multipleLines:false,fieldHelp:this.getId()+"--rowSelect-help",change:this.onSelectChange.bind(this),ariaLabelledBy:this.getId()+"--ivtOperator"}).setLayoutData(new l({span:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:h1.bind(this)},linebreak:true})).setBindingContext(q1,"$this");if(q1){t1.setFieldGroupIds([q1.getPath()]);}this._oObserver.observe(t1,{properties:["value"]});n.insertContent(t1,p1);p1++;var u1=new p(s1+"--removeBtnSmall",{press:this.removeCondition.bind(this),type:u.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}"}).setLayoutData(new l({span:"XL1 L1 M1 S2",indent:{path:"$this>operator",formatter:g1},visibleS:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:b1.bind(this)},visibleM:false,visibleL:false,visibleXL:false})).setBindingContext(q1,"$this");if(q1){u1.setFieldGroupIds([q1.getPath()]);}n.insertContent(u1,p1);p1++;if(j){for(var i=0;i<j.values.length;i++){var v1=y.call(this,j,i,s1+"-values"+i,q1);if(v1){n.insertContent(v1,p1);p1++;}}}var w1=new p(s1+"--removeBtnLarge",{press:this.removeCondition.bind(this),type:u.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}"}).setLayoutData(new l({span:"XL1 L1 M1 S1",indent:{path:"$this>operator",formatter:g1},visibleS:false,visibleM:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:b1.bind(this)},visibleL:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:b1.bind(this)},visibleXL:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:b1.bind(this)}})).setBindingContext(q1,"$this");n.insertContent(w1,p1);p1++;return p1;}function f1(i,j){if(!i){return E.Display;}else if(j){return E.ReadOnly;}var n=F.getOperator(i);var p1=false;if(n&&n.valueTypes[0]===O.ValueType.Static){p1=true;}return p1?E.Display:E.Editable;}function g1(i){var j=i&&F.getOperator(i);if(!j||!j.valueTypes[0]||(j.valueTypes[0]===O.ValueType.Static&&!j.getStaticText)){return"XL8 L8 M8 S0";}else{return"";}}function h1(i,j){var n=j.hasOwnProperty("maxConditions")?j.maxConditions:-1;var p1="XL3 L3 M3 ";if(n===1){p1+="S12";}else{p1+="S10";}return p1;}function i1(i,j){var n=j.hasOwnProperty("maxConditions")?j.maxConditions:-1;var p1=i&&F.getOperator(i.operator);var q1="";if(p1&&p1.valueTypes[1]){q1="XL4 L4 M4 ";}else{q1="XL8 L8 M8 ";}if(n===1){q1+="S12";}else{q1+="S10";}return q1;}function j1(i){var j=i&&F.getOperator(i);if(j&&j.aLabels){return j.aLabels[0];}else if(j&&j.valueTypes[1]){return t.getText("valuehelp.DEFINECONDITIONS_FROM");}else{return t.getText("valuehelp.DEFINECONDITIONS_VALUE");}}function k1(i){var j=i&&F.getOperator(i);if(j&&j.aLabels){return j.aLabels[1];}else if(j&&j.valueTypes[1]){return t.getText("valuehelp.DEFINECONDITIONS_TO");}}function l1(j,n,p1,q1,r1){var s1=this.getId()+"--"+r1;var t1=n.getContent();var u1;var v1=t1[p1];v1.setBindingContext(q1,"$this");if(q1){v1.setFieldGroupIds([q1.getPath()]);}if(v1.getValueState()===v.Error&&!j.invalid){v1.setValue(v1.getValue());}p1++;var w1=t1[p1];w1.setBindingContext(q1,"$this");if(q1){w1.setFieldGroupIds([q1.getPath()]);}p1++;var x1;var y1=t1[p1];var z1;if(y1.hasOwnProperty("_iValueIndex")&&y1._iValueIndex===0){if(j.values.length>0){x1=this._oManagedObjectModel.getContext(q1.getPath()+"values/0/");y1.setBindingContext(x1,"$this");y1.setBindingContext(q1,"$condition");if(y1.getMetadata().hasProperty("value")&&(this._bUpdateType||!y1.getBindingInfo("value"))){u1=z.call(this,j.operator,0);y1.bindProperty("value",{path:"$this>",type:u1});}p1++;z1=t1[p1];if(z1.hasOwnProperty("_iValueIndex")&&z1._iValueIndex===1){if(j.values.length>1){x1=this._oManagedObjectModel.getContext(q1.getPath()+"values/1/");z1.setBindingContext(x1,"$this");if(z1.getMetadata().hasProperty("value")&&(this._bUpdateType||!z1.getBindingInfo("value"))){u1=z.call(this,j.operator,1);z1.bindProperty("value",{path:"$this>",type:u1});}p1++;}else{z1.destroy();}}else if(j.values.length>1){z1=y.call(this,j,1,s1+"-values1",q1);if(z1){n.insertContent(z1,p1);p1++;}}}else{y1.destroy();y1=undefined;z1=t1[p1+1];if(z1&&z1.hasOwnProperty("_iValueIndex")&&z1._iValueIndex===1){z1.destroy();}}}else if(j.values.length>0){for(var i=0;i<j.values.length;i++){var A1=y.call(this,j,i,s1+"-values"+i,q1);if(A1){n.insertContent(A1,p1);p1++;}}}t1=n.getContent();var B1=t1[p1];B1.setBindingContext(q1,"$this");p1++;return p1;}function m1(i){var j=i.getSource();while(!(j.getParent()instanceof G)){j=j.getParent();}n1.call(this,j);}function n1(i){var j=i.getParent();var n=j.indexOfContent(i);var p1;if(i.getId().endsWith("-operator")){p1=i.getBindingContext("$this");n=n+2;i=j.getContent()[n];}else if(i.getId().endsWith("-removeBtnSmall")){p1=i.getBindingContext("$this");n=n+1;i=j.getContent()[n];}else{p1=i.getBindingContext("$condition");}var q1;var r1=p1.getObject();var s1=F.getOperator(r1.operator);var t1=!!r1.invalid;if(!t1&&s1.valueTypes.length>0&&s1.valueTypes[0]!==O.ValueType.Static){if(s1.valueTypes.length>1&&s1.valueTypes[1]){if(i.hasOwnProperty("_iValueIndex")&&i._iValueIndex===0){q1=j.getContent()[n+1];}else if(i.hasOwnProperty("_iValueIndex")&&i._iValueIndex===1){q1=j.getContent()[n-1];}}if(i.getMetadata().getAllProperties().valueState&&!i._bParseError&&(!q1||!q1._bParseError)){var u1=i.getBinding("value").getType();try{s1.validate(r1.values,u1);i.setValueState(v.None);i.setValueStateText();if(q1&&q1.getMetadata().getAllProperties().valueState){q1.setValueState(v.None);q1.setValueStateText();}}catch(v1){t1=true;i.setValueState(v.Error);i.setValueStateText(v1.message);if(q1&&q1.getMetadata().getAllProperties().valueState){q1.setValueState(v.Error);q1.setValueStateText(v1.message);}}}}o1.call(this,t1);this.fireConditionProcessed();}function o1(j){var i=0;if(j!==true){var n=this.getConditions();for(i=0;i<n.length;i++){if(n[i].invalid){j=true;break;}}}if(j!==true){var p1=this.byId("conditions");var q1=p1.getContent();j=false;for(i=0;i<q1.length;i++){var r1=q1[i];if(r1.hasOwnProperty("_iValueIndex")&&r1.getValueState&&r1.getValueState()===v.Error){j=true;break;}}}this.setProperty("inputOK",!j,true);}return D;});
