/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./GridTableType","./ResponsiveTableType","sap/base/Log","sap/m/library","sap/m/Label","sap/ui/model/json/JSONModel","sap/ui/model/base/ManagedObjectModel","sap/ui/core/Control","sap/ui/core/Core"],function(G,R,L,M,a,J,b,C,c){"use strict";var d=C.extend("sap.ui.mdc.table.Column",{metadata:{library:"sap.ui.mdc",defaultAggregation:"template",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},minWidth:{type:"float",group:"Behavior",defaultValue:8},header:{type:"string"},headerVisible:{type:"boolean",group:"Misc",defaultValue:true},hAlign:{type:"sap.ui.core.HorizontalAlign",defaultValue:"Begin"},importance:{type:"sap.ui.core.Priority",group:"Behavior",defaultValue:"None"},initialIndex:{type:"int",defaultValue:-1},dataProperty:{type:"string"}},aggregations:{template:{type:"sap.ui.core.Control",multiple:false},creationTemplate:{type:"sap.ui.core.Control",multiple:false}}},renderer:{apiVersion:2,render:function(r,o){r.openStart("div",o);r.openEnd();if(o._oColumnHeaderLabel){r.renderControl(o._oColumnHeaderLabel.getLabel());}r.close("div");}}});d.prototype.init=function(){this.mSkipPropagation={template:true,creationTemplate:true};this._oManagedObjectModel=new b(this);this._oSettingsModel=new J({width:this.getWidth(),calculatedWidth:null,p13nWidth:null,resizable:false});};d.prototype.getInnerColumn=function(){var t=this.getTable();if(t&&(!this._oInnerColumn||this._oInnerColumn.isDestroyed())){this._oInnerColumn=this._createInnerColumn();}return this._oInnerColumn;};d.prototype._createInnerColumn=function(){var t=this.getTable();var o;var w={parts:[{path:"$this>/width"},{path:"$columnSettings>/calculatedWidth"},{path:"$columnSettings>/p13nWidth"}],formatter:function(W,s,p){return p||s||W;}};this._readP13nValues();if(t._bMobileTable){o=R.createColumn(this.getId()+"-innerColumn",{width:w,autoPopinWidth:"{$this>/minWidth}",hAlign:"{$this>/hAlign}",header:this._getColumnHeaderLabel(),importance:"{$this>/importance}",popinDisplay:"Inline",tooltip:"{$this>/tooltip}"});}else{o=G.createColumn(this.getId()+"-innerColumn",{width:w,minWidth:{path:"$this>/minWidth",formatter:function(m){return Math.round(m*parseFloat(M.BaseFontSize));}},hAlign:"{$this>/hAlign}",label:this._getColumnHeaderLabel(),resizable:"{$columnSettings>/resizable}",autoResizable:"{$columnSettings>/resizable}",tooltip:"{$this>/tooltip}",template:this.getTemplateClone()});o.setCreationTemplate(this.getCreationTemplateClone());}o.setModel(this._oManagedObjectModel,"$this");o.setModel(this._oSettingsModel,"$columnSettings");return o;};var e=C.extend("sap.ui.mdc.table.ColumnHeaderLabel",{metadata:{"final":true,aggregations:{label:{type:"sap.m.Label",multiple:false}},associations:{column:{type:"sap.ui.mdc.table.Column"}}},renderer:{apiVersion:2,render:function(r,o){r.openStart("div",o);r.style("width","100%");r.openEnd();r.renderControl(c.byId(o.getColumn()));r.close("div");}},getText:function(){return this.getLabel().getText();},clone:function(){return this.getLabel().clone();}});d.prototype._getColumnHeaderLabel=function(){var t=this.getTable();if(t&&(!this._oColumnHeaderLabel||this._oColumnHeaderLabel.isDestroyed())){this._oColumnHeaderLabel=new e({column:this,label:new a({width:"{= ${$this>/headerVisible} ? null : '0px' }",text:"{$this>/header}",textAlign:"{$this>/hAlign}",tooltip:t._bMobileTable?"{$this>/tooltip}":"",wrapping:{parts:[{path:"$this>/headerVisible"},{path:"$columnSettings>/resizable"}],formatter:function(h,r){return t._bMobileTable&&h&&!r;}},wrappingType:t._bMobileTable?"Hyphenated":null})});}return this._oColumnHeaderLabel;};d.prototype.getTemplateClone=function(){var t=this.getTable();var T=this.getTemplate();if(t&&T&&(!this._oTemplateClone||this._oTemplateClone.isDestroyed())){this._oTemplateClone=T.clone();if(!t._bMobileTable){if(this._oTemplateClone.setWrapping){this._oTemplateClone.setWrapping(false);}if(this._oTemplateClone.setRenderWhitespace){this._oTemplateClone.setRenderWhitespace(false);}}}return this._oTemplateClone;};d.prototype.getCreationTemplateClone=function(){var t=this.getTable();var o=this.getCreationTemplate();if(t&&o&&(!this._oCreationTemplateClone||this._oCreationTemplateClone.isDestroyed())){this._oCreationTemplateClone=o.clone();if(!t._bMobileTable){if(this._oCreationTemplateClone.setWrapping){this._oCreationTemplateClone.setWrapping(false);}if(this._oCreationTemplateClone.setRenderWhitespace){this._oCreationTemplateClone.setRenderWhitespace(false);}}}return this._oCreationTemplateClone;};d.prototype.setHeader=function(h){this.setProperty("header",h,true);var l=this.getDomRef();if(l){l.textContent=this.getHeader();}return this;};d.prototype.setTooltip=function(t){if(t&&t.isA&&t.isA("sap.ui.core.TooltipBase")){L.error("The control sap.ui.mdc.table.Column allows only strings as tooltip, but given is "+t);return this;}return C.prototype.setTooltip.apply(this,arguments);};d.prototype._onTableChange=function(E){if(E.getParameter("name")==="enableColumnResize"){this._readTableSettings();}};d.prototype._readTableSettings=function(){var t=this.getTable();this._oSettingsModel.setProperty("/resizable",t.getEnableColumnResize());};d.prototype.setParent=function(p){var P=this.getTable();C.prototype.setParent.apply(this,arguments);if(this._bIsBeingMoved){return;}this._disconnectFromTable(P);this._connectToTable();};d.prototype._connectToTable=function(){var t=this.getTable();if(!t){return;}this._calculateColumnWidth();this._readP13nValues();this._readTableSettings();t.attachEvent("_change",this._onTableChange,this);};d.prototype._disconnectFromTable=function(t){t=t||this.getTable();if(!t){return;}if(this._oInnerColumn){this._oInnerColumn.destroy("KeepDom");if(!t.isInvalidateSuppressed()){t.invalidate();}}};d.prototype._onModifications=function(){this._readP13nValues();};d.prototype._calculateColumnWidth=function(){var t=this.getTable();if(!t||!t.getEnableAutoColumnWidth()||!this.isPropertyInitial("width")){return;}var p=t.getPropertyHelper();if(p){this._oSettingsModel.setProperty("/calculatedWidth",p.calculateColumnWidth(this));}else{t.awaitPropertyHelper().then(this._calculateColumnWidth.bind(this));}};d.prototype._readP13nValues=function(){var t=this.getTable();var x=t.getCurrentState().xConfig;var p=this.getDataProperty();if(x instanceof Promise){x.then(this._readP13nValues.bind(this));return;}var w=x&&x.aggregations&&x.aggregations.columns&&x.aggregations.columns[p]&&x.aggregations.columns[p].width;this._oSettingsModel.setProperty("/p13nWidth",w);};d.prototype.getTable=function(){var p=this.getParent();return p&&p.isA("sap.ui.mdc.Table")?p:null;};d.prototype.exit=function(){this._disconnectFromTable();["_oManagedObjectModel","_oSettingsModel","_oInnerColumn","_oTemplateClone","_oCreationTemplateClone","_oColumnHeaderLabel"].forEach(function(o){if(this[o]){this[o].destroy();delete this[o];}},this);};return d;});
