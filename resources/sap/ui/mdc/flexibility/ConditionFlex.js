/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/base/util/merge','sap/base/Log','sap/ui/mdc/condition/FilterOperatorUtil','sap/ui/mdc/flexibility/Util'],function(m,L,F,U){"use strict";var g=function(D){return new Promise(function(R,f){sap.ui.require([D],R,f);});};var d=function(c){var o=c&&c.getEngine?c.getEngine().getController(c,"Filter"):null;return o?o.getFilterControl():null;};var a=function(c,o,p,s){var f=d(o);var i=(s===U.REVERT);var b=i?c.getRevertData():c.getContent();if(f&&f.applyConditionsAfterChangesApplied){f.applyConditionsAfterChangesApplied(o);}var e,h=null,M=p.modifier;return M.getProperty(o,"filterConditions").then(function(j){e=m({},j);if(e){for(var k in e){if(k===b.name){h=e[k];break;}}}if(!h){e[b.name]=[];h=e[b.name];}if(!i){c.setRevertData({name:b.name,condition:b.condition});}var n=F.indexOfCondition(b.condition,h);if(n<0){h.push(b.condition);M.setProperty(o,"filterConditions",e);return M.getProperty(o,"delegate").then(function(D){return g(D.name);}).then(function(D){var l=D&&(D.getFilterDelegate?D.getFilterDelegate().addCondition:D.addCondition);if(l){return l(b.name,o,p).catch(function(E){L.error("Error during Delegate.addCondition call: "+E);});}}).finally(function(){if(i){c.resetRevertData();}if(f&&f.addCondition){return f.addCondition(b.name,b.condition);}});}});};var r=function(c,o,p,s){var f=d(o);var i=(s===U.REVERT);var b=i?c.getRevertData():c.getContent();if(f&&f.applyConditionsAfterChangesApplied){f.applyConditionsAfterChangesApplied(o);}var e,h,n=-1,M=p.modifier;return M.getProperty(o,"filterConditions").then(function(j){e=m({},j);if(e){for(var k in e){if(k===b.name){h=e[k];break;}}}if(!i){c.setRevertData({name:b.name,condition:b.condition});}if(h&&(h.length>0)){n=F.indexOfCondition(b.condition,h);if(n>=0){h.splice(n,1);M.setProperty(o,"filterConditions",e);return M.getProperty(o,"delegate").then(function(D){return g(D.name);}).then(function(D){var l=D&&(D.getFilterDelegate?D.getFilterDelegate().removeCondition:D.removeCondition);if(l){return l(b.name,o,p).catch(function(E){L.error("Error during Delegate.removeCondition call: "+E);});}}).finally(function(){if(i){c.resetRevertData();}if(f&&f.removeCondition){return f.removeCondition(b.name,b.condition);}});}}});};var C={};C.addCondition=U.createChangeHandler({apply:a,revert:r});C.removeCondition=U.createChangeHandler({apply:r,revert:a});return C;});
