/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/p13n/Engine','sap/ui/mdc/flexibility/Util'],function(E,U){"use strict";var x={};var c=function(C){if(!C._bWaitForModificationChanges&&C.isA){C._bWaitForModificationChanges=true;E.getInstance().waitForChanges(C).then(function(){if(C._onModifications instanceof Function){C._onModifications();}delete C._bWaitForModificationChanges;});}};var q=function(C,t){var f=function(p){if(C._pQueue===p){delete C._pQueue;}};C._pQueue=C._pQueue instanceof Promise?C._pQueue.then(t):t();C._pQueue.then(f.bind(null,C._pQueue));return C._pQueue;};x.createSetChangeHandler=function(m){if(!m||!m.hasOwnProperty("aggregation")||!m.hasOwnProperty("property")){throw new Error("Please provide a map containing the affected aggregation and property name!");}var a=m.aggregation;var A=m.property;var f=function(C,o,p){return q(o,function(){return E.getInstance().readXConfig(o,{propertyBag:p}).then(function(P){var O=null;if(P&&P.aggregations&&P.aggregations[a]&&P.aggregations[a][C.getContent().name]&&P.aggregations[a][C.getContent().name][A]){O=P.aggregations[a][C.getContent().name][A];}C.setRevertData({name:C.getContent().name,value:O});return E.getInstance().enhanceXConfig(o,{controlMeta:{aggregation:a,property:A},name:C.getContent().name,value:C.getContent().value,propertyBag:p});}).then(function(){c(o);});});};var r=function(C,o,p){return E.getInstance().enhanceXConfig(o,{controlMeta:{aggregation:a,property:A},name:C.getRevertData().name,value:C.getRevertData().value,propertyBag:p}).then(function(){C.resetRevertData();c(o);});};return U.createChangeHandler({apply:f,revert:r});};return x;});
