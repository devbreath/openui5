/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/deepClone","sap/base/util/isEmptyObject","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/base/util/restricted/_omit","sap/ui/base/ManagedObject","sap/ui/fl/apply/_internal/flexObjects/States","sap/ui/fl/Layer","sap/ui/fl/registry/Settings","sap/ui/fl/Utils"],function(d,i,a,O,_,M,S,L,b,U){"use strict";var F=M.extend("sap.ui.fl.apply._internal.flexObjects.FlexObject",{metadata:{properties:{state:{type:"string",defaultValue:S.NEW},fileType:{type:"string",defaultValue:"change"},layer:{type:"string"},flexObjectMetadata:{type:"object",defaultValue:{}},supportInformation:{type:"object",defaultValue:{}},content:{type:"any",defaultValue:{}},texts:{type:"object",defaultValue:{}}}},constructor:function(){M.apply(this,arguments);var o=this.getFlexObjectMetadata();var r=o.reference;if(r){if(!o.namespace){o.namespace=U.createNamespace({reference:r},this.getFileType());}if(!o.projectId){o.projectId=r.replace(".Component","");}}this.setFlexObjectMetadata(o);var s=this.getSupportInformation();if(!s.originalLanguage){s.originalLanguage=U.getCurrentLanguage();}this.setSupportInformation(s);}});F.getMappingInfo=function(){return Object.assign({},{"flexObjectMetadata.changeType":"changeType","flexObjectMetadata.reference":"reference","flexObjectMetadata.namespace":"namespace","flexObjectMetadata.creation":"creation","flexObjectMetadata.projectId":"projectId","flexObjectMetadata.packageName":"packageName","flexObjectMetadata.moduleName":"moduleName","supportInformation.generator":"support.generator","supportInformation.service":"support.service","supportInformation.sourceSystem":"sourceSystem","supportInformation.sourceClient":"sourceClient","supportInformation.user":"support.user","supportInformation.sapui5Version":"support.sapui5Version","supportInformation.sourceChangeFileName":"support.sourceChangeFileName","supportInformation.compositeCommand":"support.compositeCommand","supportInformation.command":"support.command","supportInformation.oDataInformation":"oDataInformation","supportInformation.originalLanguage":"originalLanguage",layer:"layer",fileType:"fileType",id:"fileName",content:"content",texts:"texts"});};F.prototype.getMappingInfo=function(){return F.getMappingInfo();};F.prototype.setContent=function(C,s){this.setProperty("content",C);if(!s){this.setState(S.DIRTY);}return this;};F.prototype.getFlexObjectMetadata=function(){return Object.assign({},this.getProperty("flexObjectMetadata"));};F.prototype.getSupportInformation=function(){return Object.assign({},this.getProperty("supportInformation"));};function c(n,C){if(!Object.values(S).includes(n)){return false;}if(C===S.NEW&&n===S.DIRTY){return false;}return true;}F.prototype.setState=function(s){var C=this.getState();if(C!==s&&c(s,C)){this._sPreviousState=C;this.setProperty("state",s);}return this;};F.prototype.markForDeletion=function(){this.setState(S.DELETED);};F.prototype.restorePreviousState=function(){if(this._sPreviousState){this.setState(this._sPreviousState);delete this._sPreviousState;}};F.prototype.isChangeFromOtherSystem=function(){var s=this.getSupportInformation().sourceSystem;var h=this.getSupportInformation().sourceClient;if(!s||!h){return false;}var o=b.getInstanceOrUndef();if(!o){return true;}var j=o.getSystem();var C=o.getClient();if(!j||!C){return false;}return(s!==j||h!==C);};F.prototype.getNamespace=function(){return this.getFlexObjectMetadata().namespace;};F.prototype.getChangeType=function(){return this.getFlexObjectMetadata().changeType;};F.prototype.isUserDependent=function(){return this.getLayer()===L.USER;};F.prototype.getText=function(t){var T=this.getTexts()[t]||{};return T.value||"";};F.prototype.setText=function(t,n,T,s){var o=Object.assign({},this.getTexts());var N={value:n};if(T){N.type=T;}o[t]=Object.assign({},o[t],N);this.setTexts(o);if(!s){this.setState(S.DIRTY);}return this;};F.prototype.setRequest=function(r){this._sRequest=r;};F.prototype.getRequest=function(){return this._sRequest||"";};F.prototype.getDefinition=function(){return this.convertToFileContent();};function e(k){return k.length?k.charAt(0).toUpperCase()+k.slice(1):k;}function g(s){return typeof this[s]==="function"?this[s].bind(this):function(){throw new Error(s+" is not a valid mutator");};}function f(p){var I=p.split(".");I[0]=e(I[0]);var s=I.shift();var G=g.call(this,"get"+s);var h=g.call(this,"set"+s);return{getValue:function(){var C=d(G());if(I.length>0){return O.get(I,C);}return C;},setValue:function(v){var P=d(G());if(I.length>0){O.set(I,v,P);}else{P=v;}h(P);return this;}.bind(this)};}F.prototype.convertToFileContent=function(){var o={};Object.entries(this.getMappingInfo()).forEach(function(p){var v=f.call(this,p[0]).getValue();if(v!==undefined){O.set(p[1],v,o);}}.bind(this));return o;};function u(p,v){var m=f.call(this,p);var C=m.getValue();if(C!==v){m.setValue(v);}}F.mapFileContent=function(o,m){var v=Object.values(m);var p={};var h=function(k,V,P){var n=P?P+"."+k:k;var I=v.indexOf(n);if(I>=0){var s=Object.keys(m)[I];p[s]=V;}else if(a(V)){Object.entries(V).forEach(function(E){h(E[0],E[1],n);});}};Object.entries(d(o)).forEach(function(E){h(E[0],E[1]);});return p;};F.prototype.update=function(o){var n=_(o,["fileName"]);var p=F.mapFileContent(n,this.getMappingInfo());Object.entries(p).forEach(function(P){u.call(this,P[0],P[1]);}.bind(this));};F.prototype.setResponse=function(r){if(!r||i(r)){return;}this.update(r);this.setState(S.PERSISTED);};return F;});
