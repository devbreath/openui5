/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/initial/_internal/StorageUtils","sap/ui/fl/initial/_internal/StorageResultMerger","sap/ui/fl/initial/_internal/storageResultDisassemble","sap/ui/fl/write/api/Version","sap/ui/fl/Utils","sap/ui/fl/write/_internal/FlexInfoSession"],function(S,a,s,V,U,F){"use strict";function _(C,o,p){if(!o.layers||(o.layers[0]!=="ALL"&&o.layers.indexOf("CUSTOMER")===-1)){delete C.version;return C;}if(b(p.reference)){C.allContexts=true;}if(p.version!==undefined){C.version=p.version;return C;}var v=U.getUrlParameter(V.UrlParameter);if(v===null){delete C.version;}else{C.version=parseInt(v);}return C;}function b(i){var o=F.getByReference(i);return o&&o.initialAllContexts;}function c(p,C){var i=C.map(function(o){var j=Object.assign({},p,{url:o.url,path:o.path});j=_(j,o,p);return o.loadConnectorModule.loadFlexData(j).then(function(r){return r||S.getEmptyFlexDataResponse();}).catch(S.logAndResolveDefault.bind(undefined,S.getEmptyFlexDataResponse(),o,"loadFlexData"));});return Promise.all(i);}function d(r){var i=[];r.forEach(function(R){if(Array.isArray(R)){i=i.concat(R);}else{i.push(R);}});return i;}function e(r){return r.map(function(R){return s(R);});}function f(r){return Promise.resolve(r).then(d).then(e).then(d).then(a.merge);}function g(p){return S.getStaticFileConnector().then(c.bind(this,p));}var h={};h.completeFlexData=function(p){if(!p||!p.reference){return Promise.reject("No reference was provided");}return Promise.all([g(p),p.partialFlexData]).then(f);};h.loadFlexData=function(p){if(!p||!p.reference){return Promise.reject("No reference was provided");}return S.getLoadConnectors().then(c.bind(this,p)).then(f);};return h;});
