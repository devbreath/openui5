/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/security/encodeURL","sap/ui/core/Core","sap/ui/fl/Utils","sap/ui/thirdparty/jquery"],function(L,a,C,F,q){"use strict";var p={v2:"v2",v4:"v4"};function _(Q){if(Q&&Q.split){var s=Q.split(".");return s[s.length-1];}return null;}function b(x){var M=[];try{var E=JSON.parse(x.responseText);if(E&&E.error&&E.error.message&&E.error.message.value){M.push({severity:"error",text:E.error.message.value});}else{M.push({severity:"error",text:x.responseText});}}catch(e){}return M;}function c(o){var B=_(i(o));if(!B){var e=o.getBindingContext?o.getBindingContext():null;if(e&&e.getPath){B=e.getPath();}}if(!B){L.warning("Control not bound to a path");}return B;}function d(M,B,e){return M.metadataLoaded().then(function(){var E=null;if(e){var o=M.oMetadata._getEntityTypeByName(e);E=M.oMetadata._getEntitySetByType(o);}if(!E){E=M.oMetadata._getEntitySetByPath(B);}return E?E.name:null;});}function f(M,B){var o=M.getMetaModel();var s=o.getMetaPath(B);return o.requestObject(s).then(function(e){var S=o.fetchEntityContainer().getResult();var E=S[S.$EntityContainer];var n=Object.keys(E).filter(function(r){return E[r]===e;});return n.length>0&&n[0];});}function g(M,B,e){return M.metadataLoaded().then(function(){var E=null;if(e){E=M.oMetadata._getEntityTypeByName(e);}if(!E){E=M.oMetadata._getEntityTypeByPath(B);}return E?E.name:null;});}function h(M,B){var o=M.getMetaModel();var s=o.getMetaPath(B);return o.requestObject(s).then(function(e){return _(e.$Type);});}function i(o){return o.getEntitySet?o.getEntitySet():null;}function j(o){return o.getEntityType?o.getEntityType():null;}function k(M){var s=null;if(M&&M.sServiceUrl){s=M.sServiceUrl;}if(!s){L.warning("Model has no Service Uri");}return s;}function l(M){if(M){if(M.isA("sap.ui.model.odata.v2.ODataModel")){return p.v2;}else if(M.isA("sap.ui.model.odata.v4.ODataModel")){return p.v4;}}return null;}function m(o){if(o){var M=o.getModel?o.getModel():null;if(l(M)){return M;}L.warning("Unsupported model type or protocol");return null;}L.warning("No Control passed");return null;}var U={};U.checkControlPrerequisites=function(o){if(o){var M=m(o);var s=k(M);var B=c(o);var e=j(o);return Boolean(s&&(B||e));}L.warning("No Control passed");return false;};U.executeRequest=function(r,P){var s=r+this.getUriParameters(P);return new Promise(function(R){var S={type:"GET",async:true,dataType:"json"};q.ajax(s,S).done(function(D){var o=D&&D.d;R({errorOccurred:false,result:o});}).fail(function(e){R({errorOccurred:true,errorMessages:b(e),statusCode:e.status});});});};U.getBoundEntitySet=function(o){var M=m(o);var P=l(M);if(P===p.v2){return d(M,c(o),j(o));}else if(P===p.v4){return f(M,c(o));}return Promise.resolve(null);};U.getBoundEntityType=function(o){var M=m(o);var P=l(M);if(P===p.v2){return g(M,c(o),j(o));}else if(P===p.v4){return h(M,c(o));}return Promise.resolve(null);};U.getNavigationUriForIntent=function(I){return F.getUShellService("CrossApplicationNavigation").then(function(o){if(o&&o.hrefForExternal){return o.hrefForExternal(I);}return Promise.resolve(null);});};U.getServiceUri=function(o){var M=m(o);return k(M);};U.getText=function(t){return C.getLibraryResourceBundle("sap.ui.fl").getText(t);};U.getUriParameters=function(P){if(!P){return"";}var u=[];Object.keys(P).forEach(function(n){if(n){var v="'"+a(P[n]||"")+"'";u.push(a(n)+"="+v);}});return u.length===0?"":"?"+u.join("&");};U.isNavigationSupportedForIntents=function(I){return F.getUShellService("CrossApplicationNavigation").then(function(o){if(o&&o.isNavigationSupported){return o.isNavigationSupported(I).then(function(r){return r.map(function(R){return R&&R.supported===true;});});}return Promise.resolve(I.map(function(){return false;}));});};return U;});
