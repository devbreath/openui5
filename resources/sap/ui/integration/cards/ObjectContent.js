/*!
* OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["./BaseContent","./ObjectContentRenderer","sap/ui/integration/library","sap/m/library","sap/m/FlexItemData","sap/m/HBox","sap/m/VBox","sap/m/Text","sap/m/Title","sap/m/Avatar","sap/m/Link","sap/m/Label","sap/m/ObjectStatus","sap/m/ComboBox","sap/m/TextArea","sap/base/Log","sap/base/util/isEmptyObject","sap/ui/core/ResizeHandler","sap/ui/layout/AlignedFlowLayout","sap/ui/dom/units/Rem","sap/ui/integration/util/BindingHelper","sap/ui/integration/util/BindingResolver","sap/ui/integration/util/Utils","sap/f/AvatarGroup","sap/f/AvatarGroupItem","sap/f/cards/NumericIndicators","sap/f/cards/NumericSideIndicator","sap/f/library","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","sap/ui/core/ListItem"],function(B,O,l,L,F,H,V,T,a,A,b,c,d,C,e,f,g,R,h,j,k,m,U,n,o,N,p,q,r,s,t){"use strict";var u=L.AvatarSize;var v=L.AvatarColor;var w=L.ButtonType;var x=L.FlexRendertype;var y=L.FlexJustifyContent;var z=l.CardActionArea;var D=q.AvatarGroupType;var E=L.ToolbarStyle;var G=B.extend("sap.ui.integration.cards.ObjectContent",{metadata:{library:"sap.ui.integration"},renderer:O});G.prototype.exit=function(){B.prototype.exit.apply(this,arguments);if(this._sResizeListenerId){R.deregister(this._sResizeListenerId);this._sResizeListenerId="";}};G.prototype.onDataChanged=function(){this._handleNoItemsError(this.getParsedConfiguration().hasData);};G.prototype._handleNoItemsError=function(i){if(!i){return;}var I=m.resolveValue(i,this,this.getBindingContext().getPath());if(!I||Array.isArray(I)&&!I.length||g(I)){this.getParent()._handleError("No items available",true);}};G.prototype.setConfiguration=function(i){B.prototype.setConfiguration.apply(this,arguments);i=this.getParsedConfiguration();if(!i){return this;}if(i.groups){this._addGroups(i);}return this;};G.prototype._getRootContainer=function(){var i=this.getAggregation("_content");if(!i){i=new V({renderType:x.Bare});this.setAggregation("_content",i);this._sResizeListenerId=R.register(i,this._onResize.bind(this));}return i;};G.prototype._addGroups=function(I){var J=this._getRootContainer(),K,M=true,P=I.groups||[];P.forEach(function(Q,i){var S=this._createGroup(Q);if(Q.alignment==="Stretch"){S.setLayoutData(new F({growFactor:1}));J.addItem(S);M=true;}else{if(M){K=this._createAFLayout();J.addItem(K);M=false;}K.addContent(S);}if(i===P.length-1){S.addStyleClass("sapFCardObjectGroupLastInColumn");}},this);this._oActions.attach({area:z.Content,actions:I.actions,control:this});};G.prototype._createGroup=function(i){var I;if(typeof i.visible=="string"){I=!U.hasFalsyValueAsString(i.visible);}else{I=i.visible;}var J=new V({visible:I,renderType:x.Bare}).addStyleClass("sapFCardObjectGroup");if(i.title){J.addItem(new a({text:i.title}).addStyleClass("sapFCardObjectItemTitle"));J.addStyleClass("sapFCardObjectGroupWithTitle");}i.items.forEach(function(K){this._createGroupItems(K).forEach(J.addItem,J);},this);return J;};G.prototype._createGroupItems=function(i){var I=i.label,J,K,M;if(typeof i.visible=="string"){K=!U.hasFalsyValueAsString(i.visible);}else{K=i.visible;}if(I){I=k.formattedProperty(I,function(S){return S&&(S[S.length-1]===":"?S:S+":");});J=new c({text:I,visible:K}).addStyleClass("sapFCardObjectItemLabel");J.addEventDelegate({onBeforeRendering:function(){J.setVisible(J.getVisible()&&!!J.getText());}});}M=this._createItem(i,K,J);if(M){M.addStyleClass("sapFCardObjectItemValue");}if(i.icon){var P=new V({renderType:x.Bare,justifyContent:y.Center,items:[J,M]});var Q=new H({visible:K,renderType:x.Bare,items:[this._createGroupItemAvatar(i.icon),P]}).addStyleClass("sapFCardObjectItemLabel");return[Q];}else{return[J,M];}};G.prototype._createGroupItemAvatar=function(i){var S=k.formattedProperty(i.src,function(J){return this._oIconFormatter.formatSrc(J);}.bind(this));var I=new A({displaySize:i.size||u.XS,src:S,initials:i.text,displayShape:i.shape,tooltip:i.alt,backgroundColor:i.backgroundColor||(i.text?undefined:v.Transparent)}).addStyleClass("sapFCardObjectItemAvatar sapFCardIcon");return I;};G.prototype._createItem=function(i,I,J){var K,M=i.value,P=i.tooltip,Q;switch(i.type){case"NumericData":K=this._createNumericDataItem(i,I);break;case"Status":K=this._createStatusItem(i,I);break;case"IconGroup":K=this._createIconGroupItem(i,I);break;case"ButtonGroup":K=this._createButtonGroupItem(i,I);break;case"ComboBox":K=this._createComboBoxItem(i,I,J);break;case"TextArea":K=this._createTextAreaItem(i,I,J);break;case"link":f.warning("Usage of Object Group Item property 'type' with value 'link' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");K=new b({href:i.url||M,text:M,tooltip:P,target:i.target||'_blank',visible:k.reuse(I)});break;case"email":f.warning("Usage of Object Group Item property 'type' with value 'email' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");var S=[];if(i.value){S.push(i.value);}if(i.emailSubject){S.push(i.emailSubject);}Q=k.formattedProperty(S,function(W,X){if(X){return"mailto:"+W+"?subject="+X;}else{return"mailto:"+W;}});K=new b({href:Q,text:M,tooltip:P,visible:k.reuse(I)});break;case"phone":f.warning("Usage of Object Group Item property 'type' with value 'phone' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");Q=k.formattedProperty(M,function(W){return"tel:"+W;});K=new b({href:Q,text:M,tooltip:P,visible:k.reuse(I)});break;default:K=this._createTextItem(i,I,J);}return K;};G.prototype._createNumericDataItem=function(i,I){var J=new V({visible:k.reuse(I)});var K=new N({number:i.mainIndicator.number,numberSize:i.mainIndicator.size,scale:i.mainIndicator.unit,trend:i.mainIndicator.trend,state:i.mainIndicator.state}).addStyleClass("sapUiIntOCNumericIndicators");J.addItem(K);if(i.sideIndicators){i.sideIndicators.forEach(function(M){K.addSideIndicator(new p({title:M.title,number:M.number,unit:M.unit,state:M.state}));});}if(i.details){J.addItem(new T({text:i.details,maxLines:1}).addStyleClass("sapUiIntOCNumericIndicatorsDetails"));}return J;};G.prototype._createStatusItem=function(i,I){var J=new d({text:i.value,visible:k.reuse(I),state:i.state});return J;};G.prototype._createTextItem=function(i,I,J){var K=i.value,M=i.tooltip,P;if(K&&i.actions){P=new b({text:K,tooltip:M,visible:k.reuse(I)});if(J){P.addAriaLabelledBy(J);}else{f.warning("Missing label for Object group item with actions.",null,"sap.ui.integration.widgets.Card");}this._oActions.attach({area:z.ContentItemDetail,actions:i.actions,control:this,actionControl:P,enabledPropertyName:"enabled"});P=new H({renderType:x.Bare,items:P});}else if(K){P=new T({text:K,visible:k.reuse(I),maxLines:i.maxLines});}return P;};G.prototype._createButtonGroupItem=function(i,I){var J=i.template;if(!J){return null;}var K=new r({visible:k.reuse(I),style:E.Clear});K.addStyleClass("sapUiIntCardObjectButtonGroup");var M=new s({icon:k.formattedProperty(J.icon,function(P){return this._oIconFormatter.formatSrc(P);}.bind(this)),text:J.text||J.tooltip,tooltip:J.tooltip||J.text,type:w.Transparent,visible:J.visible});if(J.actions){M.attachPress(function(P){this._onButtonGroupPress(P,J.actions);}.bind(this));}K.bindAggregation("content",{path:i.path||"/",template:M,templateShareable:false});return K;};G.prototype._onButtonGroupPress=function(i,I){var J=i.getSource();var K=m.resolveValue(I,J,J.getBindingContext().getPath());var M=K[0];this.getActions().fireAction(this,M.type,M.parameters);};G.prototype._createIconGroupItem=function(i,I){var J=i.template;if(!J){return null;}var K=new n({avatarDisplaySize:i.size||u.XS,groupType:D.Individual,visible:k.reuse(I)});K._oShowMoreButton.setType(w.Transparent);K._oShowMoreButton.setEnabled(false);if(J.actions){K.attachPress(function(P){this._onIconGroupPress(P,J.actions);}.bind(this));}else{K._setInteractive(false);}var M=new o({src:k.formattedProperty(J.icon.src,function(P){return this._oIconFormatter.formatSrc(P);}.bind(this)),initials:J.icon.text,tooltip:J.icon.alt});K.bindAggregation("items",{path:i.path||"/",template:M,templateShareable:false});return K;};G.prototype._onIconGroupPress=function(i,I){if(i.getParameter("overflowButtonPressed")){}else{var J=i.getParameter("eventSource");var K=m.resolveValue(I,J,J.getBindingContext().getPath());var M=K[0];this.getActions().fireAction(this,M.type,M.parameters);}};G.prototype._createComboBoxItem=function(i,I,J){var K=this.getCardInstance(),M=K.getModel("form"),S={visible:k.reuse(I),placeholder:i.placeholder},P,Q,W;if(i.selectedKey){S.selectedKey=i.selectedKey;}else if(i.value){S.value=i.value;}P=new C(S);if(J){J.setLabelFor(P);}if(i.item){Q=new t({key:i.item.template.key,text:i.item.template.title});P.bindItems({path:i.item.path||"/",template:Q,templateShareable:false});}if(!i.id){f.error("Each input element must have an ID.","sap.ui.integration.widgets.Card");return P;}W=function(){M.setProperty("/"+i.id,{key:P.getSelectedKey(),value:P.getValue()});};P.attachChange(W);P.addEventDelegate({onAfterRendering:W});return P;};G.prototype._createTextAreaItem=function(i,I,J){var K=this.getCardInstance(),M=K.getModel("form"),P=new e({value:i.value,visible:k.reuse(I),rows:i.rows,placeholder:i.placeholder}),Q;if(J){J.setLabelFor(P);}if(!i.id){f.error("Each input element must have an ID.","sap.ui.integration.widgets.Card");return P;}Q=function(){M.setProperty("/"+i.id,P.getValue());};P.attachChange(Q);P.addEventDelegate({onAfterRendering:Q});return P;};G.prototype._createAFLayout=function(){var i=new h();i.addEventDelegate({"onAfterRendering":function(){this.getContent().forEach(function(I){if(!I.getVisible()){document.getElementById("sap-ui-invisible-"+I.getId()).parentElement.classList.add("sapFCardInvisibleContent");}});}},i);return i;};G.prototype._onResize=function(I){if(I.size.width===I.oldSize.width){return;}var J=this._getRootContainer().getItems();J.forEach(function(K,i){if(K.isA("sap.ui.layout.AlignedFlowLayout")){this._onAlignedFlowLayoutResize(K,I,i===J.length-1);}}.bind(this));};G.prototype._onAlignedFlowLayoutResize=function(i,I,J){var M=i.getMinItemWidth(),K,P=i.getContent().filter(function(X){return X.getVisible();}).length;if(M.lastIndexOf("rem")!==-1){K=j.toPx(M);}else if(M.lastIndexOf("px")!==-1){K=parseFloat(M);}var Q=Math.floor(I.size.width/K);if(Q>P){Q=P;}var S=Q-1,W=Math.ceil(P/Q);i.getContent().forEach(function(X,Y){X.addStyleClass("sapFCardObjectSpaceBetweenGroup");if(S===Y&&S<P){X.removeStyleClass("sapFCardObjectSpaceBetweenGroup");S+=Q;}if(J&&Y+1>(W-1)*Q){X.addStyleClass("sapFCardObjectGroupLastInColumn");}else{X.removeStyleClass("sapFCardObjectGroupLastInColumn");}});};return G;});
