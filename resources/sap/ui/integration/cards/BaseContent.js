/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./BaseContentRenderer","sap/m/MessageStrip","sap/m/VBox","sap/m/library","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/integration/model/ObservableModel","sap/ui/base/ManagedObjectObserver","sap/ui/integration/util/LoadingProvider","sap/ui/integration/util/BindingHelper","sap/ui/integration/util/BindingResolver","sap/base/util/merge"],function(B,M,V,l,C,a,I,c,O,b,L,d,e,m){"use strict";var f=c.InvisibleMessageMode;var g=a.extend("sap.ui.integration.cards.BaseContent",{metadata:{library:"sap.ui.integration",aggregations:{_content:{multiple:false,visibility:"hidden"},_loadingProvider:{type:"sap.ui.core.Element",multiple:false,visibility:"hidden"},_loadingPlaceholder:{type:"sap.ui.core.Element",multiple:false,visibility:"hidden"},_messageContainer:{type:"sap.m.VBox",multiple:false,visibility:"hidden"}},associations:{card:{type:"sap.ui.integration.widgets.Card",multiple:false}},events:{press:{},ready:{}}},renderer:B});g.prototype.init=function(){this._oAwaitedEvents=new Set();this._bReady=false;this._mObservers={};this.setAggregation("_loadingProvider",new L());};g.prototype.ontap=function(E){if(!E.isMarked()){this.firePress({});}};g.prototype.exit=function(){this._oAwaitedEvents=null;if(this._mObservers){Object.keys(this._mObservers).forEach(function(k){this._mObservers[k].disconnect();delete this._mObservers[k];},this);}this._oServiceManager=null;this._oDataProviderFactory=null;this._oIconFormatter=null;if(this._oDataProvider){this._oDataProvider.destroy();this._oDataProvider=null;}if(this._oActions){this._oActions.destroy();this._oActions=null;}this._sContentBindingPath=null;};g.prototype.loadDependencies=function(o){return Promise.resolve();};g.prototype.getActions=function(){return this._oActions;};g.prototype.setActions=function(A){this._oActions=A;};g.prototype.awaitEvent=function(E){if(this._oAwaitedEvents.has(E)){return;}this._bReady=false;this._oAwaitedEvents.add(E);this.showLoadingPlaceholders();this.attachEventOnce(E,function(){this._oAwaitedEvents.delete(E);if(this._oAwaitedEvents.size===0){this._bReady=true;this.hideLoadingPlaceholders();this.fireReady();}}.bind(this));};g.prototype.setConfiguration=function(o,t){this._oConfiguration=o;this.awaitEvent("_dataReady");this.awaitEvent("_actionContentReady");if(!o){return this;}var h=this.getAggregation("_loadingProvider").createContentPlaceholder(o,t,this.getCardInstance());this.setAggregation("_loadingPlaceholder",h);this._setDataConfiguration(o.data);return this;};g.prototype.getConfiguration=function(){return this._oConfiguration;};g.prototype.getParsedConfiguration=function(){var r=m({},this._oConfiguration),D=r.data;delete r.data;r=d.createBindingInfos(r,this.getCardInstance().getBindingNamespaces());if(D){r.data=D;}return r;};g.prototype.getStaticConfiguration=function(){return this.getConfiguration();};g.prototype.showMessage=function(s,t){var o=this._getMessageContainer();var h=new M({text:d.createBindingInfos(s,this.getCardInstance().getBindingNamespaces()),type:t,showCloseButton:true,showIcon:true,close:function(){this._getMessageContainer().destroy();}.bind(this)}).addStyleClass("sapFCardContentMessage");o.destroyItems();o.addItem(h);if(this.getDomRef().contains(document.activeElement)){I.getInstance().announce(s,f.Assertive);}else{I.getInstance().announce(s,f.Polite);}};g.prototype._setDataConfiguration=function(D){var o=this.getCardInstance(),h;if(!D){this._sContentBindingPath=null;this.fireEvent("_dataReady");return;}this._sContentBindingPath=e.resolveValue(D.path||"/",this.getCardInstance());this.bindObject(this._sContentBindingPath);if(this._oDataProvider){this._oDataProvider.destroy();}this._oDataProvider=this._oDataProviderFactory.create(D,this._oServiceManager);this.getAggregation("_loadingProvider").setDataProvider(this._oDataProvider);if(D.name){h=o.getModel(D.name);}else if(this._oDataProvider){h=new O();this.setModel(h);}if(!h){this.fireEvent("_dataReady");return;}h.attachEvent("change",function(){if(!this.isDestroyed()){this.onDataChanged();this.onDataRequestComplete();}}.bind(this));if(this._oDataProvider){this._oDataProvider.attachDataRequested(function(){this.onDataRequested();}.bind(this));this._oDataProvider.attachDataChanged(function(E){h.setData(E.getParameter("data"));});this._oDataProvider.attachError(function(E){this.handleError(E.getParameter("message"));this.onDataRequestComplete();}.bind(this));this._oDataProvider.triggerDataUpdate();}else{this.fireEvent("_dataReady");}};g.prototype.onDataRequested=function(){this.awaitEvent("_dataReady");};g.prototype.onDataRequestComplete=function(){var o=this.getCardInstance();this.fireEvent("_dataReady");if(o){o._fireContentDataChange();}};g.prototype.refreshData=function(){if(this._oDataProvider){this._oDataProvider.triggerDataUpdate();}};g.prototype.showLoadingPlaceholders=function(){var o=this.getAggregation("_loadingProvider");if(o){o.setLoading(true);}};g.prototype.hideLoadingPlaceholders=function(){var o=this.getAggregation("_loadingProvider");if(o){o.setLoading(false);}};g.prototype.onDataChanged=function(){};g.prototype._bindAggregationToControl=function(A,o,h){var i;if(!h){return;}if(!h.path){h.path=this._sContentBindingPath;}if(!h.path){i=this.getCardInstance().getBindingContext();h.path=i&&i.getPath();}if(!h.path){return;}o.bindAggregation(A,h);this._observeAggregation(A,o);};g.prototype._observeAggregation=function(A,o){var p=this.getCardInstance().getModel("parameters"),h;if(this._mObservers[A]){return;}h=new b(function(i){var j;if(i.name!==A){return;}if(!(i.mutation==="insert"||i.mutation==="remove")){return;}j=o.getMetadata().getAggregation(A).get(o);p.setProperty("/visibleItems",j.length);});h.observe(o,{aggregations:[A]});this._mObservers[A]=h;};g.prototype.isReady=function(){return this._bReady;};g.prototype.handleError=function(s){this.fireEvent("_error",{logMessage:s});};g.prototype.setServiceManager=function(s){this._oServiceManager=s;return this;};g.prototype.setDataProviderFactory=function(D){this._oDataProviderFactory=D;return this;};g.prototype.setIconFormatter=function(i){this._oIconFormatter=i;return this;};g.prototype.isLoading=function(){var o=this.getAggregation("_loadingProvider"),h=this.getCardInstance();return!o.isDataProviderJson()&&(o.getLoading()||(h&&h.isLoading()));};g.prototype.attachPress=function(){var h=Array.prototype.slice.apply(arguments);h.unshift("press");a.prototype.attachEvent.apply(this,h);this.invalidate();return this;};g.prototype.detachPress=function(){var h=Array.prototype.slice.apply(arguments);h.unshift("press");a.prototype.detachEvent.apply(this,h);this.invalidate();return this;};g.prototype.onActionSubmitStart=function(F){};g.prototype.onActionSubmitEnd=function(r,E){};g.prototype.getCardInstance=function(){return C.byId(this.getCard());};g.prototype.isSkeleton=function(){var o=this.getCardInstance();return o&&o.isSkeleton();};g.prototype.sliceData=function(s,E){};g.prototype.getDataLength=function(){return 0;};g.prototype._getMessageContainer=function(){var o=this.getAggregation("_messageContainer");if(!o){o=new V({renderType:l.FlexRendertype.Bare,alignItems:l.FlexAlignItems.Center}).addStyleClass("sapFCardContentMessageContainer");this.setAggregation("_messageContainer",o);}return o;};return g;});
