/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/m/Popover","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/VBox","sap/m/HBox","sap/m/Select","sap/ui/core/ListItem","sap/m/Label","sap/m/Text","sap/m/Title","sap/m/CheckBox","sap/m/Menu","sap/m/MenuItem","sap/m/Input","sap/ui/integration/util/ParameterMap","sap/base/util/merge","sap/ui/core/Core","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/ScrollContainer","sap/base/util/ObjectPath","sap/ui/integration/util/BindingHelper"],function(C,P,J,B,S,b,O,T,V,H,c,L,d,e,f,g,M,h,I,k,m,l,p,q,r,s,t,u){"use strict";var w=C.extend("sap.ui.integration.editor.Settings",{metadata:{library:"sap.ui.integration"},renderer:null});var R=l.getLibraryResourceBundle("sap.ui.integration"),x,y,z=null,D,A,E,F,G,K,N,Q,U,W,X,Y;w.prototype.setConfiguration=function(o){this._originalConfig=o;o=m({},o);var a=new J(o);this.setModel(a,"currentSettings");this.bindElement({path:"currentSettings>/"});};w.prototype.open=function(o,a,i,j,n,v,q1){var r1=this.getModel("currentSettings").getData();if(r1.values){this.prepareFieldsInKey(r1);}z=this;Y=Z(r1,n);this.addDependent(Y);this.oHost=j;this.fnApply=v;this.fnCancel=q1;this._oOpener=n;y=true;o.addDependent(this);if(!r1.allowDynamicValues&&r1.values){l.byId("settings_scroll_container").setHeight("155px");}this.getModel("currentSettings").checkUpdate(true,true);n1(R.getText("EDITOR_SELECT_FROM_LIST"),[]);if(a){var s1=(!i||i.getDomRef()===null||i.getDomRef().offsetWidth===0)?270:i.getDomRef().offsetWidth;var t1=(!i||i.getDomRef()===null||i.getDomRef().offsetHeight===0)?350:i.getDomRef().offsetHeight;Y.setContentWidth(s1+"px");Y.setContentHeight((t1-50)+"px");if(n.getPreviewPosition()==="right"){Y.setPlacement("Right");}else{Y.setPlacement("Left");}F.setValue(o._label);Y.openBy(o);}else{Y.open();}x=this.getModel("currentSettings");if(x.getProperty("/_hasDynamicValue")){d1();}else if(x.getProperty("/_hasSettings")){c1();}else if(x.getProperty("/allowDynamicValues")){d1();}else if(x.getProperty("/allowSettings")){c1();}};w.prototype._applyCurrentSettings=function(){this.fnApply(x.getData());};w.prototype._cancelCurrentSettings=function(){this.fnCancel(this._originalConfig);};w.prototype.destroy=function(){this.removeDependent(Y);return C.prototype.destroy.apply(this,arguments);};function Z(o,a){var n=a1(),X=b1(o),D=h1(),v=i1(),A=j1(o,a),Y=new P({id:"settings_popover",showArrow:true,contentWidth:"400px",showHeader:false,horizontalScrolling:false,verticalScrolling:false,modal:false,footer:new O({content:[X,new T(),new B({text:R.getText("EDITOR_MORE_OK"),type:"Emphasized",press:function(){if(o.values){var j=l.byId("settings_pav_table"),q1=j.getSelectedContexts(),r1=[];if(x.getProperty("/selectedValues")==="Partion"){for(var i=0;i<q1.length;i++){var s1=z.getKeyFromItem(q1[i].getObject());r1.push(s1);}e1("pageAdminValues",r1);}else{e1("pageAdminValues",[]);}}z._applyCurrentSettings();y=false;Y.close();}}),new B({text:R.getText("EDITOR_MORE_CANCEL"),press:function(){Y.close();}})]}),afterClose:function(){if(y){z._cancelCurrentSettings();}y=true;Y.destroy();},afterOpen:function(){window.requestAnimationFrame(function(){Y.getDomRef()&&(Y.getDomRef().style.opacity="1");});if(o.values){var q1=l.byId("settings_pav_table"),r1=x.getProperty("/_next/pageAdminValues");if(r1!==undefined&&r1.length>0){q1.removeSelections();x.setProperty("/selectedValues","None");var s1=x.getProperty("/_next/pageAdminValues"),t1=q1.getItems();for(var i=0;i<s1.length;i++){for(var j=0;j<t1.length;j++){var u1=z.getKeyFromItem(t1[j].getBindingContext().getObject());if(s1[i]===u1){q1.setSelectedItem(t1[j]);}}}x.setProperty("/selectedValues","Partion");}else{q1.selectAll();x.setProperty("/selectedValues","All");}}}});Y.setCustomHeader(n);Y.addContent(D);Y.addContent(v);Y.addContent(A);Y.addStyleClass("sapUiIntegrationFieldSettings");return Y;}function $(){U=new b({text:R.getText("EDITOR_MORE_SETTINGS"),tooltip:R.getText("EDITOR_MORE_SETTINGS"),key:"settings",icon:"sap-icon://action-settings",width:"50%",press:c1}).addStyleClass("setbtn");return U;}function _(){U=$();W=new S("settings_Segment_btn",{width:"100%",visible:"{= ${currentSettings>allowDynamicValues} && ${currentSettings>allowSettings}}",items:[new b({text:R.getText("EDITOR_MORE_DYNAMICVALUES"),tooltip:R.getText("EDITOR_MORE_DYNAMICVALUES"),key:"dynamic",icon:"{= ${currentSettings>_hasDynamicValue} ? 'sap-icon://display-more' : 'sap-icon://enter-more'}",width:"50%",press:d1}).addStyleClass("dynbtn sel"),U]});return W;}function a1(){W=_();var o=new e({text:R.getText("EDITOR_MORE_DYNAMICVALUES"),tooltip:R.getText("EDITOR_MORE_DYNAMICVALUES"),visible:"{= ${currentSettings>allowDynamicValues} && !${currentSettings>allowSettings}}"}).addStyleClass("sapUiTinyMagin");var a=new e({text:R.getText("EDITOR_MORE_SETTINGS"),visible:"{= !${currentSettings>allowDynamicValues} && ${currentSettings>allowSettings}}"}).addStyleClass("sapUiTinyMagin");var i=new O({content:[W,o,a]}).addStyleClass("headertitle");return i;}function b1(o){X=new B("settings_reset_to_default_btn",{type:"Transparent",text:R.getText("EDITOR_MORE_RESET"),enabled:"{= ${currentSettings>_next/visible} === (typeof(${currentSettings>visibleToUser}) === 'undefined' ? false : !${currentSettings>visibleToUser}) || ${currentSettings>_next/editable} === (typeof(${currentSettings>editableToUser}) === 'undefined' ? false : !${currentSettings>editableToUser}) || ${currentSettings>_next/allowDynamicValues} === (typeof(${currentSettings>allowDynamicValues}) === 'undefined' ? false : !${currentSettings>allowDynamicValues}) || ${currentSettings>_beforeValue} !== ${currentSettings>value}}",tooltip:R.getText("EDITOR_MORE_SETTINGS_P_ADMIN_RESET"),press:function(){var v=typeof(x.getProperty("/visibleToUser"))==='undefined'?true:x.getProperty("/visibleToUser");var a=typeof(x.getProperty("/editableToUser"))==='undefined'?true:x.getProperty("/editableToUser");var n=typeof(x.getProperty("/allowDynamicValues"))==='undefined'?true:x.getProperty("/allowDynamicValues");var Y=l.byId("settings_popover");e1("visible",v);e1("editable",a);e1("allowDynamicValues",n);if(x.getProperty("/translatable")){if(x.getProperty("/_translatedDefaultValue")&&x.getProperty("/_translatedDefaultValue")!==""){x.setProperty("/value",x.getProperty("/_translatedDefaultValue"));}else if(x.getProperty("/_translatedDefaultPlaceholder")&&x.getProperty("/_translatedDefaultPlaceholder")!==""){x.setProperty("/value",x.getProperty("/_translatedDefaultPlaceholder"));}x.setProperty("/_changed",false);}else{x.setProperty("/value",x.getProperty("/_beforeValue"));}if(o.values){var q1=l.byId("settings_pav_table"),r1=x.getProperty("/_next/pageAdminValues"),s1=q1.getItems();if(r1!==undefined&&r1.length>0&&r1.length<s1.length){q1.removeSelections();for(var i=0;i<r1.length;i++){for(var j=0;j<s1.length;j++){var t1=z.getKeyFromItem(s1[j].getBindingContext().getObject());if(r1[i]===t1){q1.setSelectedItem(s1[j]);}}}x.setProperty("/selectedValues","Partion");}else{q1.selectAll();x.setProperty("/selectedValues","All");}}Y.getFooter().getContent()[2].firePress();}}).addStyleClass("resetbutton");return X;}function c1(){A.setVisible(true);D.setVisible(false);l.byId("settings_Segment_btn").setSelectedKey("settings");var o=l.byId("settings_current_value");o.setVisible(false);}function d1(){A.setVisible(false);D.setVisible(true);l.byId("settings_Segment_btn").setSelectedKey("dynamic");var a=z.getModel("contextflat"),o=a._getValueObject(x.getProperty("/value"));if(o&&o.object.label){F.setValue(o.object.label);n1(o.object.description,o.object.tags);if(o.path==="empty"){F.setValue(o.object.label);}p1(o);}var i=l.byId("settings_current_value");i.setVisible(true);}function e1(a,v){if(!x.getProperty("/_next")){x.setProperty("/_next",{});}x.setProperty("/_next/"+a,v);}function f1(o,j){var a=[];for(var n in o){if(o[n]&&o[n].label){var v=new h({text:o[n].label});v.__data=o[n];o[n].pathvalue=(j+"/"+n).substring(1);a.push(v);var q1=f1(o[n],j+"/"+n);for(var i=0;i<q1.length;i++){v.addItem(q1[i]);}}}return a;}var g1=[{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Relative date/datetime text of the value",description:"Should be applied to dynamic values of type date or datetime or string values that represent a datetime in the format 'yyyy-MM-ddZhh:mm:ss'",example:"4 weeks ago",syntax:"handlebars",binding:"{= format.dateTime('__|VALUE|__',{relative:true})}"},{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Short date/datetime text of the value",description:"Should be applied to dynamic values of type date, date-time or text values that represent a datetime in the format 'yyyy-MM-ddZhh:mm:ss.sss'",example:"9/18/20, 2:09 PM",binding:"{= format.dateTime('__|VALUE|__',{style:'short'})}"},{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Medium date/datetime text of the value",description:"Should be applied to dynamic values of type date, date-time or text values that represent a datetime in the format 'yyyy-MM-ddThh:mm:ss.sssZ'",example:"Sep 18, 2020, 2:09:04 PM",binding:"{= format.dateTime('__|VALUE|__',{style:'medium'})}"},{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Long date, date-time text of the value",description:"Should be applied to dynamic values of type date or date-time or string values that represent a datetime in the format 'yyyy-MM-ddThh:mm:ss.sssZ'",example:"Sep 18, 2020, 2:09:04 PM",binding:"{= format.dateTime('__|VALUE|__',{style:'long'})}"}];function h1(){D=new V({visible:true});D.addStyleClass("sapUiSmallMargin");F=new I({width:"100%",showValueHelp:true,valueHelpOnly:true,valueHelpRequest:function(){if(G){G.destroy();}G=new M({});K=f1(D.getModel("context").getData(),"");for(var i=0;i<K.length;i++){G.addItem(K[i]);}G.attachItemSelected(function(o){var j=o.getParameter("item").__data;n1(j.description||"",j.tags||[]);F.setValue(j.placeholder||j.label);var n=z.getModel("contextflat");p1(n._getPathObject(j.pathvalue));});F.addDependent(G);G.addStyleClass("sapUiIntegrationFieldSettingsMenu");G.openBy(F,false,null,null,"1 0");}});F.addStyleClass("selectvariable");var a=new d({text:"Select a dynamic value"});F.addAriaLabelledBy(a);var v=new V({items:[a,F]});D.addItem(v);E=new e({text:"",maxLines:6,renderWhitespace:true});v=new V({width:"100%",items:[E]});E.addStyleClass("description");D.addItem(v);if(g1.length===-1){N=new c({width:"100%",enabled:true,change:function(){Q.setText(N.getSelectedItem()._data.description);}});v=new V({visible:false,items:[new d({text:"Customize the value..."}),N]});D.addItem(v);Q=new e({text:"",maxLines:4,renderWhitespace:true});Q.addStyleClass("description");v=new V({width:"100%",items:[Q]});D.addItem(v);D.getItems()[2].getItems()[0].addStyleClass("sapUiTinyMarginTop");}D.getItems()[0].getItems()[0].addStyleClass("sapUiTinyMarginTop");return D;}function i1(){var a=new e({text:R.getText("EDITOR_ACTUAL_VALUE")});var i=new I({value:{path:"currentSettings>_currentContextValue"},editable:false});i.addAriaLabelledBy(a);var o=new V("settings_current_value",{width:"100%",items:[a,i]});o.addStyleClass("currentval");return o;}function j1(o,a){A=new V({visible:false});var j=new V().addStyleClass("commonSettings");A.addItem(j);j.addItem(new f({text:R.getText("EDITOR_MORE_SETTINGS_P_ADMIN"),wrapping:true}).addStyleClass("stitle"));var n=new d({text:R.getText("EDITOR_MORE_SETTINGS_P_ADMIN_VISIBLE"),wrapping:true});var v=new g({selected:"{= ${currentSettings>_next/visible} !== false}",select:function(D1){e1("visible",D1.getParameter("selected"));}});v.addAriaLabelledBy(n);j.addItem(new H({items:[n,v]}).addStyleClass("cbrow"));var q1=new d({text:R.getText("EDITOR_MORE_SETTINGS_P_ADMIN_EDIT"),wrapping:true});var r1=new g({selected:"{= ${currentSettings>_next/editable} !== false}",enabled:"{= ${currentSettings>_next/visible} !== false}",select:function(D1){e1("editable",D1.getParameter("selected"));}});r1.addAriaLabelledBy(q1);j.addItem(new H({items:[q1,r1]}).addStyleClass("cbrow"));var s1=new d({text:R.getText("EDITOR_MORE_SETTINGS_P_ADMIN_DYN"),wrapping:true});var t1=new g({selected:"{= ${currentSettings>_next/allowDynamicValues} !== false}",enabled:"{= ${currentSettings>_next/visible} !== false && ${currentSettings>_next/editable} !== false}",select:function(D1){e1("allowDynamicValues",D1.getParameter("selected"));}});t1.addAriaLabelledBy(s1);j.addItem(new H({visible:"{= ${currentSettings>allowDynamicValues}!== false}",items:[s1,t1]}).addStyleClass("cbrow"));if(o.values){var u1;if(o.values.data){var v1=o.values.data.path,w1;if(v1&&v1!=="/"){if(v1.startsWith("/")){v1=v1.substring(1);}if(v1.endsWith("/")){v1=v1.substring(0,v1.length-1);}w1=v1.split("/");u1=t.get(["_values",w1],o);}else{u1=t.get(["_values"],o);}}else if(a.getParent().getParent().getAggregation("_extension")){var x1=o.values.path;if(x1.length>1){x1=x1.substring(1);}u1=t.get([x1],a.getModel().getData());}j.addItem(new H({visible:"{= ${currentSettings>_next/visible} !== false && ${currentSettings>_next/editable} !== false}",items:[new d({text:R.getText("EDITOR_MORE_SETTINGS_P_ADMIN_VALUES_LIST"),tooltip:R.getText("EDITOR_MORE_SETTINGS_P_ADMIN_VALUES_LIST_TOOLTIPS"),wrapping:false}),new B({type:"Transparent",enabled:u1!==undefined,icon:{path:"currentSettings>selectedValues",formatter:function(D1){if(D1==="All"){return"sap-icon://multiselect-all";}else if(D1==="Partion"){return"sap-icon://multi-select";}else if(D1==="None"){return"sap-icon://multiselect-none";}}},tooltip:{path:"currentSettings>selectedValues",formatter:function(D1){if(D1==="All"){return R.getText("EDITOR_MORE_SETTINGS_P_ADMIN_DESELECT_ALL");}else{return R.getText("EDITOR_MORE_SETTINGS_P_ADMIN_SELECT_ALL");}}},press:k1})]}).addStyleClass("cbrow"));var y1=new p({id:"settings_pav_table",mode:"MultiSelect",width:"84%",select:l1,columns:[new q()]}).addStyleClass("tableHdr");var z1=o.values.item.text,A1=new J(u1);y1.setModel(A1);var B1=new r().addStyleClass("pavlistItem");if(u1){for(var i=0;i<u1.length;i++){B1.addCell(new H({items:[new e({text:u.createBindingInfos(z1)}).addStyleClass("pavTblCellText")]})).addStyleClass("pavlistItem");}}y1.bindItems("/",B1);var C1=new s({id:"settings_scroll_container",height:"125px",width:"94%",vertical:true,horizontal:false,visible:"{= ${currentSettings>_next/visible} !== false && ${currentSettings>_next/editable} !== false}",content:[y1]}).addStyleClass("SettingsPAVTable");A.addItem(C1);}return A;}function k1(){var o=l.byId("settings_pav_table"),a=l.byId("settings_reset_to_default_btn"),i=x.getProperty("/selectedValues");if(i==="All"){o.removeSelections();x.setProperty("/selectedValues","None");}else{o.selectAll();x.setProperty("/selectedValues","All");}if(!a.getEnabled()){a.setEnabled(true);}}function l1(o){var a=o.getSource(),i=a.getSelectedItems(),j=a.getItems(),n=l.byId("settings_reset_to_default_btn");if(i.length===j.length){x.setProperty("/selectedValues","All");}else if(i.length<j.length&&i.length>0){x.setProperty("/selectedValues","Partion");}else{x.setProperty("/selectedValues","None");}if(!n.getEnabled()){n.setEnabled(true);}}function m1(a,j){a=a||[];N.removeAllItems();var n=[];N.addItem(new L({text:"No customizing needed",key:""}));for(var i=0;i<g1.length;i++){var o=g1[i],v=new L({text:o.label,key:"key"+i});v._data=o;if(o.sourceTypes.indexOf(j)>-1||a.indexOf(o.formatMethod)>-1){N.addItem(v);}else{n.push(v);}}for(var i=0;i<n.length;i++){N.addItem(n[i]);}}function n1(a,i){i=i||[];if(i.indexOf("technical")>-1){a=a+"\n"+R.getText("EDITOR_MORE_DYNAMICVALUES_TECHHINT");}E.setText(a);}function o1(o){if(g1.length===-1){if(!o){N.removeAllItems();N.addItem(new L({text:"No customizing available for this value"}));Q.setText("");N.setEnabled(false);}else{m1(o.customize,o.type);N.setEnabled(true);}}}function p1(o){if(o){x.setProperty("/_hasDynamicValue",true);var a=o.value;x.setProperty("/value",a);x.setProperty("/_contextpath",o.path);if(o.object&&o.object.value&&o.object.value.indexOf("{{")===0){x.setProperty("/_currentContextValue",k.processPredefinedParameter(o.object.value));o1(o.object);}else{if(o.path==="empty"){x.setProperty("/value","");x.setProperty("/_currentContextValue","");x.setProperty("/_hasDynamicValue",false);o1();}else{o1(o.object);if(o.object&&o.object.hasOwnProperty("value")){x.setProperty("/_currentContextValue",o.object.value);}else{z.oHost.getContextValue(o.path+"/value").then(function(v){if(v===null){x.setProperty("/_currentContextValue","(not available)");}else{x.setProperty("/_currentContextValue",v);}o.object&&(o.object.value=v);});}}}}}w._private=function(){return{oPopover:Y,oSegmentedButton:W,oSettingsButton:U,oDynamicPanel:D,oSettingsPanel:A,oCurrentModel:x,updateCurrentValue:p1,oCurrentInstance:z,oDynamicValueField:F,oResetToDefaultButton:X,getMenuItems:function(){return K;},getMenu:function(){return G;}};};w.prototype.prepareFieldsInKey=function(o){this._sKeySeparator=o.values.keySeparator;if(!this._sKeySeparator){this._sKeySeparator="#";}var a=o.values.item.key;this._aFields=a.split(this._sKeySeparator);for(var n in this._aFields){if(this._aFields[n].startsWith("{")){this._aFields[n]=this._aFields[n].substring(1);}if(this._aFields[n].endsWith("}")){this._aFields[n]=this._aFields[n].substring(0,this._aFields[n].length-1);}}};w.prototype.getKeyFromItem=function(i){var a="";this._aFields.forEach(function(j){a+=i[j].toString()+this._sKeySeparator;}.bind(this));if(a.endsWith(this._sKeySeparator)){a=a.substring(0,a.length-this._sKeySeparator.length);}return a;};return w;});
