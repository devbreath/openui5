/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./CardRenderer","../cards/Footer","../controls/ActionsToolbar","sap/ui/base/Interface","sap/ui/thirdparty/jquery","sap/ui/core/Core","sap/ui/integration/util/Manifest","sap/ui/integration/util/ServiceManager","sap/base/Log","sap/base/util/merge","sap/base/util/deepEqual","sap/base/util/each","sap/ui/integration/util/DataProviderFactory","sap/ui/model/json/JSONModel","sap/ui/integration/model/ObservableModel","sap/ui/model/resource/ResourceModel","sap/ui/integration/model/ContextModel","sap/base/util/LoaderExtensions","sap/f/CardBase","sap/f/library","sap/ui/integration/library","sap/ui/integration/util/Destinations","sap/ui/integration/util/LoadingProvider","sap/ui/integration/util/HeaderFactory","sap/ui/integration/util/ContentFactory","sap/ui/integration/util/BindingResolver","sap/ui/integration/formatters/IconFormatter","sap/ui/integration/cards/filters/FilterBarFactory","sap/ui/integration/cards/actions/CardActions","sap/ui/integration/util/CardObserver","sap/m/IllustratedMessage","sap/m/IllustratedMessageType","sap/m/IllustratedMessageSize","sap/ui/integration/util/Utils","sap/ui/integration/util/ParameterMap","sap/ui/performance/Measurement","sap/m/HBox","sap/m/library"],function(C,F,A,I,q,a,b,S,L,m,d,c,D,J,O,R,f,g,h,l,i,j,k,H,n,B,o,p,r,s,t,u,v,U,P,M,w,x){"use strict";var y={TYPE:"/sap.card/type",DATA:"/sap.card/data",HEADER:"/sap.card/header",HEADER_POSITION:"/sap.card/headerPosition",CONTENT:"/sap.card/content",FOOTER:"/sap.card/footer",SERVICES:"/sap.ui5/services",APP_TYPE:"/sap.app/type",PARAMS:"/sap.card/configuration/parameters",DESTINATIONS:"/sap.card/configuration/destinations",CSRF_TOKENS:"/sap.card/configuration/csrfTokens",FILTERS:"/sap.card/configuration/filters",ERROR_MESSAGES:"/sap.card/configuration/messages"};var z=["parameters","filters","paginator","form","context","i18n"];var E=["visibleItems","allItems"];var G=l.cards.HeaderPosition;var K=i.CardArea;var N=i.CardDataMode;var Q="Card is destroyed!";var T=x.FlexRendertype;var V=x.FlexJustifyContent;var W=x.FlexAlignItems;var X="module:";function Y(){if(performance&&performance.now){return"Start since page load: "+performance.now();}return"";}var Z=h.extend("sap.ui.integration.widgets.Card",{metadata:{library:"sap.ui.integration",properties:{referenceId:{type:"string",defaultValue:""},manifest:{type:"any",defaultValue:""},parameters:{type:"object",defaultValue:null},dataMode:{type:"sap.ui.integration.CardDataMode",group:"Behavior",defaultValue:N.Active},baseUrl:{type:"sap.ui.core.URI",defaultValue:null},manifestChanges:{type:"object[]"}},aggregations:{actionDefinitions:{type:"sap.ui.integration.ActionDefinition",multiple:true,forwarding:{getter:"_getActionsToolbar",aggregation:"actionDefinitions"}},_header:{type:"sap.f.cards.IHeader",multiple:false,visibility:"hidden"},_filterBar:{type:"sap.ui.integration.cards.filters.FilterBar",multiple:false,visibility:"hidden"},_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_footer:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_extension:{type:"sap.ui.integration.Extension",multiple:false,visibility:"hidden"},_loadingProvider:{type:"sap.ui.core.Element",multiple:false,visibility:"hidden"}},events:{action:{allowPreventDefault:true,parameters:{actionSource:{type:"sap.ui.core.Control"},manifestParameters:{type:"object"},parameters:{type:"object"},type:{type:"sap.ui.integration.CardActionType"}}},configurationChange:{parameters:{changes:{type:"object"}}},manifestReady:{},manifestApplied:{}},associations:{host:{},openerReference:{visibility:"hidden"}}},renderer:C});Z.prototype.init=function(){h.prototype.init.call(this);this.setAggregation("_loadingProvider",new k());this._oIntegrationRb=a.getLibraryResourceBundle("sap.ui.integration");this._initModels();this._oContentFactory=new n(this);this._oCardObserver=new s(this);this._bFirstRendering=true;this._aFundamentalErrors=[];this._sPerformanceId="UI5 Integration Cards - "+this.getId()+"---";this._fnOnCardReady=function(){this._bCardReady=true;}.bind(this);this._oLimitedInterface=new I(this,["getDomRef","setVisible","getParameters","getCombinedParameters","getManifestEntry","resolveDestination","request","refresh","refreshData","showMessage","getBaseUrl","getRuntimeUrl","getTranslatedText","getModel","triggerAction","addActionDefinition","removeActionDefinition","insertActionDefinition","getActionDefinition","indexOfActionDefinition","destroyActionDefinition","showLoadingPlaceholders","hideLoadingPlaceholders","showCard","hide","getOpener"]);};Z.prototype._initModels=function(){this.setModel(new J());z.forEach(function(e){var $;switch(e){case"context":$=new f();break;case"i18n":$=new R({bundle:this._oIntegrationRb});break;case"parameters":$=new J(P.getParamsForModel());break;default:$=new J();break;}this.setModel($,e);}.bind(this));};Z.prototype.clone=function(){var e=h.prototype.clone.apply(this,arguments);e._initModels();return e;};Z.prototype._initReadyState=function(){this._aReadyPromises=[];this._awaitEvent("_headerReady");this._awaitEvent("_filterBarReady");this._awaitEvent("_contentReady");this._awaitEvent("_cardReady");Promise.all(this._aReadyPromises).then(function(){this._bReady=true;this.fireEvent("_ready");}.bind(this));this.attachEventOnce("_cardReady",this._fnOnCardReady);};Z.prototype._clearReadyState=function(){this._bReady=false;this._bCardReady=false;this._aReadyPromises=[];this.detachEvent("_cardReady",this._fnOnCardReady);};Z.prototype.onBeforeRendering=function(){if(this.getDataMode()!==N.Active){return;}this.startManifestProcessing();};Z.prototype.onAfterRendering=function(){if(M.getActive()&&this._isManifestReady){if(!M.getMeasurement(this._sPerformanceId+"firstRenderingWithStaticData").end){M.end(this._sPerformanceId+"firstRenderingWithStaticData");}if(this._bCardReady&&!M.getMeasurement(this._sPerformanceId+"firstRenderingWithDynamicData").end){M.end(this._sPerformanceId+"firstRenderingWithDynamicData");}}var e=this.getDomRef();if(this.getDataMode()===N.Auto&&this._bFirstRendering){this._oCardObserver.oObserver.observe(e);}this._bFirstRendering=false;};Z.prototype.startManifestProcessing=function(){if(!U.isBindingSyntaxComplex()){this._logFundamentalError("Cannot parse manifest. Complex binding syntax is not enabled - "+"To enable it, set the 'compatVersion' configuration option to 'edge', e.g.: data-sap-ui-compatVersion='edge' - "+"sap.ui.integration.widgets.Card");}if(this._bApplyManifest||this._bApplyParameters){this._clearReadyState();this._initReadyState();}var e=this.getManifest();if(e&&this._bApplyManifest){this._cleanupOldManifest();this.createManifest(e,this.getBaseUrl());}if(!this._bApplyManifest&&this._bApplyParameters){this._oCardManifest.processParameters(this._getContextAndRuntimeParams());this._applyManifestSettings();}this._bApplyManifest=false;this._bApplyParameters=false;this._refreshActionsMenu();};Z.prototype.setManifest=function(e){if(!d(this.getProperty("manifest"),e)){this.destroyActionDefinitions();}if(!e){this._destroyManifest();}this._bApplyManifest=true;this.setProperty("manifest",e);return this;};Z.prototype.setManifestChanges=function(e){this.setProperty("manifestChanges",e);this._bApplyManifest=true;return this;};Z.prototype.setParameters=function(e){this.setProperty("parameters",e);this._bApplyParameters=true;return this;};Z.prototype.setParameter=function(e,$){var _=this.getParameters()||{};_[e]=$;this.setParameters(_);return this;};Z.prototype.setHost=function(e){this.setAssociation("host",e);var $=this.getHostInstance();if(e&&!$){L.error("Host with id '"+e+"' is not available during card initialization. It must be available for host specific features to work.","Make sure that the host already exists, before assigning it to the card.","sap.ui.integration.widgets.Card");return this;}this.getModel("context").setHost($);if(this._oDestinations){this._oDestinations.setHost($);}if(this._oDataProviderFactory){this._oDataProviderFactory.setHost($);}if($&&$.bUseExperimentalCaching){this.addStyleClass("sapFCardExperimentalCaching");}else{this.removeStyleClass("sapFCardExperimentalCaching");}return this;};Z.prototype.createManifest=function($,_){var a1={};this._isManifestReady=false;if(typeof $==="string"){a1.manifestUrl=$;$=null;}if(this._oCardManifest){this._oCardManifest.destroy();}M.start(this._sPerformanceId+"initManifest","Load and initialize manifest. "+Y());M.start(this._sPerformanceId+"firstRenderingWithStaticData","First rendering with static data (includes initManifest). "+Y());M.start(this._sPerformanceId+"firstRenderingWithDynamicData","First rendering with dynamic card level data (includes firstRenderingWithStaticData). "+Y());this._oCardManifest=new b("sap.card",$,_,this.getManifestChanges());this._oCardManifest.load(a1).then(function(){if(this.bIsDestroyed){throw new Error(Q);}M.end(this._sPerformanceId+"initManifest");this._registerManifestModulePath();this._isManifestReady=true;this.fireManifestReady();return this._loadExtension();}.bind(this)).then(this._applyManifest.bind(this)).catch(function(e){if(e.message!==Q){this._applyManifest();return;}this._logFundamentalError(e.message);}.bind(this));};Z.prototype._loadExtension=function(){var e=this._oCardManifest.get("/sap.card/extension"),$;if(!e){return null;}if(e.startsWith(X)){$=e.replace(X,"");}else{$=this._oCardManifest.get("/sap.app/id").replace(/\./g,"/")+"/"+e;}return new Promise(function(_,a1){sap.ui.require([$],function(b1){var c1=new b1();c1._setCard(this,this._oLimitedInterface);this.setAggregation("_extension",c1);_();}.bind(this),function(b1){this._logFundamentalError("Failed to load "+$+". Check if the path is correct. Reason: "+b1);a1(b1);}.bind(this));}.bind(this));};Z.prototype._logFundamentalError=function(e){L.error(e);this._aFundamentalErrors.push(e);};Z.prototype.getFundamentalErrors=function(){return this._aFundamentalErrors;};Z.prototype._applyManifest=function(){var e=this._oCardManifest;if(!e.get("/sap.card")){this._logFundamentalError("There must be a 'sap.card' section in the manifest.");}if(e&&e.getResourceBundle()){this._enhanceI18nModel(e.getResourceBundle());}this.getModel("context").resetHostProperties();if(this._hasContextParams()){this._resolveContextParams().then(function($){this._oContextParameters=$;this._applyManifestWithParams();}.bind(this));return;}this._applyManifestWithParams();};Z.prototype._applyManifestWithParams=function(){var e=this._oCardManifest,$=this._getContextAndRuntimeParams();e.processParameters($);this._prepareToApplyManifestSettings().then(function(){this._applyManifestSettings();}.bind(this));};Z.prototype._enhanceI18nModel=function(e){var $=this.getModel("i18n"),_;_=new R({bundle:e,enhanceWith:[this._oIntegrationRb]});this.setModel(_,"i18n");$.destroy();};Z.prototype._hasContextParams=function(){var e=this._oCardManifest.get(y.PARAMS),$,_;for($ in e){_=e[$].value;if(typeof _==="string"&&_.indexOf("{context>")!==-1){return true;}}return false;};Z.prototype._resolveContextParams=function(){var e=this.getModel("context"),$=this._oCardManifest.get(y.PARAMS),_={},a1,b1;for(a1 in $){b1=$[a1].value;if(typeof b1==="string"&&b1.indexOf("{context>")!==-1){_[a1]=b1;}}B.resolveValue(_,this,"/");return e.waitForPendingProperties().then(function(){return B.resolveValue(_,this,"/");}.bind(this));};Z.prototype._getContextAndRuntimeParams=function(){var e=this._oContextParameters||{},$=this.getParameters()||{};return m(e,$);};Z.prototype._awaitEvent=function(e){this._aReadyPromises.push(new Promise(function($){this.attachEventOnce(e,function(){$();});}.bind(this)));};Z.prototype.isReady=function(){return this._bReady;};Z.prototype.refresh=function(){if(this.getDataMode()===N.Active){this._bApplyManifest=true;this.invalidate();}};Z.prototype.refreshData=function(){if(!this.isReady()){return;}var e=this.getCardHeader(),$=this.getCardContent(),_=this.getAggregation("_filterBar");if(this._oDataProvider){this._oDataProvider.triggerDataUpdate();}if(e){e.refreshData();}if($&&$.isA("sap.ui.integration.cards.BaseContent")){$.refreshData();}else{this.destroyAggregation("_content");this._destroyTemporaryContent();this._applyContentManifestSettings();}if(_){_.refreshData();}};Z.prototype._refreshActionsMenu=function(){var e=this.getCardHeader(),$=this.getHostInstance(),_=this.getAggregation("_extension"),a1=[];if(!e){return;}if($){a1=a1.concat($.getActions()||[]);}if(_){a1=a1.concat(_.getActions()||[]);}if(d(a1,this._getActionsToolbar()._aActions)){return;}this._getActionsToolbar().initializeContent(this);};Z.prototype.exit=function(){h.prototype.exit.call(this);this._destroyManifest();this._oCardObserver.destroy();this._oCardObserver=null;this._oContentFactory=null;this._bFirstRendering=null;this._oIntegrationRb=null;if(this._oActionsToolbar){this._oActionsToolbar.destroy();this._oActionsToolbar=null;}};Z.prototype._destroyManifest=function(){if(this._oCardManifest){this._oCardManifest.destroy();this._oCardManifest=null;}if(this._oServiceManager){this._oServiceManager.destroy();this._oServiceManager=null;}if(this._oDestinations){this._oDestinations.destroy();this._oDestinations=null;}if(this._oIconFormatter){this._oIconFormatter.destroy();this._oIconFormatter=null;}if(this._oActionsToolbar){this._oActionsToolbar.destroy();this._oActionsToolbar=null;}this.destroyAggregation("_header");this.destroyAggregation("_filterBar");this.destroyAggregation("_content");this.destroyAggregation("_footer");this._cleanupOldManifest();};Z.prototype._cleanupOldManifest=function(){this._aReadyPromises=null;this.getModel("filters").setData({});this.getModel("parameters").setData({});this.getModel("paginator").setData({});this._oContextParameters=null;this._deregisterCustomModels();this.destroyAggregation("_extension");this._destroyTemporaryContent();if(this._oDataProviderFactory){this._oDataProviderFactory.destroy();this._oDataProviderFactory=null;this._oDataProvider=null;}};Z.prototype._registerManifestModulePath=function(){if(!this._oCardManifest){return;}this._sAppId=this._oCardManifest.get("/sap.app/id");if(this._sAppId){g.registerResourcePath(this._sAppId.replace(/\./g,"/"),this._oCardManifest.getUrl()||"/");}else{this._logFundamentalError("Card sap.app/id entry in the manifest is mandatory");}};Z.prototype.getManifest=function(){var e=this.getProperty("manifest");if(e&&typeof e==="object"){return q.extend(true,{},e);}return e;};Z.prototype.getParameters=function(){var e=this.getProperty("parameters");if(e&&typeof e==="object"){return q.extend(true,{},e);}return e;};Z.prototype.getCombinedParameters=function(){if(!this._isManifestReady){L.error("The manifest is not ready. Consider using the 'manifestReady' event.","sap.ui.integration.widgets.Card");return null;}var e=this._oCardManifest.getProcessedParameters(this._getContextAndRuntimeParams()),$={},_;for(_ in e){$[_]=e[_].value;}return $;};Z.prototype.getManifestEntry=function(e){if(!this._isManifestReady){L.error("The manifest is not ready. Consider using the 'manifestReady' event.","sap.ui.integration.widgets.Card");return null;}return this._oCardManifest.get(e);};Z.prototype.getManifestRawJson=function(){if(!this._oCardManifest||!this._oCardManifest){L.error("The manifest is not ready. Consider using the 'manifestReady' event.","sap.ui.integration.widgets.Card");return{};}return this._oCardManifest.getInitialJson();};Z.prototype.getManifestWithMergedChanges=function(){if(!this._oCardManifest||!this._oCardManifest._oManifest){L.error("The manifest is not ready. Consider using the 'manifestReady' event.","sap.ui.integration.widgets.Card");return{};}return q.extend(true,{},this._oCardManifest._oManifest.getRawJson());};Z.prototype.resolveDestination=function(e){return this._oDestinations.getUrl(e);};Z.prototype.processDestinations=function(e){return this._oDestinations.process(e);};Z.prototype.showMessage=function(e,$){if(this._createContentPromise){this._createContentPromise.then(function(_){_.showMessage(e,$);});}else{L.error("'showMessage' cannot be used before the card instance is ready. Consider using the event 'manifestApplied' event.","sap.ui.integration.widgets.Card");}};Z.prototype.getTranslatedText=function(e,$,_){var a1=this.getModel("i18n"),b1;if(!a1){L.warning("There are no translations available. Either the i18n configuration is missing or the method is called too early.");return null;}b1=a1.getResourceBundle();return b1.getText(e,$,_);};Z.prototype.getDataProviderFactory=function(){if(!this._oDataProviderFactory){L.error("The DataProviderFactory instance is not ready yet. Consider using the event 'manifestApplied'.","sap.ui.integration.widgets.Card");return null;}return this._oDataProviderFactory;};Z.prototype.getRuntimeUrl=function(e){var $=this._sAppId,_,a1=e&&e.trim().replace(/^\//,"");if($===null){L.error("The manifest is not ready so the URL can not be resolved. Consider using the 'manifestReady' event.","sap.ui.integration.widgets.Card");return null;}if(!$||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("//")){return e;}_=$.replace(/\./g,"/");return sap.ui.require.toUrl(_)+"/"+a1;};Z.prototype._prepareToApplyManifestSettings=function(){var e=this._oCardManifest.get(y.APP_TYPE),$=this.getAggregation("_extension");if(e&&e!=="card"){L.error("sap.app/type entry in manifest is not 'card'");}if(this._oDataProviderFactory){this._oDataProviderFactory.destroy();}this._oDestinations=new j({host:this.getHostInstance(),card:this,manifestConfig:this._oCardManifest.get(y.DESTINATIONS)});this._oIconFormatter=new o({card:this});return this.processDestinations(this._oCardManifest.getJson()).then(function(_){this._oCardManifest.setJson(_);this._oDataProviderFactory=new D({host:this.getHostInstance(),extension:$,csrfTokensConfig:this._oCardManifest.get(y.CSRF_TOKENS),card:this});this._registerCustomModels();if($){$.onCardReady();}}.bind(this));};Z.prototype._applyManifestSettings=function(){this._setParametersModelData();this._applyServiceManifestSettings();this._applyFilterBarManifestSettings();this._applyDataManifestSettings();this._applyHeaderManifestSettings();this._applyContentManifestSettings();this._applyFooterManifestSettings();this.fireManifestApplied();};Z.prototype._setParametersModelData=function(){var e=P.getParamsForModel(),$={},_=this.getCombinedParameters(),a1;for(a1 in _){if(E.indexOf(a1)>=0){L.warning("The parameter name '"+a1+"' is reserved for cards. Can not be used for creating custom parameter.");}else{$[a1]={value:_[a1]};}}this.getModel("parameters").setData(m(e,$));};Z.prototype._applyDataManifestSettings=function(){var e=this._oCardManifest.get(y.DATA),$;if(!e){this.fireEvent("_cardReady");return;}this.bindObject(B.resolveValue(e.path||"/",this));if(this._oDataProvider){this._oDataProvider.destroy();}this._oDataProvider=this._oDataProviderFactory.create(e,this._oServiceManager);this.getAggregation("_loadingProvider").setDataProvider(this._oDataProvider);if(e.name){$=this.getModel(e.name);}else if(this._oDataProvider){$=new O();this.setModel($);}if(!$){this.fireEvent("_cardReady");return;}$.attachEvent("change",function(){var _=this.getAggregation("_content");if(_&&!_.isA("sap.ui.integration.cards.BaseContent")){this.destroyAggregation("_content");this._destroyTemporaryContent();this._applyContentManifestSettings();}if(this._createContentPromise){this._createContentPromise.then(function(a1){a1.onDataChanged();this.onDataRequestComplete();}.bind(this));}else{this.onDataRequestComplete();}}.bind(this));if(this._oDataProvider){this._oDataProvider.attachDataRequested(function(){this._showLoadingPlaceholders();}.bind(this));this._oDataProvider.attachDataChanged(function(_){$.setData(_.getParameter("data"));});this._oDataProvider.attachError(function(_){this._handleError("Data service unavailable. "+_.getParameter("message"));this.onDataRequestComplete();}.bind(this));this._oDataProvider.triggerDataUpdate();}else{this.fireEvent("_cardReady");}};Z.prototype._applyServiceManifestSettings=function(){var e=this._oCardManifest.get(y.SERVICES);if(!e){return;}if(!this._oServiceManager){this._oServiceManager=new S(e,this);}};Z.prototype.getCardHeader=function(){return this.getAggregation("_header");};Z.prototype.getCardHeaderPosition=function(){if(!this._oCardManifest){return"Top";}return this._oCardManifest.get(y.HEADER_POSITION)||G.Top;};Z.prototype.getCardContent=function(){return this.getAggregation("_content");};Z.prototype._getActionsToolbar=function(){if(!this._oActionsToolbar){this._oActionsToolbar=new A();this._oActionsToolbar.setCard(this);}return this._oActionsToolbar;};Z.prototype._applyHeaderManifestSettings=function(){var e=this.createHeader();this.destroyAggregation("_header");if(!e){this.fireEvent("_headerReady");return;}e.attachEvent("_error",function($){this._handleError($.getParameter("message"));}.bind(this));this.setAggregation("_header",e);if(e.isReady()){this.fireEvent("_headerReady");}else{e.attachEvent("_ready",function(){this.fireEvent("_headerReady");}.bind(this));}};Z.prototype._applyFilterBarManifestSettings=function(){var e=this.createFilterBar();this.destroyAggregation("_filterBar");if(!e){this.fireEvent("_filterBarReady");return;}e.attachEventOnce("_filterBarDataReady",function(){this.fireEvent("_filterBarReady");}.bind(this));this.setAggregation("_filterBar",e);};Z.prototype._applyFooterManifestSettings=function(){var e=this.createFooter();this.destroyAggregation("_footer");if(e){this.setAggregation("_footer",e);}};Z.prototype.getHostInstance=function(){var e=this.getHost();if(!e){return null;}return a.byId(e);};Z.prototype._applyContentManifestSettings=function(){var e=this._oCardManifest.get(y.TYPE),$=this.getContentManifest(),_=e+" "+this._oRb.getText("ARIA_ROLEDESCRIPTION_CARD");this._ariaText.setText(_);if(!$){this.fireEvent("_contentReady");return;}this._setTemporaryContent(e,$);if(this._bIsPreviewMode){this.fireEvent("_contentReady");return;}this._createContentPromise=this.createContent({cardType:e,contentManifest:$,serviceManager:this._oServiceManager,dataProviderFactory:this._oDataProviderFactory,iconFormatter:this._oIconFormatter,appId:this._sAppId}).then(function(a1){this._setCardContent(a1);return a1;}.bind(this));this._createContentPromise.catch(function(a1){if(a1){this._handleError(a1);}}.bind(this));};Z.prototype.createHeader=function(){var e=this._oCardManifest.get(y.HEADER),$=new H(this);return $.create(e,this._getActionsToolbar());};Z.prototype.createFilterBar=function(){var e=this._oCardManifest.get(y.FILTERS),$=new p(this);return $.create(e,this.getModel("filters"));};Z.prototype.createFooter=function(){var e=this._oCardManifest.get(y.FOOTER);if(!e){return null;}return F.create(this,e);};Z.prototype.getContentManifest=function(){var e=this._oCardManifest.get(y.TYPE),$=e&&e.toLowerCase()==="component",_=this._oCardManifest.get(y.CONTENT),a1=!!_;if(a1&&!e){this._logFundamentalError("Card type property is mandatory!");return null;}if(!a1&&!$){return null;}if($){_=m(_,{componentManifest:this._oCardManifest.getJson()});}return _;};Z.prototype.createContent=function(e){e.cardManifest=this._oCardManifest;return this._oContentFactory.create(e);};Z.prototype._setCardContent=function(e){if(this._bShowContentLoadingPlaceholders){e.showLoadingPlaceholders();this._bShowContentLoadingPlaceholders=false;}e.attachEvent("_error",function(_){this._handleError(_.getParameter("logMessage"));}.bind(this));var $=this.getAggregation("_content");if($&&$!==this._oTemporaryContent){$.destroy();}this.setAggregation("_content",e);if(e.isReady()){this.fireEvent("_contentReady");}else{e.attachReady(function(){this.fireEvent("_contentReady");}.bind(this));}};Z.prototype._setTemporaryContent=function(e,$){var _=this._getTemporaryContent(e,$),a1=this.getAggregation("_content");if(a1&&a1!==_){a1.destroy();}this.setAggregation("_content",_);};Z.prototype._preserveMinHeightInContent=function(e){e.addEventDelegate({onAfterRendering:function(){if(!this._oCardManifest){return;}var $=this._oCardManifest.get(y.TYPE),_=this._oCardManifest.get(y.CONTENT),a1=this._oContentFactory.getClass($),b1;if(!a1){return;}b1=a1.getMetadata().getRenderer().getMinHeight(_,e,this);if(this.getHeight()==="auto"){e.$().css({"min-height":b1});}}},this);};Z.prototype._destroyPreviousContent=function(e){if(e&&!e.hasStyleClass("sapFCardErrorContent")){e.destroy();if(e===this._oTemporaryContent){this._oTemporaryContent=null;}}};Z.prototype._destroyTemporaryContent=function(){if(this._oTemporaryContent){this._oTemporaryContent.destroy();this._oTemporaryContent=null;}};Z.prototype._handleError=function(e,$){if(!$){L.error(e,null,"sap.ui.integration.widgets.Card");}this.fireEvent("_error",{message:e});var _=this._oCardManifest.get(y.ERROR_MESSAGES),a1=this._getIllustratedMessage(_,$),b1=this._oCardManifest.get(y.CONTENT),c1=m({},this.getCardContent());if(b1){this._handleNoDataItems(c1,a1,$);this._destroyPreviousContent(this.getCardContent());this._preserveMinHeightInContent(a1);this.setAggregation("_content",a1);this.fireEvent("_contentReady");}else{this.getCardHeader().setAggregation("_error",a1);}};Z.prototype._getIllustratedMessage=function(e,$){var _=u.UnableToLoad,a1=v.Spot,b1,c1;if($&&!e){switch(this._oCardManifest.get(y.TYPE)){case"List":case"Timeline":_=u.NoData;b1=this._oIntegrationRb.getText("CARD_NO_ITEMS_ERROR_LISTS");break;case"Table":_=u.NoEntries;b1=this._oIntegrationRb.getText("CARD_NO_ITEMS_ERROR_LISTS");break;case"Analytical":_=u.NoEntries;b1=this._oIntegrationRb.getText("CARD_NO_ITEMS_ERROR_CHART");break;case"Object":_=u.NoData;b1=this._oIntegrationRb.getText("CARD_NO_ITEMS_ERROR_CHART");break;}}if(e&&e.noData&&$){var d1=e.noData;_=u[d1.type];a1=v[d1.size];b1=d1.title;c1=d1.description;}var e1=new t({illustrationType:_,illustrationSize:a1,title:b1,description:c1?c1:" "});var f1=new w({renderType:T.Bare,justifyContent:V.Center,alignItems:W.Center,width:"100%",items:[e1]}).addStyleClass("sapFCardErrorContent");return f1;};Z.prototype._handleNoDataItems=function(e,$,_){if(_){$._oCardOriginalContent=e;}};Z.prototype._getTemporaryContent=function(e,$){var _=this.getAggregation("_loadingProvider");if(!this._oTemporaryContent&&_){this._oTemporaryContent=_.createContentPlaceholder($,e,this);this._oTemporaryContent.addEventDelegate({onAfterRendering:function(){if(!this._oCardManifest){return;}var a1=this._oContentFactory.getClass(e).getMetadata().getRenderer().getMinHeight($,this._oTemporaryContent,this);if(this.getHeight()==="auto"){this._oTemporaryContent.$().css({"min-height":a1});}}},this);}return this._oTemporaryContent;};Z.prototype.setDataMode=function(e){if(this._oDataProviderFactory&&e===N.Inactive){this._oDataProviderFactory.destroy();this._oDataProviderFactory=null;}this.setProperty("dataMode",e,true);if(this.getProperty("dataMode")===N.Active){this.refresh();}if(this.getProperty("dataMode")===N.Auto){this._oCardObserver.createObserver(this);if(!this._bFirstRendering){this._oCardObserver.oObserver.observe(this.getDomRef());}}return this;};Z.prototype.loadDesigntime=function(){if(this._oDesigntime){return Promise.resolve(this._oDesigntime);}if(!this._oCardManifest){return new Promise(function($,_){this.attachManifestReady(function(){this.loadDesigntime().then($,_);}.bind(this));}.bind(this));}var e=this._oCardManifest.get("/sap.app/id");if(!e){return Promise.reject("App id not maintained");}return new Promise(function($,_){var a1=this._oCardManifest.get("/sap.card/configuration/editor");if(a1===undefined){a1=this._oCardManifest.get("/sap.card/designtime");}var b1=this._oCardManifest.get("/sap.app/id").replace(/\./g,"/")+"/"+a1;if(b1){sap.ui.require([b1],function(c1){c1=new c1();c1._readyPromise(this._oLimitedInterface,this).then(function(){this._oDesigntime=c1;$(c1);}.bind(this));}.bind(this),function(){_({error:b1+" not found"});});}else{_();}}.bind(this));};Z.prototype.showLoadingPlaceholders=function(e){var $;switch(e){case K.Header:$=this.getCardHeader();if($){$.showLoadingPlaceholders();}break;case K.Filters:$=this.getAggregation("_filterBar");if($){$.showLoadingPlaceholders();}break;case K.Content:if(this._createContentPromise){this._createContentPromise.then(function(_){_.showLoadingPlaceholders();});}else{this._bShowContentLoadingPlaceholders=true;}break;default:this.showLoadingPlaceholders(K.Header);this.showLoadingPlaceholders(K.Filters);this.showLoadingPlaceholders(K.Content);this.getAggregation("_loadingProvider").setLoading(true);}return this;};Z.prototype.hideLoadingPlaceholders=function(e){var $;switch(e){case K.Header:$=this.getCardHeader();if($){$.hideLoadingPlaceholders();}break;case K.Filters:$=this.getAggregation("_filterBar");if($){$.hideLoadingPlaceholders();}break;case K.Content:if(this._createContentPromise){this._createContentPromise.then(function(_){_.hideLoadingPlaceholders();});}else{this._bShowContentLoadingPlaceholders=false;}break;default:this.hideLoadingPlaceholders(K.Header);this.hideLoadingPlaceholders(K.Filters);this.hideLoadingPlaceholders(K.Content);this.getAggregation("_loadingProvider").setLoading(false);}return this;};Z.prototype.isLoading=function(){var e=this.getAggregation("_loadingProvider");return e?e.getLoading():false;};Z.prototype.getFocusDomRef=function(){var e=this.getCardHeader();if(e&&e.getFocusDomRef()){return e.getFocusDomRef();}return this.getDomRef();};Z.prototype._showLoadingPlaceholders=function(){this.getAggregation("_loadingProvider").setLoading(true);};Z.prototype.onDataRequestComplete=function(){var e=this.getCardContent(),$=this.getAggregation("_loadingProvider");this.fireEvent("_cardReady");this.hideLoadingPlaceholders(K.Header);this.hideLoadingPlaceholders(K.Filters);if(e&&e.isA("sap.ui.integration.cards.BaseContent")&&e.isReady()){this.hideLoadingPlaceholders(K.Content);}if($){$.setLoading(false);}this._fireContentDataChange();};Z.prototype.request=function(e){return this.processDestinations(e).then(function($){return this._oDataProviderFactory.create({request:$}).setAllowCustomDataType(true).getData();}.bind(this));};Z.prototype.triggerAction=function(e){r.fireAction({card:this,host:this.getHostInstance(),action:e,parameters:e.parameters,source:this});};Z.prototype._setPreviewMode=function(e){this._bIsPreviewMode=e;if(e){this.addStyleClass("sapFCardPreview");}else{this.removeStyleClass("sapFCardPreview");}this._bApplyManifest=true;this.invalidate();};Z.prototype.getBindingNamespaces=function(){var e={},$=this.getAggregation("_extension");if($){e.extension={formatters:$.getFormatters()};}return e;};Z.prototype._registerCustomModels=function(){var e=this._oCardManifest.findDataSections();if(!this._aCustomModels){this._aCustomModels=[];}this._deregisterCustomModels();e.forEach(function($){var _=$&&$.name;if(!_){return;}if(z.indexOf(_)>-1){L.error("The model name (data section name) '"+_+"' is reserved for cards. Can not be used for creating a custom model.");return;}if(this._aCustomModels.indexOf(_)>-1){L.error("The model name (data section name) '"+_+"' is already used.");return;}this.setModel(new O(),_);this._aCustomModels.push(_);}.bind(this));};Z.prototype._deregisterCustomModels=function(){if(!this._aCustomModels){return;}this._aCustomModels.forEach(function(e){this.getModel(e).destroy();this.setModel(null,e);}.bind(this));this._aCustomModels=[];};Z.prototype._fireConfigurationChange=function(e){var $=this.getHostInstance();if(!this._bReady){return;}this.fireConfigurationChange({changes:e});if($){$.fireCardConfigurationChange({card:this,changes:e});}};Z.prototype._fireContentDataChange=function(){this.fireEvent("_contentDataChange");};Z.prototype.isSkeleton=function(){return false;};Z.prototype.getContentPageSize=function(e){var $=parseInt(B.resolveValue(e,this).maxItems)||0,_=this.getAggregation("_footer"),a1;if(!_){return $;}a1=_.getAggregation("paginator");if(!a1){return $;}if(a1.getPageSize()){return a1.getPageSize();}return $;};Z.prototype.hasPaginator=function(){var e=this._oCardManifest.get(y.FOOTER);return e&&e.paginator;};Z.prototype.showCard=function(e){var $=this._createChildCard(e);e._cardId=$.getId();this.triggerAction({type:"ShowCard",parameters:e});return Promise.resolve($);};Z.prototype.hide=function(){this.triggerAction({type:"HideCard"});};Z.prototype.getOpener=function(){var e=a.byId(this.getAssociation("openerReference"));if(!e){return null;}return e._oLimitedInterface;};Z.prototype._createChildCard=function(e){var $=e.manifest,_=e.baseUrl,a1=e.data,b1=this._createCard({width:e.width,host:this.getHostInstance(),parameters:e.parameters});b1.setAssociation("openerReference",this);if(a1){c(a1,function(c1,d1){var e1=new J(d1);b1.setModel(e1,c1);});}if(typeof $==="string"){b1.setManifest(this.getRuntimeUrl($));if(_){b1.setBaseUrl(_);}}else{b1.setManifest($);b1.setBaseUrl(_||this.getRuntimeUrl("/"));}return b1;};Z.prototype._createCard=function(e){return new Z(e);};return Z;});
