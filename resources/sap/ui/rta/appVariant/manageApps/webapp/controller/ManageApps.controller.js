/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/rta/appVariant/manageApps/webapp/model/models","sap/ui/rta/appVariant/AppVariantUtils","sap/ui/rta/appVariant/Utils","sap/m/MessageBox","sap/ui/rta/Utils","sap/ui/rta/appVariant/Feature","sap/ui/rta/RuntimeAuthoring","sap/ui/core/BusyIndicator","sap/base/i18n/ResourceBundle","sap/m/MessageToast","sap/m/MenuItem"],function(C,L,F,M,A,a,b,R,c,d,B,e,f,g){"use strict";var _;var h;var i;var j;var m;var I;return C.extend("sap.ui.rta.appVariant.manageApps.webapp.controller.ManageApps",{onInit:function(){_=this.getOwnerComponent().getIdRunningApp();h=this.getOwnerComponent().getIsOverviewForKeyUser();i=this.getOwnerComponent().getLayer();var u=F.getUshellContainer();if(!I){this._createResourceBundle();}B.show();return Promise.resolve().then(function(){if(u){return u.getServiceAsync("CrossApplicationNavigation").then(function(o){j=o;});}return undefined;}).then(a.getAppVariantOverview.bind(a,_,h)).then(function(k){B.hide();if(k.length){return this._arrangeOverviewDataAndBindToModel(k).then(function(k){return this._highlightNewCreatedAppVariant(k);}.bind(this));}A.closeOverviewDialog();return this._showMessageWhenNoAppVariantsExist();}.bind(this)).catch(function(E){A.closeOverviewDialog();var o=A.buildErrorInfo("MSG_MANAGE_APPS_FAILED",E);o.overviewDialog=true;B.hide();return A.showRelevantDialog(o,false);});},_createResourceBundle:function(){m=sap.ui.require.toUrl("sap/ui/rta/appVariant/manageApps/")+"webapp";I=e.create({url:m+"/i18n/i18n.properties"});},_showMessageWhenNoAppVariantsExist:function(){return R.showMessageBox(b.Icon.INFORMATION,"MSG_APP_VARIANT_OVERVIEW_SAP_DEVELOPER",{titleKey:"TITLE_APP_VARIANT_OVERVIEW_SAP_DEVELOPER"});},_highlightNewCreatedAppVariant:function(k){var t=this.byId("Table1");t.focus();k.forEach(function(o,l){if(o.currentStatus===I.getText("MAA_NEW_APP_VARIANT")||o.currentStatus===I.getText("MAA_OPERATION_IN_PROGRESS")){if(t.getItems().length>=l){t.getItems()[l].focus();}}});return Promise.resolve();},_arrangeOverviewDataAndBindToModel:function(k){var l=k.filter(function(s){return s.appId===_;});var o=l[0];if(o&&o.appVarStatus!=="R"){o.currentStatus=I.getText("MAA_CURRENTLY_ADAPTING");}k=k.filter(function(s){return s.appId!==_;});k.unshift(o);var r=k.filter(function(s){return s.isOriginal;});var n=r[0];k=k.filter(function(s){return!s.isOriginal;});k.unshift(n);var p={appVariants:k};var q=M.createModel(p);this.getView().setModel(q);return Promise.resolve(k);},formatRowHighlight:function(v){if(v===I.getText("MAA_CURRENTLY_ADAPTING")){return"Success";}else if(v===I.getText("MAA_NEW_APP_VARIANT")){return"Information";}else if(v===I.getText("MAA_OPERATION_IN_PROGRESS")){return"Warning";}return"None";},formatDelButtonTooltip:function(D,k){if(!I){this._createResourceBundle();}if(!D&&!k){return I.getText("TOOLTIP_DELETE_APP_VAR");}return undefined;},formatAdaptUIButtonTooltip:function(k,s){if(!I){this._createResourceBundle();}if(!k){switch(s){case'R':return I.getText("TOOLTIP_ADAPTUI_STATUS_RUNNING");case'U':return I.getText("TOOLTIP_ADAPTUI_STATUS_UNPBLSHD_ERROR");case'E':return I.getText("TOOLTIP_ADAPTUI_STATUS_UNPBLSHD_ERROR");case'P':return I.getText("TOOLTIP_ADAPTUI_STATUS_PUBLISHED");case undefined:return I.getText("TOOLTIP_ADAPTUI_ON_PREMISE");default:}}},formatAdaptUIButtonVisibility:function(v,k){return v&&k;},getModelProperty:function(s,k){return this.getView().getModel().getProperty(s,k);},onMenuAction:function(E){var o=E.getParameter("item");var s="";while(o instanceof g){s=o.getText()+" > "+s;o=o.getParent();}s=s.substr(0,s.lastIndexOf(" > "));if(!I){this._createResourceBundle();}if(s===I.getText("MAA_DIALOG_ADAPT_UI")){return this.handleUiAdaptation(E);}else if(s===I.getText("MAA_DIALOG_COPY_ID")){return this.copyId(E);}else if(s===I.getText("MAA_DIALOG_DELETE_APPVAR")){return this.deleteAppVariant(E);}return undefined;},handleUiAdaptation:function(E){var s=this.getModelProperty("semanticObject",E.getSource().getBindingContext());var k=this.getModelProperty("action",E.getSource().getBindingContext());var p=this.getModelProperty("params",E.getSource().getBindingContext());var n;if(s&&k&&p){n={target:{semanticObject:s,action:k},params:p,writeHistory:false};d.enableRestart(L.CUSTOMER);if(j){j.toExternal(n);}A.closeOverviewDialog();return true;}return false;},copyId:function(E){var s=this.getModelProperty("appId",E.getSource().getBindingContext());A.copyId(s);f.show(I.getText("MAA_COPY_ID_SUCCESS"));},deleteAppVariant:function(E){var o={};if(!I){this._createResourceBundle();}var s=I.getText("MSG_APP_VARIANT_DELETE_CONFIRMATION");o.text=s;o.deleteAppVariant=true;var k=this.getModelProperty("appId",E.getSource().getBindingContext());var l=this.getModelProperty("currentStatus",E.getSource().getBindingContext());var n=l===I.getText("MAA_CURRENTLY_ADAPTING");return A.showRelevantDialog(o).then(function(){return c.onDeleteFromOverviewDialog(k,n,i);}).catch(function(){return true;});}});});
