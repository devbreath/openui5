sap.ui.define(["sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/main/thirdparty/Dialog","sap/ui/webc/main/thirdparty/Button","sap/ui/webc/main/thirdparty/Label","sap/ui/webc/main/thirdparty/GroupHeaderListItem","sap/ui/webc/main/thirdparty/List","sap/ui/webc/main/thirdparty/StandardListItem","sap/ui/webc/main/thirdparty/Title","sap/ui/webc/main/thirdparty/SegmentedButton","sap/ui/webc/main/thirdparty/SegmentedButtonItem","./Bar","./types/ViewSettingsDialogMode","sap/ui/webc/common/thirdparty/icons/sort","sap/ui/webc/common/thirdparty/icons/filter","sap/ui/webc/common/thirdparty/icons/nav-back","./generated/i18n/i18n-defaults","./generated/templates/ViewSettingsDialogTemplate.lit","./generated/themes/ViewSettingsDialog.css"],function(t,e,i,r,s,n,l,o,a,d,c,g,u,h,f,_,S,p,y,m,B){"use strict";function O(t){return t&&typeof t==="object"&&"default"in t?t["default"]:t}var b=O(i);var T=O(r);var x=O(s);var I=O(n);var w=O(l);var D=O(o);var E=O(a);var L=O(d);var N=O(c);var F=O(g);var v=O(u);const R={tag:"ui5-view-settings-dialog",managedSlots:true,properties:{sortDescending:{type:Boolean},_recentlyFocused:{type:Object},_initialSettings:{type:Object},_confirmedSettings:{type:Object},_currentSettings:{type:Object},_currentMode:{type:f,defaultValue:f.Sort},_filterStepTwo:{type:Boolean,noAttribute:true}},slots:{sortItems:{type:HTMLElement},filterItems:{type:HTMLElement}},events:{confirm:{detail:{sortOrder:{type:String},sortBy:{type:String},sortByItem:{type:HTMLElement},sortDescending:{type:Boolean},filters:{type:Array}}},cancel:{detail:{sortOrder:{type:String},sortBy:{type:String},sortByItem:{type:HTMLElement},sortDescending:{type:Boolean},filters:{type:Array}}},"before-open":{}}};class J extends T{constructor(){super();this._currentSettings={sortOrder:[],sortBy:[],filters:[]}}onBeforeRendering(){if(this._currentSettings.filters&&this._currentSettings.filters.length){this._setAdditionalTexts()}if(!this.shouldBuildSort&&this.shouldBuildFilter){this._currentMode=f.Filter}}_setAdditionalTexts(){this.filterItems.forEach((t,e)=>{let i=0;for(let r=0;r<t.values.length;r++){if(this._currentSettings.filters[e].filterOptions[r].selected){i++}}t.additionalText=!i?"":i})}static get render(){return b}static get metadata(){return R}static get dependencies(){return[h,I,N,x,w,E,L,D,F,v]}static get template(){return m}static get styles(){return B}static async onDefine(){J.i18nBundle=await t.getI18nBundle("@ui5/webcomponents-fiori")}get _selectedFilter(){for(let t=0;t<this._currentSettings.filters.length;t++){if(this._currentSettings.filters[t].selected){return this._currentSettings.filters[t]}}return""}get shouldBuildSort(){return!!this.sortItems.length}get shouldBuildFilter(){return!!this.filterItems.length}get hasPagination(){return this.shouldBuildSort&&this.shouldBuildFilter}get _filterByTitle(){return`${J.i18nBundle.getText(y.VSD_FILTER_BY)}: ${this._selectedFilter.text}`}get _dialogTitle(){return J.i18nBundle.getText(y.VSD_DIALOG_TITLE_SORT)}get _okButtonLabel(){return J.i18nBundle.getText(y.VSD_SUBMIT_BUTTON)}get _cancelButtonLabel(){return J.i18nBundle.getText(y.VSD_CANCEL_BUTTON)}get _resetButtonLabel(){return J.i18nBundle.getText(y.VSD_RESET_BUTTON)}get _ascendingLabel(){return J.i18nBundle.getText(y.VSD_ORDER_ASCENDING)}get _descendingLabel(){return J.i18nBundle.getText(y.VSD_ORDER_DESCENDING)}get _sortOrderLabel(){return J.i18nBundle.getText(y.VSD_SORT_ORDER)}get _filterByLabel(){return J.i18nBundle.getText(y.VSD_FILTER_BY)}get _sortByLabel(){return J.i18nBundle.getText(y.VSD_SORT_BY)}get _isPhone(){return e.isPhone()}get _sortAscending(){return!this.sortDescending}get _title(){return this.showBackButton?this._filterByTitle:this._dialogTitle}get _disableResetButton(){return this._dialog&&this._sortSetttingsAreInitial&&this._filteresAreInitial}get _sortSetttingsAreInitial(){let t=true;["sortBy","sortOrder"].forEach(e=>{this._currentSettings[e].forEach((i,r)=>{if(i.selected!==this._initialSettings[e][r].selected){t=false}})});return t}get _filteresAreInitial(){let t=true;this._currentSettings.filters.forEach((e,i)=>{for(let r=0;r<e.filterOptions.length;r++){if(e.filterOptions[r].selected!==this._initialSettings.filters[i].filterOptions[r].selected){t=false}}});return t}get _settings(){return{sortOrder:JSON.parse(JSON.stringify(this.initSortOrderItems)),sortBy:JSON.parse(JSON.stringify(this.initSortByItems)),filters:this.filterItems.map(t=>({text:t.text,selected:false,filterOptions:t.values.map(t=>({text:t.text,selected:t.selected}))}))}}get initSortByItems(){return this.sortItems.map((t,e)=>({text:t.text,selected:t.selected,index:e}))}get initSortOrderItems(){return[{text:this._ascendingLabel,selected:!this.sortDescending},{text:this._descendingLabel,selected:this.sortDescending}]}get expandContent(){return this._filterStepTwo||!this.hasPagination}get isModeSort(){return this._currentMode===f.Sort}get isModeFilter(){return this._currentMode===f.Filter}get showBackButton(){return this.isModeFilter&&this._filterStepTwo}get _sortOrderListDomRef(){return this.shadowRoot.querySelector("[ui5-list][sort-order]")}get _sortByList(){return this.shadowRoot.querySelector("[ui5-list][sort-by]")}get _dialogDomRef(){return this.shadowRoot.querySelector("[ui5-dialog]")}show(){if(!this._dialog){this._sortOrder=this._sortOrderListDomRef;this._sortBy=this._sortByList;this._initialSettings=this._settings;this._currentSettings=this._settings;this._confirmedSettings=this._settings;this._dialog=this._dialogDomRef}else{this._restoreSettings(this._confirmedSettings)}this.fireEvent("before-open",{},true,false);this._dialog.show(true);this._dialog.querySelector("[ui5-list]").focusFirstItem()}_handleModeChange(t){this._currentMode=f[t.detail.selectedItem.getAttribute("mode")]}_handleFilterValueItemClick(t){this._currentSettings.filters=this._currentSettings.filters.map(e=>{if(e.selected){e.filterOptions.forEach(e=>{if(e.text===t.detail.item.innerText){e.selected=!e.selected}})}return e});this._currentSettings=JSON.parse(JSON.stringify(this._currentSettings))}_navigateToFilters(t){this._filterStepTwo=false}_changeCurrentFilter(t){this._filterStepTwo=true;this._currentSettings.filters=this._currentSettings.filters.map(e=>{e.selected=e.text===t.detail.item.innerText;return e})}close(){this._dialog&&this._dialog.close()}_focusRecentlyUsedControl(){if(!this._recentlyFocused||!Object.keys(this._recentlyFocused).length){return}const t=this._recentlyFocused.getSelectedItems(),e=this._recentlyFocused.items,i=e[1]&&e[1].assignedNodes&&e[1].assignedNodes().length;if(t.length){t[0].focus()}else if(i){this._recentlyFocused.focusItem(e[1].assignedNodes()[0])}}_confirmSettings(){this.close();this._confirmedSettings=this._currentSettings;this.fireEvent("confirm",this.eventsParams)}_cancelSettings(){this._restoreSettings(this._confirmedSettings);this.fireEvent("cancel",this.eventsParams);this.close()}get eventsParams(){const t=this._currentSettings.sortOrder.filter(t=>t.selected)[0],e=this._currentSettings.sortBy.filter(t=>t.selected)[0],i=t&&t.text,r=!this._currentSettings.sortOrder[0].selected,s=e&&e.text,n=e&&e.index,l=this.sortItems[n];return{sortOrder:i,sortDescending:r,sortBy:s,sortByItem:l,filters:this.selectedFilters}}get selectedFilters(){const t=[];this._currentSettings.filters.forEach(e=>{const i=[];e.filterOptions.forEach(t=>{if(t.selected){i.push(t.text)}});if(i.length){t.push({});t[t.length-1][e.text]=i}});return t}_restoreConfirmedOnEscape(t){if(t.detail.escPressed){this._cancelSettings();this._currentMode="Sort";this._filterStepTwo=false}}_resetSettings(){this._restoreSettings(this._initialSettings);this._filterStepTwo=false;this._recentlyFocused=this._sortOrder;this._focusRecentlyUsedControl()}_restoreSettings(t){this._currentSettings=JSON.parse(JSON.stringify(t))}_onSortOrderChange(t){this._recentlyFocused=this._sortOrder;this._currentSettings.sortOrder=this.initSortOrderItems.map(e=>{e.selected=e.text===t.detail.item.innerText;return e});this._currentSettings=JSON.parse(JSON.stringify(this._currentSettings))}_onSortByChange(t){const e=Number(t.detail.item.getAttribute("data-ui5-external-action-item-index"));this._recentlyFocused=this._sortBy;this._currentSettings.sortBy=this.initSortByItems.map((t,i)=>{t.selected=i===e;return t});this._currentSettings=JSON.parse(JSON.stringify(this._currentSettings))}setConfirmedSettings(t){if(t&&this._dialog&&!this._dialog.isOpen()){const e=JSON.parse(JSON.stringify(this._confirmedSettings));if(t.sortOrder){for(let i=0;i<e.sortOrder.length;i++){if(e.sortOrder[i].text===t.sortOrder){e.sortOrder[i].selected=true}else{e.sortOrder[i].selected=false}}}if(t.sortBy){for(let i=0;i<e.sortBy.length;i++){if(e.sortBy[i].text===t.sortBy){e.sortBy[i].selected=true}else{e.sortBy[i].selected=false}}}if(t.filters){const i={};for(let e=0;e<t.filters.length;e++){i[Object.keys(t.filters[e])[0]]=t.filters[e][Object.keys(t.filters[e])[0]]}for(let t=0;t<e.filters.length;t++){for(let r=0;r<e.filters[t].filterOptions.length;r++){if(i[e.filters[t].text]&&i[e.filters[t].text].indexOf(e.filters[t].filterOptions[r].text)>-1){e.filters[t].filterOptions[r].selected=true}else{e.filters[t].filterOptions[r].selected=false}}}}this._confirmedSettings=JSON.parse(JSON.stringify(e))}}}J.define();return J});