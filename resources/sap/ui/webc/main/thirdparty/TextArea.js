sap.ui.define(["sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/delegate/ResizeHandler","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/util/AriaLabelHelper","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/FeaturesRegistry","sap/ui/webc/common/thirdparty/base/Keys","sap/ui/webc/common/thirdparty/base/types/ValueState","./Popover","./Icon","sap/ui/webc/common/thirdparty/icons/error","sap/ui/webc/common/thirdparty/icons/alert","sap/ui/webc/common/thirdparty/icons/sys-enter-2","sap/ui/webc/common/thirdparty/icons/information","./generated/templates/TextAreaTemplate.lit","./generated/templates/TextAreaPopoverTemplate.lit","./generated/i18n/i18n-defaults","./generated/themes/TextArea.css","./generated/themes/ValueStateMessage.css","./generated/themes/BrowserScrollbar.css"],function(e,t,a,s,r,i,n,o,u,l,h,p,g,c,d,m,f,v,x,S,T){"use strict";function y(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var _=y(e);var w=y(t);var E=y(a);var b=y(s);var R=y(u);const M={tag:"ui5-textarea",languageAware:true,managedSlots:true,properties:{value:{type:String},disabled:{type:Boolean},readonly:{type:Boolean},required:{type:Boolean},placeholder:{type:String},valueState:{type:R,defaultValue:R.None},rows:{type:b,defaultValue:0},maxlength:{type:b,defaultValue:null},showExceededText:{type:Boolean},growing:{type:Boolean},growingMaxLines:{type:b,defaultValue:0},name:{type:String},accessibleName:{type:String},accessibleNameRef:{type:String},focused:{type:Boolean},exceeding:{type:Boolean},_mirrorText:{type:Object,multiple:true,defaultValue:""},_maxHeight:{type:String,noAttribute:true},_width:{type:b}},slots:{valueStateMessage:{type:HTMLElement},formSupport:{type:HTMLElement}},events:{change:{},input:{}}};class V extends _{static get metadata(){return M}static get styles(){return[T,x]}static get render(){return w}static get template(){return m}static get staticAreaTemplate(){return f}static get staticAreaStyles(){return S}constructor(){super();this._firstRendering=true;this._openValueStateMsgPopover=false;this._fnOnResize=this._onResize.bind(this)}onEnterDOM(){E.register(this,this._fnOnResize)}onExitDOM(){E.deregister(this,this._fnOnResize)}onBeforeRendering(){this._exceededTextProps=this._calcExceededText();this._mirrorText=this._tokenizeText(this.value);this.exceeding=this._exceededTextProps.leftCharactersCount<0;if(this.growingMaxLines){this._maxHeight=`${this.growingMaxLines*1.4*14+9}px`}const e=n.getFeature("FormSupport");if(e){e.syncNativeHiddenInput(this)}else if(this.name){console.warn(`In order for the "name" property to have effect, you should also: import "@ui5/webcomponents/dist/features/InputElementsFormSupport.js";`)}}onAfterRendering(){this.toggleValueStateMessage(this.openValueStateMsgPopover);this._firstRendering=false}getInputDomRef(){return this.getDomRef().querySelector("textarea")}_onkeydown(e){this._keyDown=true;if(o.isEscape(e)){const e=this.getInputDomRef();this.value=this.previousValue;e.value=this.value;this.fireEvent("input")}}_onkeyup(){this._keyDown=false}_onfocusin(){this.focused=true;this._openValueStateMsgPopover=true;this.previousValue=this.getInputDomRef().value}_onfocusout(e){const t=e.relatedTarget&&e.relatedTarget.shadowRoot&&e.relatedTarget.shadowRoot.querySelector(".ui5-valuestatemessage-root");this.focused=false;if(!t){this._openValueStateMsgPopover=false}}_onchange(){this.fireEvent("change",{})}_oninput(e){const t=this.getInputDomRef();if(e.target===t){e.stopImmediatePropagation()}this.value=t.value;this.fireEvent("input",{});this.fireEvent("value-changed")}_onResize(){if(this.displayValueStateMessagePopover){this._width=this.offsetWidth}}toggleValueStateMessage(e){if(e){this.openPopover()}else{this.closePopover()}}async openPopover(){this.popover=await this._getPopover();this.popover&&this.popover.showAt(this.shadowRoot.querySelector(".ui5-textarea-inner"))}async closePopover(){this.popover=await this._getPopover();this.popover&&this.popover.close()}async _getPopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector("[ui5-popover]")}_tokenizeText(e){const t=e.replace(/&/gm,"&amp;").replace(/"/gm,"&quot;").replace(/'/gm,"&apos;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").split("\n");if(t.length<this.rows){return this._mapTokenizedTextToObject([...t,...Array(this.rows-t.length).fill("")])}return this._mapTokenizedTextToObject(t)}_mapTokenizedTextToObject(e){return e.map((t,a)=>({text:t,last:a===e.length-1}))}_calcExceededText(){let e,t,a;if(this.showExceededText){const e=this.maxlength||0;if(e){a=e-this.value.length;if(a>=0){t=V.i18nBundle.getText(v.TEXTAREA_CHARACTERS_LEFT,a)}else{t=V.i18nBundle.getText(v.TEXTAREA_CHARACTERS_EXCEEDED,Math.abs(a))}}}else{e=this.maxlength}return{exceededText:t,leftCharactersCount:a,calcedMaxLength:e}}get classes(){return{valueStateMsg:{"ui5-valuestatemessage--error":this.valueState===R.Error,"ui5-valuestatemessage--warning":this.valueState===R.Warning,"ui5-valuestatemessage--information":this.valueState===R.Information}}}get styles(){const e=1.4*16;const t=this.rows*e+(this.showExceededText?32:0);return{mirror:{"max-height":this._maxHeight},main:{width:"100%",height:this.rows&&!this.growing?`${t}px`:"100%"},focusDiv:{height:this.showExceededText?"calc(100% - 26px)":"100%","max-height":this._maxHeight},valueStateMsgPopover:{"max-width":`${this._width}px`}}}get tabIndex(){return this.disabled?undefined:"0"}get ariaLabelText(){const e=r.getEffectiveAriaLabelText(this);if(this.showExceededText){if(e){return`${e} ${this._exceededTextProps.exceededText}`}return this._exceededTextProps.exceededText}return e}get ariaDescribedBy(){return this.hasValueState?`${this._id}-valueStateDesc`:undefined}get ariaValueStateHiddenText(){if(!this.hasValueState){return}if(this.hasCustomValueState){return this.valueStateMessageText.map(e=>e.textContent).join(" ")}return this.valueStateText}get ariaInvalid(){return this.valueState==="Error"?"true":undefined}get openValueStateMsgPopover(){return!this._firstRendering&&this._openValueStateMsgPopover&&this.displayValueStateMessagePopover}get displayValueStateMessagePopover(){return!this.readonly&&(this.hasCustomValueState||this.hasValueState)}get hasCustomValueState(){return!!this.valueStateMessage.length&&this.hasValueState}get hasValueState(){return this.valueState===R.Error||this.valueState===R.Warning||this.valueState===R.Information}get valueStateMessageText(){return this.valueStateMessage.map(e=>e.cloneNode(true))}get valueStateText(){if(this.valueState!==R.Error){return this.valueStateTextMappings()[R.Warning]}return this.valueStateTextMappings()[this.valueState]}get _valueStatePopoverHorizontalAlign(){return this.effectiveDir!=="rtl"?"Left":"Right"}get _valueStateMessageIcon(){const e={Error:"error",Warning:"alert",Success:"sys-enter-2",Information:"information"};return this.valueState!==R.None?e[this.valueState]:""}valueStateTextMappings(){return{Information:V.i18nBundle.getText(v.VALUE_STATE_INFORMATION),Error:V.i18nBundle.getText(v.VALUE_STATE_ERROR),Warning:V.i18nBundle.getText(v.VALUE_STATE_WARNING)}}static get dependencies(){return[l,h]}static async onDefine(){V.i18nBundle=await i.getI18nBundle("@ui5/webcomponents")}}V.define();return V});